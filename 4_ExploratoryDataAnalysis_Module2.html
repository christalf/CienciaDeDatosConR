<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Exploratory Data Analysis Course - Module 2</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Aprendiendo ciencia de datos con R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-hand-spock"></span>
     
    Resumen del contenido
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-bars"></span>
     
    Contenido
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="divider"></li>
    <li class="dropdown-header">Data Science Toolbox</li>
    <li class="divider"></li>
    <li>
      <a href="1_DataScienceToolBox_Resumen.html">Módulo único</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">R</li>
    <li class="divider"></li>
    <li>
      <a href="2_R_Module1_Resumen.html">Módulo 1</a>
    </li>
    <li>
      <a href="2_R_Module2_Resumen.html">Módulo 2</a>
    </li>
    <li>
      <a href="2_R_Module2_ProgAssmt_PrevPract.html">_práctica</a>
    </li>
    <li>
      <a href="2_R_Module2_ProgAssmt.html">_ejercicio</a>
    </li>
    <li>
      <a href="2_R_Module3_Resumen.html">Módulo 3</a>
    </li>
    <li>
      <a href="2_R_Module3_ProgAssmt.html">_ejercicio</a>
    </li>
    <li>
      <a href="2_R_Module4_Resumen.html">Módulo 4</a>
    </li>
    <li>
      <a href="2_R_Module4_ProgAssmt.html">Ejercicio final</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Getting &amp; Cleaning Data</li>
    <li class="divider"></li>
    <li>
      <a href="3_GettingAndCleaningData_Module1_Resumen.html">Módulo 1</a>
    </li>
    <li>
      <a href="3_GettingAndCleaningData_Module2_Resumen.html">Módulo 2</a>
    </li>
    <li>
      <a href="3_GettingAndCleaningData_Module2_Ejercicios.html">_ejercicios</a>
    </li>
    <li>
      <a href="3_GettingAndCleaningData_Module3_Resumen.html">Módulo 3</a>
    </li>
    <li>
      <a href="3_GettingAndCleaningData_Module3_Ejercicios.html">_ejercicios</a>
    </li>
    <li>
      <a href="3_GettingAndCleaningData_Module4.html">Módulo 4</a>
    </li>
    <li>
      <a href="3_GettingAndCleaningData_Module4_Ejercicios.html">_ejercicios</a>
    </li>
    <li>
      <a href="3_GettingAndCleaningData_FinalProj.html">Proyecto final</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Exploratory Data Analysis</li>
    <li class="divider"></li>
    <li>
      <a href="4_ExploratoryDataAnalysis_Module1.html">Módulo 1</a>
    </li>
    <li>
      <a href="4_ExploratoryDataAnalysis_Module1_Ejercicios.html">_ejercicios</a>
    </li>
    <li>
      <a href="4_ExploratoryDataAnalysis_Module2.html">Módulo 2</a>
    </li>
    <li>
      <a href="4_ExploratoryDataAnalysis_Module3.html">Módulo 3</a>
    </li>
    <li>
      <a href="4_ExploratoryDataAnalysis_Module4.html">Módulo 4</a>
    </li>
    <li>
      <a href="4_ExploratoryDataAnalysis_FinalProj.html">Proyecto final</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Reproducible Research</li>
    <li class="divider"></li>
    <li>
      <a href="5_ReproducibleResearch_Module1.html">Módulo 1</a>
    </li>
    <li>
      <a href="5_ReproducibleResearch_Module2.html">Módulo 2</a>
    </li>
    <li>
      <a href="5_ReproducibleResearch_Module3.html">Módulo 3</a>
    </li>
    <li>
      <a href="5_ReproducibleResearch_Module4.html">Módulo 4</a>
    </li>
    <li>
      <a href="5_ReproducibleResearch_FinalProj.html">Proyectos finales</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://bookdown.org/yihui/rmarkdown/rmarkdown-site.html">
    <span class="fa fa-gears"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Exploratory Data Analysis Course - Module
2</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#the-lattice-plotting-system."
id="toc-the-lattice-plotting-system."><span
class="toc-section-number">1</span> The Lattice Plotting System.</a>
<ul>
<li><a href="#overview." id="toc-overview."><span
class="toc-section-number">1.1</span> Overview.</a></li>
<li><a href="#list-of-the-main-lattice-functions."
id="toc-list-of-the-main-lattice-functions."><span
class="toc-section-number">1.2</span> List of the main lattice
functions.</a></li>
<li><a href="#the-xyplot-function." id="toc-the-xyplot-function."><span
class="toc-section-number">1.3</span> The <code>xyplot()</code>
function.</a></li>
<li><a href="#simple-lattice-plots."
id="toc-simple-lattice-plots."><span
class="toc-section-number">1.4</span> Simple lattice plots.</a>
<ul>
<li><a href="#very-basic-one." id="toc-very-basic-one."><span
class="toc-section-number">1.4.1</span> Very basic one.</a></li>
<li><a href="#using-some-of-the-same-base-graphical-parameters."
id="toc-using-some-of-the-same-base-graphical-parameters."><span
class="toc-section-number">1.4.2</span> Using some of the same
<code>base</code> graphical parameters.</a></li>
<li><a href="#using-a-conditioning-variable-and-the-layout-parameter."
id="toc-using-a-conditioning-variable-and-the-layout-parameter."><span
class="toc-section-number">1.4.3</span> Using a conditioning variable
and the <code>layout</code> parameter.</a></li>
</ul></li>
<li><a href="#lattice-behaviour-returning-a-plot-object."
id="toc-lattice-behaviour-returning-a-plot-object."><span
class="toc-section-number">1.5</span> Lattice behaviour: returning a
plot object.</a></li>
<li><a href="#properties-of-a-trellis-object."
id="toc-properties-of-a-trellis-object."><span
class="toc-section-number">1.6</span> Properties of a
<code>trellis</code> object.</a></li>
<li><a href="#lattice-panel-functions."
id="toc-lattice-panel-functions."><span
class="toc-section-number">1.7</span> Lattice panel functions.</a>
<ul>
<li><a
href="#an-example-of-a-custom-panel-function-given-to-the-panel-argument-adding-a-median-line-in-each-panel."
id="toc-an-example-of-a-custom-panel-function-given-to-the-panel-argument-adding-a-median-line-in-each-panel."><span
class="toc-section-number">1.7.1</span> An example of a custom panel
function given to the <code>panel</code> argument (adding a median line
in each panel).</a></li>
<li><a href="#another-example-adding-a-regression-line-in-each-panel."
id="toc-another-example-adding-a-regression-line-in-each-panel."><span
class="toc-section-number">1.7.2</span> Another example: adding a
regression line in each panel.</a></li>
</ul></li>
<li><a href="#many-panel-lattice-plot"
id="toc-many-panel-lattice-plot"><span
class="toc-section-number">1.8</span> Many panel lattice plot</a>
<ul>
<li><a href="#maacs-example." id="toc-maacs-example."><span
class="toc-section-number">1.8.1</span> MAACS example.</a></li>
<li><a href="#diamonds-example." id="toc-diamonds-example."><span
class="toc-section-number">1.8.2</span> Diamonds example.</a></li>
<li><a href="#the-strip-argument." id="toc-the-strip-argument."><span
class="toc-section-number">1.8.3</span> The <code>strip</code>
argument.</a></li>
</ul></li>
</ul></li>
<li><a href="#plotting-and-color-in-r."
id="toc-plotting-and-color-in-r."><span
class="toc-section-number">2</span> Plotting and Color in R.</a>
<ul>
<li><a href="#colors-1-2-and-3." id="toc-colors-1-2-and-3."><span
class="toc-section-number">2.1</span> Colors 1, 2 and 3.</a></li>
<li><a
href="#another-set-of-common-color-schemes-heat.colors-and-topo.colors-functions."
id="toc-another-set-of-common-color-schemes-heat.colors-and-topo.colors-functions."><span
class="toc-section-number">2.2</span> Another set of common color
schemes: <code>heat.colors()</code> and <code>topo.colors()</code>
functions.</a></li>
<li><a href="#connecting-colors-with-data."
id="toc-connecting-colors-with-data."><span
class="toc-section-number">2.3</span> Connecting colors with
data.</a></li>
<li><a href="#color-utilities-in-r."
id="toc-color-utilities-in-r."><span
class="toc-section-number">2.4</span> Color utilities in R.</a>
<ul>
<li><a href="#colorramp." id="toc-colorramp."><span
class="toc-section-number">2.4.1</span>
<code>colorRamp()</code>.</a></li>
<li><a href="#colorramppallete." id="toc-colorramppallete."><span
class="toc-section-number">2.4.2</span>
<code>colorRampPallete()</code>.</a></li>
<li><a href="#rgb" id="toc-rgb"><span
class="toc-section-number">2.4.3</span> <code>rgb()</code></a></li>
</ul></li>
<li><a href="#rcolorbrewer-package."
id="toc-rcolorbrewer-package."><span
class="toc-section-number">2.5</span> <code>RColorBrewer</code>
package.</a>
<ul>
<li><a href="#using-the-rcolorbrewer-palletes-brewer.pal-function."
id="toc-using-the-rcolorbrewer-palletes-brewer.pal-function."><span
class="toc-section-number">2.5.1</span> Using the
<code>RColorBrewer</code> palletes: <code>brewer.pal()</code>
function.</a></li>
<li><a href="#the-smoothscatter-function-for-very-large-datasets."
id="toc-the-smoothscatter-function-for-very-large-datasets."><span
class="toc-section-number">2.5.2</span> The <code>smoothScatter()</code>
function for very large datasets.</a></li>
</ul></li>
<li><a
href="#adding-transparency-alpha-parameter-to-rgb-colorramp-and-colorramppalette."
id="toc-adding-transparency-alpha-parameter-to-rgb-colorramp-and-colorramppalette."><span
class="toc-section-number">2.6</span> Adding transparency:
<code>alpha</code> parameter to <code>rgb()</code>,
<code>colorRamp()</code> and <code>colorRampPalette()</code>.</a></li>
<li><a href="#summary." id="toc-summary."><span
class="toc-section-number">2.7</span> Summary.</a></li>
</ul></li>
<li><a href="#the-ggplot2-plotting-system."
id="toc-the-ggplot2-plotting-system."><span
class="toc-section-number">3</span> The ggplot2 plotting system.</a>
<ul>
<li><a href="#what-is-ggplot2" id="toc-what-is-ggplot2"><span
class="toc-section-number">3.1</span> What is ggplot2?</a>
<ul>
<li><a
href="#a-quick-example-to-show-the-descriptive-power-of-grammar-of-graphics."
id="toc-a-quick-example-to-show-the-descriptive-power-of-grammar-of-graphics."><span
class="toc-section-number">3.1.1</span> A quick example to show the
descriptive power of Grammar of Graphics.</a></li>
</ul></li>
<li><a href="#the-basics-qplot" id="toc-the-basics-qplot"><span
class="toc-section-number">3.2</span> The Basics:
<code>qplot()</code></a>
<ul>
<li><a href="#example-dataset." id="toc-example-dataset."><span
class="toc-section-number">3.2.1</span> Example dataset.</a>
<ul>
<li><a
href="#ggplot2-hello-world-a-quick-scatterplot-with-automatic-geom-point."
id="toc-ggplot2-hello-world-a-quick-scatterplot-with-automatic-geom-point."><span
class="toc-section-number">3.2.1.1</span> ggplot2 “Hello, world!” (a
quick scatterplot with automatic geom point).</a></li>
<li><a href="#modifying-aesthetics-introducing-a-third-variable."
id="toc-modifying-aesthetics-introducing-a-third-variable."><span
class="toc-section-number">3.2.1.2</span> Modifying aesthetics
(introducing a third variable).</a></li>
<li><a
href="#adding-a-geom-introducing-a-smoother-a-geom-that-is-also-a-statistic-to-highlight-trends."
id="toc-adding-a-geom-introducing-a-smoother-a-geom-that-is-also-a-statistic-to-highlight-trends."><span
class="toc-section-number">3.2.1.3</span> Adding a geom: introducing a
smoother (a geom that is also a statistic) to highlight trends.</a>
<ul>
<li><a href="#adding-a-geom-using-the-geom-argument-to-qplot."
id="toc-adding-a-geom-using-the-geom-argument-to-qplot."><span
class="toc-section-number">3.2.1.3.1</span> Adding a geom using the
<code>geom</code> argument to <code>qplot()</code>.</a></li>
<li><a href="#adding-a-geom-with-the-corrisponding-geom-function."
id="toc-adding-a-geom-with-the-corrisponding-geom-function."><span
class="toc-section-number">3.2.1.3.2</span> Adding a geom with the
corrisponding geom function.</a></li>
</ul></li>
<li><a href="#histograms-one-dimensional-data-with-geom-bar-by-default."
id="toc-histograms-one-dimensional-data-with-geom-bar-by-default."><span
class="toc-section-number">3.2.1.4</span> Histograms (one dimensional
data, with geom bar by default).</a></li>
<li><a href="#boxplots-one-dimensional-data-with-geom-boxplot."
id="toc-boxplots-one-dimensional-data-with-geom-boxplot."><span
class="toc-section-number">3.2.1.5</span> Boxplots (one dimensional
data, with geom boxplot).</a></li>
<li><a href="#facets-multiple-panels."
id="toc-facets-multiple-panels."><span
class="toc-section-number">3.2.1.6</span> Facets (multiple
panels).</a></li>
<li><a href="#adding-a-smoother-to-each-of-the-panels."
id="toc-adding-a-smoother-to-each-of-the-panels."><span
class="toc-section-number">3.2.1.7</span> Adding a smoother to each of
the panels.</a></li>
</ul></li>
<li><a href="#another-example-maacs-cohort-study."
id="toc-another-example-maacs-cohort-study."><span
class="toc-section-number">3.2.2</span> Another example: MAACS Cohort
Study.</a>
<ul>
<li><a href="#histogram-of-eno." id="toc-histogram-of-eno."><span
class="toc-section-number">3.2.2.1</span> Histogram of eNO.</a></li>
<li><a href="#histogram-by-group." id="toc-histogram-by-group."><span
class="toc-section-number">3.2.2.2</span> Histogram by Group.</a></li>
<li><a href="#density-smoother-geom-density."
id="toc-density-smoother-geom-density."><span
class="toc-section-number">3.2.2.3</span> Density Smoother (geom
density).</a></li>
<li><a href="#scatterplots-eno-vs.-pm_2.5"
id="toc-scatterplots-eno-vs.-pm_2.5"><span
class="toc-section-number">3.2.2.4</span> Scatterplots: eNO vs. PM<span
class="math inline">\(_{2.5}\)</span></a></li>
</ul></li>
<li><a href="#summary-of-qplot" id="toc-summary-of-qplot"><span
class="toc-section-number">3.2.3</span> Summary of
<code>qplot()</code></a></li>
</ul></li>
<li><a href="#the-nitty-gritty-of-ggplot2."
id="toc-the-nitty-gritty-of-ggplot2."><span
class="toc-section-number">3.3</span> The nitty gritty of
<code>ggplot2</code>.</a>
<ul>
<li><a href="#basic-components-of-a-ggplot2-plot."
id="toc-basic-components-of-a-ggplot2-plot."><span
class="toc-section-number">3.3.1</span> Basic components of a
<code>ggplot2</code> plot.</a></li>
<li><a href="#building-plots-with-ggplot2."
id="toc-building-plots-with-ggplot2."><span
class="toc-section-number">3.3.2</span> Building Plots with
<code>ggplot2</code>.</a></li>
<li><a href="#example-bmi-pm_2.5-asthma."
id="toc-example-bmi-pm_2.5-asthma."><span
class="toc-section-number">3.3.3</span> Example: BMI, PM<span
class="math inline">\(_{2.5}\)</span>, Asthma.</a></li>
<li><a href="#the-question." id="toc-the-question."><span
class="toc-section-number">3.3.4</span> The question.</a></li>
<li><a href="#the-suggestion." id="toc-the-suggestion."><span
class="toc-section-number">3.3.5</span> The suggestion.</a></li>
<li><a href="#the-outcome-well-look-at."
id="toc-the-outcome-well-look-at."><span
class="toc-section-number">3.3.6</span> The outcome we’ll look
at.</a></li>
<li><a href="#the-quick-plot." id="toc-the-quick-plot."><span
class="toc-section-number">3.3.7</span> The quick plot.</a></li>
<li><a href="#building-up-in-layers-creating-a-ggplot-object."
id="toc-building-up-in-layers-creating-a-ggplot-object."><span
class="toc-section-number">3.3.8</span> Building up in layers, creating
a <code>ggplot</code> object.</a></li>
<li><a href="#no-plot-yet" id="toc-no-plot-yet"><span
class="toc-section-number">3.3.9</span> No Plot Yet!</a></li>
<li><a href="#first-plot-with-point-layer."
id="toc-first-plot-with-point-layer."><span
class="toc-section-number">3.3.10</span> First plot with point
layer.</a></li>
<li><a href="#adding-more-layers-smooth."
id="toc-adding-more-layers-smooth."><span
class="toc-section-number">3.3.11</span> Adding more layers:
smooth.</a></li>
<li><a href="#adding-more-layers-facets."
id="toc-adding-more-layers-facets."><span
class="toc-section-number">3.3.12</span> Adding more layers:
facets.</a></li>
<li><a href="#annotations." id="toc-annotations."><span
class="toc-section-number">3.3.13</span> Annotations.</a>
<ul>
<li><a href="#modifying-geom-properties."
id="toc-modifying-geom-properties."><span
class="toc-section-number">3.3.13.1</span> Modifying geom
properties.</a></li>
<li><a href="#using-aes-to-map-geom-properties-aesthetics-to-variables."
id="toc-using-aes-to-map-geom-properties-aesthetics-to-variables."><span
class="toc-section-number">3.3.13.2</span> Using <code>aes()</code> to
map geom properties (aesthetics) to variables.</a></li>
<li><a href="#modifying-labels." id="toc-modifying-labels."><span
class="toc-section-number">3.3.13.3</span> Modifying labels.</a></li>
<li><a href="#customizing-the-smooth."
id="toc-customizing-the-smooth."><span
class="toc-section-number">3.3.13.4</span> Customizing the
smooth.</a></li>
<li><a href="#changing-the-theme." id="toc-changing-the-theme."><span
class="toc-section-number">3.3.13.5</span> Changing the theme.</a></li>
<li><a
href="#a-note-about-axis-limits-ylim-param-of-coord_cartesian-function-instead-of-ylim-function."
id="toc-a-note-about-axis-limits-ylim-param-of-coord_cartesian-function-instead-of-ylim-function."><span
class="toc-section-number">3.3.13.6</span> A note about axis limits:
<code>ylim</code> param of <code>coord_cartesian()</code> function
instead of <code>ylim()</code> function.</a></li>
</ul></li>
<li><a href="#more-complex-example."
id="toc-more-complex-example."><span
class="toc-section-number">3.3.14</span> More complex example.</a>
<ul>
<li><a href="#making-no_2-tertiles."
id="toc-making-no_2-tertiles."><span
class="toc-section-number">3.3.14.1</span> Making NO<span
class="math inline">\(_2\)</span> tertiles.</a></li>
<li><a href="#the-final-plot." id="toc-the-final-plot."><span
class="toc-section-number">3.3.14.2</span> The final plot.</a></li>
<li><a href="#just-for-fun." id="toc-just-for-fun."><span
class="toc-section-number">3.3.14.3</span> Just for fun.</a></li>
</ul></li>
</ul></li>
<li><a href="#ggplot2-extras." id="toc-ggplot2-extras."><span
class="toc-section-number">3.4</span> <code>ggplot2</code>
extras.</a></li>
<li><a href="#resources" id="toc-resources"><span
class="toc-section-number">3.5</span> Resources</a></li>
</ul></li>
<li><a href="#session-info." id="toc-session-info."><span
class="toc-section-number">4</span> Session Info.</a></li>
</ul>
</div>

<hr />
<div id="the-lattice-plotting-system." class="section level1"
number="1">
<h1><span class="header-section-number">1</span> The Lattice Plotting
System.</h1>
<div id="overview." class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Overview.</h2>
<p>Going back to the overview of this system that we did in Module 1, we
can now add the following.</p>
<p>The <code>lattice</code> plotting system in R is a plotting system
that’s <strong>different from</strong> the <code>base</code> plotting
system and it <strong>works very differently</strong>.</p>
<p>The <code>lattice</code> plotting system is <strong>implemented
using</strong> the following <code>packages</code>:</p>
<ul>
<li>The <em>lattice</em> package.
<ul>
<li>It contains code for producing <strong>trellis</strong> graphics,
which are <em>independent</em> of the <code>base</code> graphics
system.<br />
</li>
<li>Includes functions like <code>xyplot()</code>,
<code>bwplot()</code>, <code>levelplot()</code>.<br />
</li>
</ul></li>
<li>The underlying <em>grid</em> package.
<ul>
<li>It implements a different graphing system <em>independent</em> of
the <code>base</code> system.<br />
</li>
<li>The <em>lattice</em> package <strong>builds on top</strong> of
<em>grid</em> package.<br />
</li>
<li>We seldom (rarely) call functions from the grid package
directly.</li>
</ul></li>
</ul>
<p>One <strong>main difference</strong> between <code>lattice</code> and
<code>base</code> plotting systems:</p>
<ul>
<li>The <code>lattice</code> plotting system <strong>does not have a
“two-phase” aspect</strong> with separate plotting and annotation like
in <code>base</code> plotting.<br />
</li>
<li>All <em>plotting/annotation</em> is <strong>done at once</strong>
with a <strong>single function call</strong>, like <code>xplot()</code>
for instance.
<ul>
<li>So we have to <em>specify all the details</em> within that function
call because we <em>won’t have a chance really to annotate it
afterwards</em>.<br />
</li>
</ul></li>
<li>A <strong>consecuence</strong> of this main difference is that
aspects like margins and spacing are <em>automatically handled</em> and
defaults are usually sufficient.</li>
</ul>
<p>Another <strong>main difference</strong> between <code>lattice</code>
and <code>base</code> plotting systems:</p>
<ul>
<li>As we’ll see, <code>lattice</code> functions <strong>don’t plot data
directly to the graphics device</strong> as like <code>base</code>
functions do. Instead, they return a <code>trellis</code> object and
then print methods for <code>lattice</code> functions actually send the
plot to the graphics device.</li>
</ul>
<p>The <strong>main advantages</strong> of <code>lattice</code>.</p>
<ul>
<li>Lattice plots tend to be most useful for <strong>conditioning types
of plots</strong>, i.e. looking at how <code>y</code> changes with
<code>x</code> across levels of <code>z</code> (with <code>z</code>
being a categorical variable of our data).<br />
</li>
<li>This system is also very good for putting <strong>many many plots on
a screen at once</strong>, allowing to look at
<em>multi-dimensional</em> data in a glance.
<ul>
<li>In the <code>base</code> plotting system it was possible to put
multiple plots on the same graphics device using the <code>mfrow</code>
or <code>mfcall</code> arguments, and make panels and plots to look at
many different features.<br />
</li>
<li>Well, the <code>lattice</code> plotting system is <strong>designed
to optimize</strong> that type of very high density plots.<br />
</li>
<li>In fact, with <code>lattice</code> <strong>panel functions can be
specified/customized</strong> to modify what is plotted in <em>each of
the plot panels</em>.</li>
</ul></li>
</ul>
<p>The <strong>main downsides</strong> of <code>lattice</code>.</p>
<ul>
<li>Annotation in panels in plots is not especially intuitive and can be
<strong>difficult</strong> to explain.<br />
</li>
<li>In particular, the use of custom panel functions and subscripts can
be <strong>difficult</strong> to wield and requires intense
preparation.</li>
</ul>
</div>
<div id="list-of-the-main-lattice-functions." class="section level2"
number="1.2">
<h2><span class="header-section-number">1.2</span> List of the main
lattice functions.</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)</span></code></pre></div>
<ul>
<li><code>xyplot</code>.
<ul>
<li>this is the <strong>main function</strong> for creating
<em>scatterplots</em>.<br />
</li>
</ul></li>
<li><code>bwplot</code>.
<ul>
<li>box-and-whiskers plots (“boxplots”).<br />
</li>
</ul></li>
<li><code>histogram</code>.
<ul>
<li>for histograms.<br />
</li>
</ul></li>
<li><code>stripplot</code>.
<ul>
<li>like a boxplot but with actual points.<br />
</li>
</ul></li>
<li><code>dotplot</code>.
<ul>
<li>plot dots on “violin strings”.<br />
</li>
</ul></li>
<li><code>splom</code>.
<ul>
<li>scatterplot matrix;<br />
</li>
<li>like <code>pairs</code> in <em>base</em> plotting system.<br />
</li>
</ul></li>
<li><code>levelplot</code>, <code>contourplot</code>.
<ul>
<li>for plotting “image” data.</li>
</ul></li>
</ul>
</div>
<div id="the-xyplot-function." class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> The
<code>xyplot()</code> function.</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(xyplot)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> (x, data, ...)  </span></code></pre></div>
<p><strong>First argument</strong>.</p>
<p>Lattice functions generally take a <strong>formula</strong> for their
<em>first argument</em>, usually of the form:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(y <span class="sc">~</span> x <span class="sc">|</span> f <span class="sc">*</span> g, data)</span></code></pre></div>
<ul>
<li>We use the <em>formula notation</em> here, hence the
<code>~</code>.<br />
</li>
<li>On the left of the <code>~</code> is the <em>y-axis
variable</em>.<br />
</li>
<li>On the right is the <em>x-axis variable</em>.<br />
</li>
<li><code>f</code> and <code>g</code> are <em>conditioning
variables</em> (they are optional).
<ul>
<li>These variables are <strong>categorical</strong> variables that we
condition on.<br />
</li>
<li>The idea is that we want to <em>look at the scatterplot</em> of
<code>y</code> and <code>x</code> <em>for every level of f and g</em>
(of course we can only use one categorical variable).<br />
</li>
<li>The <code>*</code> indicates an <strong>interaction</strong> between
two variables.<br />
</li>
<li>Remember we said that lattice is good for plotting multivariate
data: that’s where these conditioning variables come into play.</li>
</ul></li>
</ul>
<p><strong>Second argument</strong>.</p>
<p>The second argument is the <em>data frame</em> or <em>list</em> from
which the variables in the formula should be looked up.</p>
<ul>
<li>If no data frame or list is passed, then the <em>parent frame</em>
is used (R will look in our workspace for the variables to plot).</li>
</ul>
<p><strong>Ellipsis</strong></p>
<p>If no other arguments are passed, there are defaults that can be
used.</p>
</div>
<div id="simple-lattice-plots." class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Simple lattice
plots.</h2>
<div id="very-basic-one." class="section level3" number="1.4.1">
<h3><span class="header-section-number">1.4.1</span> Very basic
one.</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(Ozone <span class="sc">~</span> Wind, <span class="at">data =</span> airquality)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<ul>
<li>This basic scatterplot looks very much like a scatterplot in the
base plotting system.<br />
</li>
<li>Notice that the <strong>defaults</strong> are a <em>little bit
different</em>, though.
<ul>
<li>It does use open circles, but they’re <strong>colored blue</strong>
by default.</li>
</ul></li>
</ul>
</div>
<div id="using-some-of-the-same-base-graphical-parameters."
class="section level3" number="1.4.2">
<h3><span class="header-section-number">1.4.2</span> Using some of the
same <code>base</code> graphical parameters.</h3>
<p>We <strong>can use some of the same graphical parameters</strong>
(e.g., <code>pch</code> and <code>col</code>) that we used in the
<code>base</code> package in calls to lattice functions.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(Ozone <span class="sc">~</span> Wind, <span class="at">data =</span> airquality,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">pch =</span> <span class="dv">8</span>, <span class="at">main =</span> <span class="st">&quot;Big Apple Data&quot;</span>)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="using-a-conditioning-variable-and-the-layout-parameter."
class="section level3" number="1.4.3">
<h3><span class="header-section-number">1.4.3</span> Using a
conditioning variable and the <code>layout</code> parameter.</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(Ozone <span class="sc">~</span> Wind <span class="sc">|</span> <span class="fu">as.factor</span>(Month), <span class="at">data =</span> airquality, <span class="at">layout =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<ul>
<li>Because we want to use <code>Month</code> as a conditioning
variable, we first convert it into a categorical one.<br />
</li>
<li>Then we plot <strong><em><code>Ozone</code> versus <code>Wind</code>
by <code>Month</code></em></strong>. In other words, we want to look at
the <em>relationship</em> between <code>Ozone</code> and
<code>Wind</code> <em>for each level of</em> <code>Month</code> (month
goes from five to nine, so from the month of May to the month of
September).<br />
</li>
<li>This relationship appears to change across the months.
<ul>
<li>There doesn’t appear to be much relationship in May or June.<br />
</li>
<li>But in in July and August, there’s a relatively strong relationship.
There is a <em>negative one</em> there, so more wind means less
ozone.<br />
</li>
<li>And we can see by September that relationship is starting to die
down a little bit.<br />
</li>
</ul></li>
<li>So, one of the power of the <code>xyplot</code> function in lattice
is that we can make these <strong>multidimensional panels very
simply</strong> with just a <em>single function call</em>.
<ul>
<li>In the base plotting system, there would’ve been many, many function
calls to create this plot.</li>
</ul></li>
</ul>
<p>What happens if we use a <strong>conditioning variable</strong> that
is <strong>not a factor</strong>?</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(Ozone <span class="sc">~</span> Wind <span class="sc">|</span> Month, <span class="at">data =</span> airquality, <span class="at">layout =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<ul>
<li>Not as informative, right?<br />
</li>
<li>The word Month in each panel really doesn’t tell us much if it
doesn’t identify which month it’s plotting.<br />
</li>
<li>Notice that the actual data is the same between the two plots,
though.</li>
</ul>
</div>
</div>
<div id="lattice-behaviour-returning-a-plot-object."
class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> Lattice behaviour:
returning a plot object.</h2>
<p><code>Lattice</code> functions <strong>behave differently</strong>
from <code>base</code> graphics functions in <em>one critical
way</em>.</p>
<ul>
<li><p><code>Base</code> graphics functions plot data <em>directly to
the graphics device</em> (screen, PDF file, etc.).</p></li>
<li><p><code>Lattice</code> graphics functions <em>return an object</em>
of class <strong><code>trellis</code></strong>.</p>
<ul>
<li><p>The <em>print methods</em> for <code>lattice</code> functions
actually do the work of plotting the data on the graphics
device.</p></li>
<li><p>So there is a <em>two-stage aspect</em> here, but most of the
time this aspect is <em>invisible to the user</em>.</p>
<ul>
<li><p><code>Lattice</code> functions return “plot objects” that can, in
principle, be stored (but it’s usually better to just save the code +
data).</p></li>
<li><p>On the command line, <code>trellis</code> objects are
<em>auto-printed</em> so that it <strong>appears</strong> <strong>the
function is plotting</strong> the data.</p></li>
</ul></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">xyplot</span>(Ozone <span class="sc">~</span> Wind, <span class="at">data =</span> airquality)            <span class="co"># Nothing happens!</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)                                                <span class="co"># Plot appears.</span></span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<ul>
<li>If we just call <code>xyplot</code> without saving the plot object
that it returns, then the <em>auto-printing feature</em> of R
scatters.</li>
</ul>
</div>
<div id="properties-of-a-trellis-object." class="section level2"
number="1.6">
<h2><span class="header-section-number">1.6</span> Properties of a
<code>trellis</code> object.</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>trel_ppties <span class="ot">&lt;-</span> <span class="fu">names</span>(p)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>trel_ppties</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">&quot;formula&quot;</span>           <span class="st">&quot;as.table&quot;</span>          <span class="st">&quot;aspect.fill&quot;</span>      </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a> [<span class="dv">4</span>] <span class="st">&quot;legend&quot;</span>            <span class="st">&quot;panel&quot;</span>             <span class="st">&quot;page&quot;</span>             </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a> [<span class="dv">7</span>] <span class="st">&quot;layout&quot;</span>            <span class="st">&quot;skip&quot;</span>              <span class="st">&quot;strip&quot;</span>            </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">10</span>] <span class="st">&quot;strip.left&quot;</span>        <span class="st">&quot;xscale.components&quot;</span> <span class="st">&quot;yscale.components&quot;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">13</span>] <span class="st">&quot;axis&quot;</span>              <span class="st">&quot;xlab&quot;</span>              <span class="st">&quot;ylab&quot;</span>             </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>[<span class="dv">16</span>] <span class="st">&quot;xlab.default&quot;</span>      <span class="st">&quot;ylab.default&quot;</span>      <span class="st">&quot;xlab.top&quot;</span>         </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">19</span>] <span class="st">&quot;ylab.right&quot;</span>        <span class="st">&quot;main&quot;</span>              <span class="st">&quot;sub&quot;</span>              </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>[<span class="dv">22</span>] <span class="st">&quot;x.between&quot;</span>         <span class="st">&quot;y.between&quot;</span>         <span class="st">&quot;par.settings&quot;</span>     </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>[<span class="dv">25</span>] <span class="st">&quot;plot.args&quot;</span>         <span class="st">&quot;lattice.options&quot;</span>   <span class="st">&quot;par.strip.text&quot;</span>   </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>[<span class="dv">28</span>] <span class="st">&quot;index.cond&quot;</span>        <span class="st">&quot;perm.cond&quot;</span>         <span class="st">&quot;condlevels&quot;</span>       </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>[<span class="dv">31</span>] <span class="st">&quot;call&quot;</span>              <span class="st">&quot;x.scales&quot;</span>          <span class="st">&quot;y.scales&quot;</span>         </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>[<span class="dv">34</span>] <span class="st">&quot;panel.args.common&quot;</span> <span class="st">&quot;panel.args&quot;</span>        <span class="st">&quot;packet.sizes&quot;</span>     </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>[<span class="dv">37</span>] <span class="st">&quot;x.limits&quot;</span>          <span class="st">&quot;y.limits&quot;</span>          <span class="st">&quot;x.used.at&quot;</span>        </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>[<span class="dv">40</span>] <span class="st">&quot;y.used.at&quot;</span>         <span class="st">&quot;x.num.limit&quot;</span>       <span class="st">&quot;y.num.limit&quot;</span>      </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>[<span class="dv">43</span>] <span class="st">&quot;aspect.ratio&quot;</span>      <span class="st">&quot;prepanel.default&quot;</span>  <span class="st">&quot;prepanel&quot;</span>         </span></code></pre></div>
<ul>
<li>We see that the trellis object <code>p</code> has <strong>45 named
properties</strong>, the first of which is “formula” which isn’t too
surprising.<br />
</li>
<li>A lot of these properties are probably NULL in value.</li>
</ul>
<p>Let’s see how many of them are <strong>not NULL</strong>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Null_tp <span class="ot">&lt;-</span> <span class="fu">sapply</span>(p, is.null)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="sc">!</span>Null_tp)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="cn">FALSE</span>  <span class="cn">TRUE</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>   <span class="dv">16</span>    <span class="dv">29</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>trel_ppties[<span class="sc">!</span>Null_tp]</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">&quot;formula&quot;</span>           <span class="st">&quot;as.table&quot;</span>          <span class="st">&quot;aspect.fill&quot;</span>      </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a> [<span class="dv">4</span>] <span class="st">&quot;panel&quot;</span>             <span class="st">&quot;skip&quot;</span>              <span class="st">&quot;strip&quot;</span>            </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a> [<span class="dv">7</span>] <span class="st">&quot;strip.left&quot;</span>        <span class="st">&quot;xscale.components&quot;</span> <span class="st">&quot;yscale.components&quot;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>[<span class="dv">10</span>] <span class="st">&quot;axis&quot;</span>              <span class="st">&quot;xlab&quot;</span>              <span class="st">&quot;ylab&quot;</span>             </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>[<span class="dv">13</span>] <span class="st">&quot;xlab.default&quot;</span>      <span class="st">&quot;ylab.default&quot;</span>      <span class="st">&quot;x.between&quot;</span>        </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>[<span class="dv">16</span>] <span class="st">&quot;y.between&quot;</span>         <span class="st">&quot;index.cond&quot;</span>        <span class="st">&quot;perm.cond&quot;</span>        </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>[<span class="dv">19</span>] <span class="st">&quot;condlevels&quot;</span>        <span class="st">&quot;call&quot;</span>              <span class="st">&quot;x.scales&quot;</span>         </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>[<span class="dv">22</span>] <span class="st">&quot;y.scales&quot;</span>          <span class="st">&quot;panel.args.common&quot;</span> <span class="st">&quot;panel.args&quot;</span>       </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>[<span class="dv">25</span>] <span class="st">&quot;packet.sizes&quot;</span>      <span class="st">&quot;x.limits&quot;</span>          <span class="st">&quot;y.limits&quot;</span>         </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>[<span class="dv">28</span>] <span class="st">&quot;aspect.ratio&quot;</span>      <span class="st">&quot;prepanel.default&quot;</span> </span></code></pre></div>
<ul>
<li>29 nonNull values for one little plot!<br />
</li>
<li>Note that a <em>lot of them</em> are <em>like the ones we saw</em>
in the <code>base</code> plotting system.</li>
</ul>
<p>Let’s look at the <strong>values of some of them</strong>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>p[[<span class="st">&quot;formula&quot;</span>]]</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>Ozone <span class="sc">~</span> Wind</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>p[[<span class="st">&quot;x.limits&quot;</span>]]                  <span class="co"># range of the x values</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>]  <span class="fl">0.37</span> <span class="fl">22.03</span></span></code></pre></div>
</div>
<div id="lattice-panel-functions." class="section level2" number="1.7">
<h2><span class="header-section-number">1.7</span> Lattice panel
functions.</h2>
<ul>
<li><p>Lattice functions have a <strong>panel function</strong> which
controls what happens inside <em>each panel</em> of the plot.</p></li>
<li><p>The <code>lattice</code> package comes with <em>default panel
functions</em>, but we can supply our own if you want to
<em>customize</em> what happens in each panel.</p></li>
<li><p>Panel functions receive the <strong>x/y coordinates</strong> of
the data points <strong>in their</strong> <strong>panel</strong> (along
with any optional arguments).</p>
<ul>
<li><p>Each panel’s going to represent a subset of the data, which is
defined by the conditioning variable that we give it.</p></li>
<li><p>So, for each panel, the panel function will get the x/y
coordinates of the points that are in that panel.</p></li>
</ul></li>
</ul>
<div
id="an-example-of-a-custom-panel-function-given-to-the-panel-argument-adding-a-median-line-in-each-panel."
class="section level3" number="1.7.1">
<h3><span class="header-section-number">1.7.1</span> An example of a
custom panel function given to the <code>panel</code> argument (adding a
median line in each panel).</h3>
<p>Let’s start making a <em>plot with two panels</em> (using a
conditioning factor variable with two levels).</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">each =</span> <span class="dv">50</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(f)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>f</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a> <span class="dv">0</span>  <span class="dv">1</span> </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="dv">50</span> <span class="dv">50</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> x <span class="sc">+</span> f <span class="sc">-</span> f <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">sd =</span> <span class="fl">0.5</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">factor</span>(f, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Group 1&quot;</span>, <span class="st">&quot;Group 2&quot;</span>))</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(f)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>f</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>Group <span class="dv">1</span> Group <span class="dv">2</span> </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>     <span class="dv">50</span>      <span class="dv">50</span> </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(y <span class="sc">~</span> x <span class="sc">|</span> f, <span class="at">layout =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))  <span class="do">## Plot with 2 panels</span></span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-11-1.png" width="768" /></p>
<ul>
<li>Note that <em>we’re not providing</em> an explicit <em>data</em>
argument, so <code>xyplot</code> will look in the environment for
<code>y</code>, <code>x</code> and <code>f</code>.<br />
</li>
<li>In Group 1, it looks like a strong linear relationship.<br />
</li>
<li>In Group 2, it looks like there’s no relationship.</li>
</ul>
<p>Now let’s <strong>call a custom panel function</strong>, via the
<code>panel</code> argument:</p>
<ul>
<li>We give to that argument a function whose first two arguments are
<code>x</code> and <code>y</code>, and then followed by an
<code>ellipis</code> (any other arguments that may get passed).</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Custom panel function</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(y <span class="sc">~</span> x <span class="sc">|</span> f, <span class="at">panel =</span> <span class="cf">function</span>(x, y, ...) {</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">panel.xyplot</span>(x, y, ...)  <span class="do">## First call the default panel function for &#39;xyplot&#39;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">panel.abline</span>(<span class="at">h =</span> <span class="fu">median</span>(y), <span class="at">lty =</span> <span class="dv">2</span>)  <span class="do">## Add a horizontal line at the median</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<ul>
<li>In our custom panel function, the first thing we do is <strong>call
the default</strong> <code>xyplot</code> <strong>panel function</strong>
<em>to make the points, the axis labels, etc appear</em> in <em>each
panel</em>.<br />
</li>
<li>Then our <em>customization</em> is just <em>addign a horizontal
-dashed- line at each panel</em>, which is the median of the y values in
that panel.</li>
</ul>
</div>
<div id="another-example-adding-a-regression-line-in-each-panel."
class="section level3" number="1.7.2">
<h3><span class="header-section-number">1.7.2</span> Another example:
adding a regression line in each panel.</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Custom panel function</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(y <span class="sc">~</span> x <span class="sc">|</span> f, <span class="at">panel =</span> <span class="cf">function</span>(x, y, ...) {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>               <span class="fu">panel.xyplot</span>(x, y, ...)  <span class="do">## First call default panel function</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>               <span class="fu">panel.lmline</span>(x, y, <span class="at">col =</span> <span class="dv">2</span>)  <span class="do">## Overlay a simple linear regression line</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>       })</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<ul>
<li>The regression line shows us the <em>linear relationship</em>
between <code>x</code> and <code>y</code> <em>within</em> <em>each of
the panels</em>.<br />
</li>
<li>The <code>panel.lmline()</code> function adds the regression line to
the panel.</li>
</ul>
</div>
</div>
<div id="many-panel-lattice-plot" class="section level2" number="1.8">
<h2><span class="header-section-number">1.8</span> Many panel lattice
plot</h2>
<div id="maacs-example." class="section level3" number="1.8.1">
<h3><span class="header-section-number">1.8.1</span> MAACS example.</h3>
<p>As a final example, let’s take this very large dataset:</p>
<p><a href="http://www.ncbi.nlm.nih.gov/pubmed/23810154">Ahluwalia et
al., <em>Journal of Allergy and Clinical Immunology</em>, 2013</a></p>
<ul>
<li><em>Study</em>:
<ul>
<li>Mouse Allergen and Asthma Cohort Study (MAACS).<br />
</li>
</ul></li>
<li><em>Study subjects</em>:
<ul>
<li>The study was aimed at characterizing the indoor (home) environment
and its relationship with asthma morbidity amonst children aged 5–17
living in Baltimore. The children all had persistent asthma, defined as
having had an exacerbation in the past year.<br />
</li>
</ul></li>
<li><em>Design</em>:
<ul>
<li>Observational study, baseline home visit every 3 months for a year
(so for a total of 5 visits for a year: the initial visit -number zero-,
and other 4 visits every 3 month -visits number one, two, three and
four).<br />
</li>
</ul></li>
<li><em>Question</em>:
<ul>
<li>How does indoor airborne mouse allergen vary over time and across
subjects?<br />
</li>
<li>So what we want to do is basically <strong>make a plot</strong> of
the <em>airborne indoor mouse</em> <em>allergen</em> for <em>every
subject</em> for <em>every visit</em>.
<ul>
<li>There are 150 subjects in this data set, and they each have five
visits.<br />
</li>
<li>So there are going to be <strong>750 data points</strong> here that
we want to look at.</li>
</ul></li>
</ul></li>
</ul>
<p>And a very easy way to see that is use <code>xyplot</code> and use a
<em>multi-panel lattice plot</em>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>env <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;4_data/maacs_env.rds&quot;</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>env <span class="ot">&lt;-</span> <span class="fu">transform</span>(env, <span class="at">MxNum =</span> <span class="fu">factor</span>(MxNum))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(<span class="fu">log2</span>(airmus) <span class="sc">~</span> VisitNum <span class="sc">|</span> MxNum, <span class="at">data =</span> env,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">strip =</span> <span class="cn">FALSE</span>, <span class="at">pch =</span> <span class="dv">20</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&quot;Visit Number&quot;</span>, <span class="at">ylab =</span> <span class="fu">expression</span>(Log[<span class="dv">2</span>] <span class="sc">*</span> <span class="st">&quot; Airborne Mouse Allergen&quot;</span>),</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;Mouse Allergen and Asthma Cohort Study (Baltimore City)&quot;</span>)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-14-1.png" width="1152" /></p>
<ul>
<li>The panels are all the subjects in the study, each with their
airborne mouse allergen levels (the log of their airborne mouse allergen
levels).<br />
</li>
<li>We can see the variation within a person, within each panel; we can
see that their allergen levels can go up or down, or can vary from visit
to visit.
<ul>
<li>Some subjects have a lot of variations, so they go up and down a lot
between visits. And some have almost no variation at all, and every
visit is the same level of mouse allergen.<br />
</li>
<li>So we may or may not want to follow up on some of these patterns,
depending on what exactly we’re interested in.<br />
</li>
</ul></li>
<li>We can see the variation across subjects.
<ul>
<li>Some people have just very high levels, and some people just have
generally lower levels (kind of cross sectional variation).<br />
</li>
</ul></li>
<li>We can see that a number of people have missing values, so not
everyone has five values, some people only have two values or one value.
<ul>
<li>So it may be useful to follow up on those subjects to see why this
subject only have four values or three values.</li>
</ul></li>
</ul>
<blockquote>
<p>In <strong>conclusion</strong>: with essentially one or two function
call, we can make a massive plot like this, look at a lot of data
without having to go through a lot of code.</p>
</blockquote>
</div>
<div id="diamonds-example." class="section level3" number="1.8.2">
<h3><span class="header-section-number">1.8.2</span> Diamonds
example.</h3>
<p>The <code>diamonds</code> dataset comes with the <code>ggplot2</code>
package, so we load this package here to make that dataset
available.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(diamonds)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>tibble [<span class="dv">53</span>,<span class="dv">940</span> × <span class="dv">11</span>] (S3<span class="sc">:</span> tbl_df<span class="sc">/</span>tbl<span class="sc">/</span>data.frame)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> carat  <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="fl">0.23</span> <span class="fl">0.21</span> <span class="fl">0.23</span> <span class="fl">0.29</span> <span class="fl">0.31</span> <span class="fl">0.24</span> <span class="fl">0.24</span> <span class="fl">0.26</span> <span class="fl">0.22</span> <span class="fl">0.23</span> ...</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> cut    <span class="sc">:</span> Ord.factor w<span class="sc">/</span> <span class="dv">5</span> levels <span class="st">&quot;Fair&quot;</span><span class="sc">&lt;</span><span class="st">&quot;Good&quot;</span><span class="sc">&lt;</span>..<span class="sc">:</span> <span class="dv">5</span> <span class="dv">4</span> <span class="dv">2</span> <span class="dv">4</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">1</span> <span class="dv">3</span> ...</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> color  <span class="sc">:</span> Ord.factor w<span class="sc">/</span> <span class="dv">7</span> levels <span class="st">&quot;D&quot;</span><span class="sc">&lt;</span><span class="st">&quot;E&quot;</span><span class="sc">&lt;</span><span class="st">&quot;F&quot;</span><span class="sc">&lt;</span><span class="st">&quot;G&quot;</span><span class="sc">&lt;</span>..<span class="sc">:</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">7</span> <span class="dv">6</span> <span class="dv">5</span> <span class="dv">2</span> <span class="dv">5</span> ...</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> clarity<span class="sc">:</span> Ord.factor w<span class="sc">/</span> <span class="dv">8</span> levels <span class="st">&quot;I1&quot;</span><span class="sc">&lt;</span><span class="st">&quot;SI2&quot;</span><span class="sc">&lt;</span><span class="st">&quot;SI1&quot;</span><span class="sc">&lt;</span>..<span class="sc">:</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">5</span> <span class="dv">4</span> <span class="dv">2</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span> ...</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> depth  <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="fl">61.5</span> <span class="fl">59.8</span> <span class="fl">56.9</span> <span class="fl">62.4</span> <span class="fl">63.3</span> <span class="fl">62.8</span> <span class="fl">62.3</span> <span class="fl">61.9</span> <span class="fl">65.1</span> <span class="fl">59.4</span> ...</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> table  <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="dv">55</span> <span class="dv">61</span> <span class="dv">65</span> <span class="dv">58</span> <span class="dv">58</span> <span class="dv">57</span> <span class="dv">57</span> <span class="dv">55</span> <span class="dv">61</span> <span class="dv">61</span> ...</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> price  <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="dv">326</span> <span class="dv">326</span> <span class="dv">327</span> <span class="dv">334</span> <span class="dv">335</span> <span class="dv">336</span> <span class="dv">336</span> <span class="dv">337</span> <span class="dv">337</span> <span class="dv">338</span> ...</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> x      <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="fl">3.95</span> <span class="fl">3.89</span> <span class="fl">4.05</span> <span class="fl">4.2</span> <span class="fl">4.34</span> <span class="fl">3.94</span> <span class="fl">3.95</span> <span class="fl">4.07</span> <span class="fl">3.87</span> <span class="dv">4</span> ...</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> y      <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="fl">3.98</span> <span class="fl">3.84</span> <span class="fl">4.07</span> <span class="fl">4.23</span> <span class="fl">4.35</span> <span class="fl">3.96</span> <span class="fl">3.98</span> <span class="fl">4.11</span> <span class="fl">3.78</span> <span class="fl">4.05</span> ...</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> z      <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="fl">2.43</span> <span class="fl">2.31</span> <span class="fl">2.31</span> <span class="fl">2.63</span> <span class="fl">2.75</span> <span class="fl">2.48</span> <span class="fl">2.47</span> <span class="fl">2.53</span> <span class="fl">2.49</span> <span class="fl">2.39</span> ...</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> car2   <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">3</span> levels <span class="st">&quot;(0.2,0.5]&quot;</span>,<span class="st">&quot;(0.5,1]&quot;</span>,..<span class="sc">:</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(diamonds<span class="sc">$</span>color)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    D     E     F     G     H     I     J </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a> <span class="dv">6775</span>  <span class="dv">9797</span>  <span class="dv">9542</span> <span class="dv">11292</span>  <span class="dv">8304</span>  <span class="dv">5422</span>  <span class="dv">2808</span> </span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(diamonds<span class="sc">$</span>color, diamonds<span class="sc">$</span>cut)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    Fair Good Very Good Premium Ideal</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  D  <span class="dv">163</span>  <span class="dv">662</span>      <span class="dv">1513</span>    <span class="dv">1603</span>  <span class="dv">2834</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  E  <span class="dv">224</span>  <span class="dv">933</span>      <span class="dv">2400</span>    <span class="dv">2337</span>  <span class="dv">3903</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  F  <span class="dv">312</span>  <span class="dv">909</span>      <span class="dv">2164</span>    <span class="dv">2331</span>  <span class="dv">3826</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  G  <span class="dv">314</span>  <span class="dv">871</span>      <span class="dv">2299</span>    <span class="dv">2924</span>  <span class="dv">4884</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  H  <span class="dv">303</span>  <span class="dv">702</span>      <span class="dv">1824</span>    <span class="dv">2360</span>  <span class="dv">3115</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  I  <span class="dv">175</span>  <span class="dv">522</span>      <span class="dv">1204</span>    <span class="dv">1428</span>  <span class="dv">2093</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  J  <span class="dv">119</span>  <span class="dv">307</span>       <span class="dv">678</span>     <span class="dv">808</span>   <span class="dv">896</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(price <span class="sc">~</span> carat <span class="sc">|</span> color <span class="sc">*</span> cut, <span class="at">data =</span> diamonds,</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">strip =</span> <span class="cn">FALSE</span>, <span class="at">pch =</span> <span class="dv">20</span>,</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&quot;Carat&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Price&quot;</span>,</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;Diamonds are Sparkly!&quot;</span>)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<ul>
<li>35 panels, one for each combination of color and cut.<br />
</li>
<li>The dots show how prices for the diamonds in each category (panel)
vary depending on carat.</li>
</ul>
</div>
<div id="the-strip-argument." class="section level3" number="1.8.3">
<h3><span class="header-section-number">1.8.3</span> The
<code>strip</code> argument.</h3>
<p>This argument <em>labels each panel</em>, so it can be kind of
inconvinient to allow labels in a graphic with many many panels.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(price <span class="sc">~</span> carat <span class="sc">|</span> color <span class="sc">*</span> cut, <span class="at">data =</span> diamonds,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&quot;Carat&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Price&quot;</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;Diamonds are Sparkly!&quot;</span>)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<hr />
</div>
</div>
</div>
<div id="plotting-and-color-in-r." class="section level1" number="2">
<h1><span class="header-section-number">2</span> Plotting and Color in
R.</h1>
<p>This is a <em>add-on</em> section to the <code>basic</code> and
<code>lattice</code> plotting systems.</p>
<ul>
<li>It really supplements plotting with those packages which contain
functions that are able to take the argument <code>col</code>.</li>
</ul>
<p>The <strong>default color schemes</strong> for most plots in R are
<strong><em>horrendous</em></strong>.</p>
<p>R has much <strong>better ways for handling the specification of
colors</strong> in plots and graphs and we should make use of them when
possible.</p>
<ul>
<li>But, in order to do that, it’s important to know a little about
<strong>how colors</strong> <strong>work in R</strong>.</li>
</ul>
<div id="colors-1-2-and-3." class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Colors 1, 2 and
3.</h2>
<p>Quite often, with plots made in R, you’ll see something like the
following Christmas- themed plot.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">19</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">30</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">30</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">col =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">each =</span> <span class="dv">10</span>), <span class="at">pch =</span> <span class="dv">19</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend =</span> <span class="fu">paste</span>(<span class="st">&quot;Group&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<ul>
<li>The reason is simple. In R:
<ul>
<li>the <em>black</em> color is denoted by <code>col = 1</code> in most
plotting functions;<br />
</li>
<li>the <em>red</em> color is denoted by <code>col = 2</code>, and<br />
</li>
<li>the <em>green</em> color is denoted by <code>col = 3</code>.<br />
</li>
</ul></li>
<li>So if we’re plotting multiple groups of things, it’s natural to plot
them using colors 1, 2, and 3 (<code>col = 1:3</code> or
<code>col = c(1:3)</code>.</li>
</ul>
</div>
<div
id="another-set-of-common-color-schemes-heat.colors-and-topo.colors-functions."
class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Another set of common
color schemes: <code>heat.colors()</code> and <code>topo.colors()</code>
functions.</h2>
<p>Here’s <strong>another set of common color schemes</strong> used in
R, this time via the <code>image()</code> function.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(volcano, <span class="at">col =</span> <span class="fu">heat.colors</span>(<span class="dv">10</span>), <span class="at">main =</span> <span class="st">&quot;heat.colors()&quot;</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(volcano, <span class="at">col =</span> <span class="fu">topo.colors</span>(<span class="dv">19</span>), <span class="at">main =</span> <span class="st">&quot;topo.colors()&quot;</span>)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<ul>
<li>These are <strong>two color palettes</strong> that come with the
<code>grDevices</code> package available to us.<br />
</li>
<li>The left shows you some colors from the function
<code>heat.colors</code>.
<ul>
<li>Here <em>low values</em> are represented in <em>red</em> and as the
values increase the colors move through yellow towards white.<br />
</li>
<li>This is consistent with the <em>physical properties of
fire</em>.<br />
</li>
</ul></li>
<li>The right display is from the function <code>topo.colors</code>.
<ul>
<li>It uses topographical colors ranging <em>from blue</em> (low values)
<em>towards brown</em> (higher values).</li>
</ul></li>
</ul>
</div>
<div id="connecting-colors-with-data." class="section level2"
number="2.3">
<h2><span class="header-section-number">2.3</span> Connecting colors
with data.</h2>
<p>Typically we add color to a plot, not to improve its artistic value,
but to <strong>add</strong> <strong>another dimension</strong> to the
visualization (i.e. to <a
href="http://www.edwardtufte.com/tufte/books_vdqi">escape
flatland</a>).</p>
<p>Therefore, it makes sense that the <strong>range and palette of
colors</strong> we use will depend on the <strong>kind of data</strong>
you are plotting.</p>
<ul>
<li>While it may be common to just choose colors at random,
<strong>choosing the colors</strong> for our plot should require
<em>careful consideration</em>.<br />
</li>
<li>Because careful choices of plotting color can have an <em>impact on
how people interpret</em> our data and draw conclusions from them.</li>
</ul>
</div>
<div id="color-utilities-in-r." class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Color utilities in
R.</h2>
<p>R has a number of utilities for dealing with colors and color
palettes in our plots.</p>
<p>For <em>starters</em>, the <code>grDevices</code> package has two
functions:</p>
<ul>
<li><code>colorRamp()</code>:
<ul>
<li>It <strong>takes</strong> a <em>palette of colors</em>.<br />
</li>
<li>And <strong>returns</strong> a <em>function</em> that takes
<em>values between 0 and 1</em>:
<ul>
<li>The <code>0</code> and <code>1</code> correspond to the <em>extremes
of the color palette</em>.<br />
</li>
<li>Arguments <code>between 0 and 1</code> return <em>blends of these
extremes</em>.<br />
</li>
</ul></li>
<li>A <strong>similar function</strong> that already exists in R is the
<strong><code>gray()</code></strong> function.
<ul>
<li>The <code>gray()</code> function interpolates between black and
white, it gives us all the shades of gray between black and white.<br />
</li>
</ul></li>
<li>The <code>colorRamp()</code> function is <strong>a
generalization</strong> of the <code>gray()</code> function because it
will take any set of colors in our palette and it will give us a
function back that takes numbers between 0 and 1 to interpolate between
the extremes of the color palette.<br />
</li>
</ul></li>
<li><code>colorRampPalette()</code>:
<ul>
<li>It <strong>takes</strong> a <em>palette of colors</em>.<br />
</li>
<li>And <strong>returns</strong> a <em>function</em> that <em>takes
integer argument and returns a vector</em> <em>of colors interpolating
the palette</em>.<br />
</li>
<li>So it’s similar to the <code>heat.colors()</code> or
<code>topo.colors()</code> functions.<br />
</li>
</ul></li>
<li><strong>Both</strong> of these functions take palettes of colors and
<em>help to interpolate</em> between the colors on the palette.
<ul>
<li>Imagine you’re a painter and you have your palette in your
hand.<br />
</li>
<li>On your palette are a set of colors, say red and blue.<br />
</li>
<li>Now, between red and blue you can a imagine an entire spectrum of
colors that can be created by mixing together different amounts of read
and blue.<br />
</li>
<li>Both <code>colorRamp()</code> and <code>colorRampPalette()</code>
handle that “mixing” process for you.<br />
</li>
</ul></li>
<li>They <strong>differ only</strong> in the <em>type of object that
they return</em>.</li>
</ul>
<p>Finally, <strong>the function <code>colors()</code></strong> lists
the <em>names of colors</em> we can use in any plotting function.</p>
<ul>
<li>There are <em>657 predifined colors</em> we can use in any plotting
function.</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">colors</span>(), <span class="dv">10</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">&quot;lightsalmon3&quot;</span>         <span class="st">&quot;grey97&quot;</span>               <span class="st">&quot;grey6&quot;</span>               </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a> [<span class="dv">4</span>] <span class="st">&quot;lightyellow1&quot;</span>         <span class="st">&quot;deeppink&quot;</span>             <span class="st">&quot;goldenrod3&quot;</span>          </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a> [<span class="dv">7</span>] <span class="st">&quot;navajowhite4&quot;</span>         <span class="st">&quot;paleturquoise&quot;</span>        <span class="st">&quot;palevioletred1&quot;</span>      </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">10</span>] <span class="st">&quot;lightgoldenrodyellow&quot;</span></span></code></pre></div>
<div id="colorramp." class="section level3" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span>
<code>colorRamp()</code>.</h3>
<p>Let’s start with a simple palette of “red” and “blue” colors.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">colorRamp</span>(<span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>))            <span class="co"># pal is a function.</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>pal</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> (x) </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">roundcolor</span>(<span class="fu">cbind</span>(palette[[1L]](x), palette[[2L]](x), palette[[3L]](x), </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (alpha) palette[[4L]](x))) <span class="sc">*</span> <span class="dv">255</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>bytecode<span class="sc">:</span> <span class="dv">0x55ab965aa398</span><span class="sc">&gt;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;</span>environment<span class="sc">:</span> <span class="dv">0x55ab965ad438</span><span class="sc">&gt;</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># red.</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="fu">pal</span>(<span class="dv">0</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>     [,<span class="dv">1</span>] [,<span class="dv">2</span>] [,<span class="dv">3</span>]</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,]  <span class="dv">255</span>    <span class="dv">0</span>    <span class="dv">0</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co"># blue.</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="fu">pal</span>(<span class="dv">1</span>)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>     [,<span class="dv">1</span>] [,<span class="dv">2</span>] [,<span class="dv">3</span>]</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,]    <span class="dv">0</span>    <span class="dv">0</span>  <span class="dv">255</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co"># purple-ish</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="fu">pal</span>(<span class="fl">0.5</span>)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>      [,<span class="dv">1</span>] [,<span class="dv">2</span>]  [,<span class="dv">3</span>]</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,] <span class="fl">127.5</span>    <span class="dv">0</span> <span class="fl">127.5</span></span></code></pre></div>
<ul>
<li>So, <code>pal</code> is in fact a <strong>function that was
returned</strong> by <code>colorRamp()</code>.<br />
</li>
<li>When we call <code>pal(0)</code> we get a <em>1 by 3
matrix</em>.<br />
</li>
<li>The numbers in the matrix will <em>range from 0 to 255</em> and
indicate the <strong>quantities</strong> of <em>red</em>, <em>green</em>
and <em>blue</em> (RGB) in columns <em>1</em>, <em>2</em> and
<em>3</em>, respectively.<br />
</li>
<li><strong>RGB color encoding</strong> is commonly used in televisions
and monitors.
<ul>
<li>In R, <em>24 bits</em> are used to represent colors.<br />
</li>
<li>Think of these 24 bits as <em>3 sets of 8 bits</em>, <em>each of
which</em> represents an <em>intensity for one of the colors</em> red,
green, and blue.<br />
</li>
</ul></li>
<li>Simple math tells us there are <em>over 16 million colors</em> that
can be expressed in this way.<br />
</li>
<li>Calling <code>pal(0)</code> gives us the <strong>maximum value (255)
on red</strong> and 0 on the other colors. So this is just the color
red.</li>
</ul>
<p>We <strong>can pass</strong> <em>any value between 0 and 1</em> to
the <code>pal()</code> function.</p>
<p>We <strong>can also pass</strong> a <em>sequence of numbers</em> to
the <code>pal()</code> function.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pal</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">len =</span> <span class="dv">10</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>           [,<span class="dv">1</span>] [,<span class="dv">2</span>]      [,<span class="dv">3</span>]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>,] <span class="fl">255.00000</span>    <span class="dv">0</span>   <span class="fl">0.00000</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a> [<span class="dv">2</span>,] <span class="fl">226.66667</span>    <span class="dv">0</span>  <span class="fl">28.33333</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a> [<span class="dv">3</span>,] <span class="fl">198.33333</span>    <span class="dv">0</span>  <span class="fl">56.66667</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a> [<span class="dv">4</span>,] <span class="fl">170.00000</span>    <span class="dv">0</span>  <span class="fl">85.00000</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a> [<span class="dv">5</span>,] <span class="fl">141.66667</span>    <span class="dv">0</span> <span class="fl">113.33333</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a> [<span class="dv">6</span>,] <span class="fl">113.33333</span>    <span class="dv">0</span> <span class="fl">141.66667</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a> [<span class="dv">7</span>,]  <span class="fl">85.00000</span>    <span class="dv">0</span> <span class="fl">170.00000</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a> [<span class="dv">8</span>,]  <span class="fl">56.66667</span>    <span class="dv">0</span> <span class="fl">198.33333</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a> [<span class="dv">9</span>,]  <span class="fl">28.33333</span>    <span class="dv">0</span> <span class="fl">226.66667</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>[<span class="dv">10</span>,]   <span class="fl">0.00000</span>    <span class="dv">0</span> <span class="fl">255.00000</span></span></code></pre></div>
<ul>
<li>We see that the i-th row (for i=1,…,10) differs from the (i-1)-st
row in the following way.
<ul>
<li>Its red entry is 28,3333 = 255/9 points lower and its blue entry is
28,3333 points higher.<br />
</li>
<li>In this example none of pal’s outputs will ever contain green since
it wasn’t in our initial palette.<br />
</li>
</ul></li>
<li>The idea here is that <code>colorRamp()</code> <em>gives us a
function</em> that allows us to <em>interpolate</em> between the two
colors red and blue.</li>
</ul>
<p>We do not have to provide just two colors in our initial color
palette.</p>
<ul>
<li><strong>We can start with multiple colors</strong> and
<code>colorRamp()</code> will interpolate between all of them.</li>
</ul>
</div>
<div id="colorramppallete." class="section level3" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span>
<code>colorRampPallete()</code>.</h3>
<p>The <code>colorRampPalette()</code> function is similar to
<code>colorRamp()</code>, however <strong>the function</strong> that
<strong>it returns</strong> gives us a <em>fixed number of colors that
interpolate the palette</em>.</p>
<ul>
<li>The <strong>function returned</strong> by
<code>colorRampPallete()</code>, <em>takes an integer</em> argument
specifing the number of interpolated colors to return.</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;yellow&quot;</span>))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>pal</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> (n) </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">ramp</span>(<span class="fu">seq.int</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> n))</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">ncol</span>(x) <span class="sc">==</span> 4L) </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rgb</span>(x[, 1L], x[, 2L], x[, 3L], x[, 4L], <span class="at">maxColorValue =</span> <span class="dv">255</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="fu">rgb</span>(x[, 1L], x[, 2L], x[, 3L], <span class="at">maxColorValue =</span> <span class="dv">255</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>bytecode<span class="sc">:</span> <span class="dv">0x55ab96ae8fb0</span><span class="sc">&gt;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;</span>environment<span class="sc">:</span> <span class="dv">0x55ab96aebc60</span><span class="sc">&gt;</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Just return red an yellow (the extremes of the pallete).</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="fu">pal</span>(<span class="dv">2</span>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;#FF0000&quot;</span> <span class="st">&quot;#FFFF00&quot;</span></span></code></pre></div>
<ul>
<li><strong>Each element</strong> of the returned vector is a <em>24 bit
number</em>, represented <em>as 6</em> <em>hexadecimal characters</em>,
which range from 0 to F. This set of 6 hex characters represents the
<em>intensities</em> of <em>red</em>, <em>green</em> and <em>blue</em>,
2 characters for each color after the # symbol:
<ul>
<li>the <em>first two</em> characters indicate the <strong>red
amount</strong>;</li>
<li>the <em>second two</em> the <strong>green amount</strong>, and<br />
</li>
<li>the <em>last two</em> the <strong>blue amount</strong>.<br />
</li>
</ul></li>
<li>Because <strong>each position</strong> can have <em>16 possible
values</em> (0-9 and A-F), the two positions together allow for <em>256
possibilities per color</em>.<br />
</li>
<li>In this example above, since we only asked for two colors, it gave
us red and yellow, the two extremes of the palette.</li>
</ul>
<p>We can ask for more colors though.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Return 10 colors between red an yellow.</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pal</span>(<span class="dv">10</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">&quot;#FF0000&quot;</span> <span class="st">&quot;#FF1C00&quot;</span> <span class="st">&quot;#FF3800&quot;</span> <span class="st">&quot;#FF5500&quot;</span> <span class="st">&quot;#FF7100&quot;</span> <span class="st">&quot;#FF8D00&quot;</span> <span class="st">&quot;#FFAA00&quot;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a> [<span class="dv">8</span>] <span class="st">&quot;#FFC600&quot;</span> <span class="st">&quot;#FFE200&quot;</span> <span class="st">&quot;#FFFF00&quot;</span></span></code></pre></div>
<ul>
<li>The first color is still red (“FF” in the red position) and the last
color is still yellow (“FF” in both the red and green positions).<br />
</li>
<li>But now there are 8 more colors in between.</li>
</ul>
<p>These values, in hexadecimal format, can also be specified to base
plotting functions via the col argument.</p>
</div>
<div id="rgb" class="section level3" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span>
<code>rgb()</code></h3>
<p>The heart of the function returned by <code>colorRamp()</code> and
<code>colorRampPalette()</code>is really the call to the function
<code>rgb()</code>.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rgb)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> (red, green, blue, alpha, <span class="at">names =</span> <span class="cn">NULL</span>, <span class="at">maxColorValue =</span> <span class="dv">1</span>)  </span></code></pre></div>
<ul>
<li>The <code>rgb()</code> function can be used to <em>produce any
color</em> via red, green, blue proportions (numbers between 0 and 1)
and <em>return a hexadecimal representation</em>.<br />
</li>
<li>That hexadecimal representation can be passed to other functions,
like <code>image()</code> or <code>plot()</code>.</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">234</span>, <span class="at">maxColorValue =</span> <span class="dv">255</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;#0000EA&quot;</span></span></code></pre></div>
</div>
</div>
<div id="rcolorbrewer-package." class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span>
<code>RColorBrewer</code> package.</h2>
<p>Part of the art of creating good color schemes in data graphics is to
<strong>start with an</strong> <strong>appropriate color
palette</strong> that you can <strong>then interpolate</strong> with a
function like <code>colorRamp()</code> or
<code>colorRampPalette()</code>.</p>
<p>One package on CRAN that contains <strong>interesting and useful
color palettes</strong> is the <a
href="http://cran.r-project.org/package=RColorBrewer"><code>RColorBrewer</code>
package</a>.</p>
<p>This packge offers <strong>three types of palettes</strong>:</p>
<ul>
<li><strong>Sequential</strong>:
<ul>
<li>for numerical data that are ordered.<br />
</li>
</ul></li>
<li><strong>Diverging</strong>:
<ul>
<li>for numerical data that can be positive or negative, often
representing deviations from some norm or baseline.<br />
</li>
</ul></li>
<li><strong>Qualitative</strong>:
<ul>
<li>for qualitative unordered data.</li>
</ul></li>
</ul>
<p>All of these palettes <strong><em>can be used in
conjunction</em></strong> with the <code>colorRamp()</code> and
<code>colorRampPalette()</code>.</p>
<p>Here is a display of <em>all the color palettes available</em> from
the <code>RColorBrewer</code> package.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">display.brewer.all</span>()</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<ul>
<li>The <strong>top section</strong> shows the <em>sequential
palettes</em> in which the colors are <em>ordered from light to
dark</em>.<br />
</li>
<li>The <em>divergent palettes</em> are <strong>at the bottom</strong>.
Here the <em>neutral color</em> (white) is <em>in the center</em>, and
as we move from the middle to the two ends of each palette, the colors
increase in intensity.<br />
</li>
<li>The <strong>middle display</strong> shows the <em>qualitative
palettes</em> which look like collections of <em>random colors</em>.
These might be used <em>to distinguish factors</em> in our data.</li>
</ul>
<div id="using-the-rcolorbrewer-palletes-brewer.pal-function."
class="section level3" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Using the
<code>RColorBrewer</code> palletes: <code>brewer.pal()</code>
function.</h3>
<p>The <strong>only real function</strong> in the
<code>RColorBrewer</code> package is the <code>brewer.pal()</code>
function which has two arguments:</p>
<ul>
<li><code>n</code>:
<ul>
<li>the number of colors we want from the palette (integer);<br />
</li>
<li>this is <em>usually small</em>, it’ll be 2, 3 or 4. We don’t need
many blotches on our palette for the primary colors.<br />
</li>
</ul></li>
<li><code>name</code>:
<ul>
<li>the name of the color palette we want to use.</li>
</ul></li>
</ul>
<p>Below we choose to use <em>3 colors</em> from the <em>“BuGn”
palette</em>, which is a sequential palette.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="dv">3</span>, <span class="st">&quot;BuGn&quot;</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>cols</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;#E5F5F9&quot;</span> <span class="st">&quot;#99D8C9&quot;</span> <span class="st">&quot;#2CA25F&quot;</span></span></code></pre></div>
<p>So, <strong><em>those three colors make up our initial
palette</em></strong>.</p>
<p>Then we can <strong>pass them</strong> to
<code>colorRampPalette()</code> to create our
<strong>interpolating</strong> <strong>function</strong>.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(cols)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># extremes.</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pal</span>(<span class="dv">2</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;#E5F5F9&quot;</span> <span class="st">&quot;#2CA25F&quot;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># our three initial colors.</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="fu">pal</span>(<span class="dv">3</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;#E5F5F9&quot;</span> <span class="st">&quot;#99D8C9&quot;</span> <span class="st">&quot;#2CA25F&quot;</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 20 colors.</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="fu">pal</span>(<span class="dv">20</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">&quot;#E5F5F9&quot;</span> <span class="st">&quot;#DDF1F3&quot;</span> <span class="st">&quot;#D5EEEE&quot;</span> <span class="st">&quot;#CDEBE9&quot;</span> <span class="st">&quot;#C5E8E4&quot;</span> <span class="st">&quot;#BDE5DF&quot;</span> <span class="st">&quot;#B5E2DA&quot;</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a> [<span class="dv">8</span>] <span class="st">&quot;#ADDFD5&quot;</span> <span class="st">&quot;#A4DCD0&quot;</span> <span class="st">&quot;#9DD9CB&quot;</span> <span class="st">&quot;#93D5C3&quot;</span> <span class="st">&quot;#87CFB8&quot;</span> <span class="st">&quot;#7CC9AD&quot;</span> <span class="st">&quot;#70C4A1&quot;</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>[<span class="dv">15</span>] <span class="st">&quot;#65BE96&quot;</span> <span class="st">&quot;#59B88B&quot;</span> <span class="st">&quot;#4EB380&quot;</span> <span class="st">&quot;#42AD75&quot;</span> <span class="st">&quot;#37A76A&quot;</span> <span class="st">&quot;#2CA25F&quot;</span></span></code></pre></div>
<p>Now we can plot the <code>volcano</code> data using this color
ramp.</p>
<ul>
<li>Note that the volcano dataset contains <em>elevations of a
volcano</em>, which is continuous, ordered, numerical data, for which a
<strong>sequential palette</strong> is appropriate.</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(volcano, <span class="at">col =</span> <span class="fu">pal</span>(<span class="dv">20</span>))</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-29-1.png" width="480" /></p>
</div>
<div id="the-smoothscatter-function-for-very-large-datasets."
class="section level3" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> The
<code>smoothScatter()</code> function for very large datasets.</h3>
<p>A function that takes advantage of the color palettes in
<code>RColorBrewer</code> is the <code>smoothScatter()</code>
function.</p>
<ul>
<li><p>It is <strong>very useful</strong> for making scatterplots of
<em>very large datasets</em>, and we don’t want to just have a bunch of
dots on the screen that are overlapping each other.</p></li>
<li><p>It essentially <strong>gives us</strong> a <em>2-D histogram</em>
of the data <em>using a sequential</em> <em>palette</em>.</p>
<ul>
<li>By default, it uses the sequential “Blues” pallete.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">smoothScatter</span>(x, y)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-30-1.png" width="480" /></p>
</div>
</div>
<div
id="adding-transparency-alpha-parameter-to-rgb-colorramp-and-colorramppalette."
class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Adding transparency:
<code>alpha</code> parameter to <code>rgb()</code>,
<code>colorRamp()</code> and <code>colorRampPalette()</code>.</h2>
<p>Color transparency can be added via the <code>alpha</code> parameter
to produce color specifications with varying levels of transparency.</p>
<ul>
<li><code>alpha</code> represents an <em>opacity level</em>, that is,
how transparent should the colors be.</li>
</ul>
<p>When transparency is used we’ll notice an <strong>extra two
characters added</strong> to the <strong>right side</strong> of the
<strong>hexadecimal representation</strong>.</p>
<ul>
<li>There will be 8 positions instead of 6.<br />
</li>
<li>The hexadecimal representation of a color will have 32 bits (4
groups of 8 bits) instead of 32 bits (3 groups of 8 bits).</li>
</ul>
<p>For <em>example</em>, if we wanted the <em>color red</em> with a
<em>high level of transparency</em>, we could specify:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rgb</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.1</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;#FF00001A&quot;</span></span></code></pre></div>
<p>Or a <em>pallet of colors</em> with <em>transparency</em>:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>palt <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>), <span class="at">alpha =</span> .<span class="dv">5</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">palt</span>(<span class="dv">5</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;#0000FFFF&quot;</span> <span class="st">&quot;#003FBFFF&quot;</span> <span class="st">&quot;#007F7FFF&quot;</span> <span class="st">&quot;#00BF3FFF&quot;</span> <span class="st">&quot;#00FF00FF&quot;</span></span></code></pre></div>
<ul>
<li>Notice here values that can assume alpha: since <em>it was NOT
ZERO</em> in the call to <code>colorRampPalette()</code>, it gets the
<em>maximum FF value</em>.<br />
</li>
<li>The same result would happen if alpha had been set to
<em>TRUE</em>.<br />
</li>
<li>When it was 0 or FALSE (as in <em>previous calls to
<code>colorRampPalette()</code></em>) it was given the value 00 and
wasn’t shown.</li>
</ul>
<p>Transparency can be <strong>useful</strong> when you have plots with
a <strong>high density</strong> of points or lines.</p>
<p>For <em>example</em>, the scatterplot below has a lot of overplotted
points and it’s difficult to see what’s happening in the middle of the
plot region.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">2000</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">2000</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">pch =</span> <span class="dv">19</span>)         <span class="co"># The default is black: col = rgb(0, 0, 0)</span></span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-33-1.png" width="576" /></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, .<span class="dv">5</span>, .<span class="dv">5</span>))   <span class="co"># A nice mix of green and blue.</span></span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-33-2.png" width="576" /></p>
<p>If we <strong>add some transparency</strong> to the full circles, we
can get a better sense of the varying density of the points in the
plot.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.15</span>))</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-34-1.png" width="576" /></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, .<span class="dv">5</span>, .<span class="dv">5</span>, <span class="fl">0.13</span>))</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-34-2.png" width="576" /></p>
</div>
<div id="summary." class="section level2" number="2.7">
<h2><span class="header-section-number">2.7</span> Summary.</h2>
<ul>
<li><p>Careful use of colors in plots, images, maps and other data
graphics can make it easier for the reader to get what you’re trying to
say (why make it harder?).</p></li>
<li><p>The <code>RColorBrewer</code> package is an R package that
provides color palettes for sequential, categorical, and diverging
data.</p></li>
<li><p>The <code>colorRamp()</code> and <code>colorRampPalette()</code>
functions can be used in conjunction with color palettes to connect data
to colors.</p></li>
<li><p>Transparency can sometimes be used to clarify plots with many
points.</p></li>
</ul>
<hr />
</div>
</div>
<div id="the-ggplot2-plotting-system." class="section level1"
number="3">
<h1><span class="header-section-number">3</span> The ggplot2 plotting
system.</h1>
<div id="what-is-ggplot2" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> What is ggplot2?</h2>
<ul>
<li>It’s an implementation of <em>The Grammar of Graphics</em> as
described by Leland Wilkinson in his book.
<ul>
<li>Grammar of graphics represents an abstraction of graphics ideas and
objects, a very powerful concept to organize all kinds of data
graphics.<br />
</li>
<li>Think “verb”, “noun”, “adjective” for graphics.
<ul>
<li>The question is what are the verbs, nouns and adjectives of a data
graphic?<br />
</li>
<li>And the Grammar of Graphics describes those basic elements so that
we can put them together to make new types of graphics.<br />
</li>
</ul></li>
<li>It allows then for a “theory” of graphics on which to build new
graphics and graphics objects.
<ul>
<li>Just like we could take a verb and a noun and an adjective and make
a new sentence that maybe no one’s ever heard before, we could take the
grammar of graphics and put together various aspects of plots and make a
graphic that no one’s ever seen before.<br />
</li>
</ul></li>
<li>That’s what in general a grammar is useful for: allows for a more
compact summary of the base components of a language, and it allows us
to extend the language and to handle situations that we have not before
seen.<br />
</li>
<li>As Hadley Whickham says in his book, the basic idea is “Shorten the
distance from mind to page”.
<ul>
<li>If we have some data that we’re looking at, and we think of a way
that we want to visualize that data, we want to be able to rapidly take
those ideas and turn them into a picture on our screen.</li>
</ul></li>
</ul></li>
</ul>
<blockquote>
<p>“In brief, the grammar tells us that a statistical graphic is a
<strong>mapping</strong> from <em>data</em> to <em>aesthetic
attributes</em> (colour, shape, size) of <em>geometric objects</em>
(points, lines, bars). The plot <em>may also contain</em>
<strong>statistical transformations</strong> of the data and is
<strong>drawn on a specific coordinate system</strong>” - from
<em>ggplot2</em> book.</p>
</blockquote>
<ul>
<li><p>Until recently there was no specific implementation for Grammar
of Graphics in R, but <strong>Hadley Wickham</strong>, who when he was a
graduate student at Iowa State University, implemented the Grammar of
Graphics as an R package called <code>ggplot</code> and its current
implementation is called <code>ggplot2</code>.</p></li>
<li><p>It’s a “third” graphics system for R (along with
<code>base</code> and <code>lattice</code>).</p>
<ul>
<li>Combines the best of <code>base</code> and
<code>lattice</code>.<br />
</li>
<li>It allows for multipanel (conditioning) plots (as
<code>lattice</code> does) but also post facto annotation (as
<code>base</code> does), so we can add titles and labels.<br />
</li>
<li>It uses the low-level <code>grid</code> package (which comes with R)
to draw the graphics.</li>
</ul></li>
<li><p>Available from CRAN via <code>install.packages()</code>.</p></li>
<li><p>Web site: <a href="http://ggplot2.org"
class="uri">http://ggplot2.org</a> (better documentation).</p></li>
</ul>
<div
id="a-quick-example-to-show-the-descriptive-power-of-grammar-of-graphics."
class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> A quick example to
show the descriptive power of Grammar of Graphics.</h3>
<p>Consider the following plot made using <code>base</code>
graphics:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(airquality, {</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot</span>(Temp, Ozone)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines</span>(<span class="fu">loess.smooth</span>(Temp, Ozone))</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p>How would one describe the creation of this plot?</p>
<ul>
<li>Well, we could say that we called the <code>plot()</code>
function.<br />
</li>
<li>Then added a loess smoother by calling the <code>lines()</code>
function on the output of <code>loess.smooth()</code>.</li>
</ul>
<p>So it is difficult to “translate” a plot to others because there’s no
formal graphical language. The plot is just a series of R commands.</p>
<p>Here’s the same plot made using <code>ggplot2</code>:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(airquality, <span class="fu">aes</span>(Temp, Ozone)) <span class="sc">+</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">geom_smooth()</span><span class="st">`</span> using formula <span class="st">&#39;y ~ x&#39;</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">37</span> rows containing non<span class="sc">-</span>finite <span class="fu">values</span> (stat_smooth).</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">37</span> rows containing missing <span class="fu">values</span> (geom_point).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<ul>
<li><code>ggplot2</code> allows for a more elegant way of expressing the
components of the plot.<br />
</li>
<li>In this case, the plot is a <em>dataset</em>
(<code>airquality</code>) with <em>aesthetic mappings</em> derived from
the <code>Temp</code> and <code>Ozone</code> variables, a <em>set of
points</em>, and a <em>smoother</em>.</li>
</ul>
<p>In a sense, the <code>ggplot2</code> system <strong>takes many of the
cues</strong> from the <code>base</code> plotting system <strong>and
formalizes them</strong> a bit.</p>
<p>The <code>ggplot2</code> system <strong>also takes some cues</strong>
from <code>lattice</code>.</p>
<ul>
<li>It <em>automatically handles</em> things like <em>margins and
spacing</em>, and also has the <em>concept of “themes”</em> which
provide a default set of plotting symbols and colors.<br />
</li>
<li>The default themes makes many choices for uw, but <em>we can
customize</em> the presentation if we want.<br />
</li>
<li>While <code>ggplot2</code> bears a superficial similarity to
lattice, it is generally <em>easier</em> and <em>more intuitive</em> to
use.</li>
</ul>
</div>
</div>
<div id="the-basics-qplot" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> The Basics:
<code>qplot()</code></h2>
<p>The <code>qplot()</code> function (we can think of as standing for
<em>quick plot</em>) is the most basic function and it’s probably the
best place to start for someone who is transitioning from say the base
plotting system.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(qplot)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> (x, y, ..., data, <span class="at">facets =</span> <span class="cn">NULL</span>, <span class="at">margins =</span> <span class="cn">FALSE</span>, <span class="at">geom =</span> <span class="st">&quot;auto&quot;</span>, </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>), <span class="at">log =</span> <span class="st">&quot;&quot;</span>, <span class="at">main =</span> <span class="cn">NULL</span>, <span class="at">xlab =</span> <span class="cn">NULL</span>, </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="cn">NULL</span>, <span class="at">asp =</span> <span class="cn">NA</span>, <span class="at">stat =</span> <span class="cn">NULL</span>, <span class="at">position =</span> <span class="cn">NULL</span>)  </span></code></pre></div>
<ul>
<li><p>Works much like the <code>plot()</code> function in
<code>base</code> graphics system.</p></li>
<li><p>It can produce <strong>many types of plots</strong> (scatter,
histograms, box and whisker) while <em>hiding tedious details</em> from
the user.</p></li>
<li><p>Looks for data in a <strong>data frame</strong>, similar to
<code>lattice</code> (or in the <strong>parent</strong>
<strong>environment</strong>).</p>
<ul>
<li><p>One key difference when using <code>ggplot</code> functions, is
that we can <strong>only pass</strong> <strong>data frames</strong> to
them. Our data have to be organized in a data frame.</p></li>
<li><p>If we don’t specify a data frame then <code>qplot</code> (and all
the plotting functions) will look for the data in our
<strong>workspace</strong>.</p></li>
<li><p>But it’s generally a good idea to specify the data frame. That
way when we read the code that generated the plot we know exactly where
the data came from.</p></li>
</ul></li>
<li><p>Plots are made up of <em>aesthetics</em> (size, shape, color) and
<em>geoms</em> (the objects we are plotting: points, lines,
bars).</p></li>
<li><p><em>Factors</em> are important for <em>indicating subsets</em> of
the data (if they are to have different properties).</p>
<ul>
<li><p>Using factor variables is an important aspect for the qplot
function, as well as it is similarly important when we’re using lattice
functions.</p></li>
<li><p>Factors are very important because <strong>they indicate
subsets</strong> of our data.</p></li>
<li><p>For <em>example</em> we might have a factor variable that
indicates the <em>gender</em>. So <em>males</em> and <em>females</em>
are <em>subsets</em> of our data and we might want to plot a certain
relationship divided by those subsets or we might want to color certain
points, depending on whether they’re male of female.</p></li>
<li><p>The <em>categories</em> that are indicated by various factor
variables can be <strong>useful</strong> <strong>for annotating</strong>
a plot. So, it’s important that factor variables are
<strong>properly</strong> <strong>labeled</strong> (it’s usually not
useful to label a factor variable as 1, 2 and 3, even if we have three
categories, we want to label them with more informative labels so that
we know what those factor variables are trying to encode).</p></li>
</ul></li>
<li><p>The <strong>more advanced workhorse function</strong> in this
package is <code>ggplot()</code>, which is more <em>flexible</em> and
can be <em>customized</em> for doing things <code>qplot()</code> cannot
do.</p></li>
</ul>
<div id="example-dataset." class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Example
dataset.</h3>
<p>The <code>mpg</code> dataset comes with the <code>ggplot2</code>
package and contains data on the fuel economy of 38 popular models of
car from 1999 to 2008.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mpg)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>tibble [<span class="dv">234</span> × <span class="dv">11</span>] (S3<span class="sc">:</span> tbl_df<span class="sc">/</span>tbl<span class="sc">/</span>data.frame)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> manufacturer<span class="sc">:</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">234</span>] <span class="st">&quot;audi&quot;</span> <span class="st">&quot;audi&quot;</span> <span class="st">&quot;audi&quot;</span> <span class="st">&quot;audi&quot;</span> ...</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> model       <span class="sc">:</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">234</span>] <span class="st">&quot;a4&quot;</span> <span class="st">&quot;a4&quot;</span> <span class="st">&quot;a4&quot;</span> <span class="st">&quot;a4&quot;</span> ...</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> displ       <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">234</span>] <span class="fl">1.8</span> <span class="fl">1.8</span> <span class="dv">2</span> <span class="dv">2</span> <span class="fl">2.8</span> <span class="fl">2.8</span> <span class="fl">3.1</span> <span class="fl">1.8</span> <span class="fl">1.8</span> <span class="dv">2</span> ...</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> year        <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">234</span>] <span class="dv">1999</span> <span class="dv">1999</span> <span class="dv">2008</span> <span class="dv">2008</span> <span class="dv">1999</span> <span class="dv">1999</span> <span class="dv">2008</span> <span class="dv">1999</span> <span class="dv">1999</span> <span class="dv">2008</span> ...</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> cyl         <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">234</span>] <span class="dv">4</span> <span class="dv">4</span> <span class="dv">4</span> <span class="dv">4</span> <span class="dv">6</span> <span class="dv">6</span> <span class="dv">6</span> <span class="dv">4</span> <span class="dv">4</span> <span class="dv">4</span> ...</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> trans       <span class="sc">:</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">234</span>] <span class="st">&quot;auto(l5)&quot;</span> <span class="st">&quot;manual(m5)&quot;</span> <span class="st">&quot;manual(m6)&quot;</span> <span class="st">&quot;auto(av)&quot;</span> ...</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> drv         <span class="sc">:</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">234</span>] <span class="st">&quot;f&quot;</span> <span class="st">&quot;f&quot;</span> <span class="st">&quot;f&quot;</span> <span class="st">&quot;f&quot;</span> ...</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> cty         <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">234</span>] <span class="dv">18</span> <span class="dv">21</span> <span class="dv">20</span> <span class="dv">21</span> <span class="dv">16</span> <span class="dv">18</span> <span class="dv">18</span> <span class="dv">18</span> <span class="dv">16</span> <span class="dv">20</span> ...</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> hwy         <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">234</span>] <span class="dv">29</span> <span class="dv">29</span> <span class="dv">31</span> <span class="dv">30</span> <span class="dv">26</span> <span class="dv">26</span> <span class="dv">27</span> <span class="dv">26</span> <span class="dv">25</span> <span class="dv">28</span> ...</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> fl          <span class="sc">:</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">234</span>] <span class="st">&quot;p&quot;</span> <span class="st">&quot;p&quot;</span> <span class="st">&quot;p&quot;</span> <span class="st">&quot;p&quot;</span> ...</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> class       <span class="sc">:</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">234</span>] <span class="st">&quot;compact&quot;</span> <span class="st">&quot;compact&quot;</span> <span class="st">&quot;compact&quot;</span> <span class="st">&quot;compact&quot;</span> ...</span></code></pre></div>
<ul>
<li>All of the factor variables are appropriately coded with meaningful
labels.
<ul>
<li>This will come in handy when <code>qplot()</code> has to label
different aspects of a plot.<br />
</li>
</ul></li>
<li>Also note that all of the columns/variables have meaningful (if
sometimes abbreviated) names, rather than names like “X1”, and “X2”,
etc.</li>
</ul>
<div
id="ggplot2-hello-world-a-quick-scatterplot-with-automatic-geom-point."
class="section level4" number="3.2.1.1">
<h4><span class="header-section-number">3.2.1.1</span> ggplot2 “Hello,
world!” (a quick scatterplot with automatic geom point).</h4>
<p>We can make <strong>a quick scatterplot</strong> of the engine
displacement (<code>displ</code>) and the highway miles per gallon
(<code>hwy</code>).</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(displ, hwy, <span class="at">data =</span> mpg)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<ul>
<li><strong>Notice</strong>: we didn’t have to specify
<code>geom = "point"</code> because that was done automatically.<br />
</li>
<li>Also, all the labels were automatically provided.</li>
</ul>
</div>
<div id="modifying-aesthetics-introducing-a-third-variable."
class="section level4" number="3.2.1.2">
<h4><span class="header-section-number">3.2.1.2</span> Modifying
aesthetics (introducing a third variable).</h4>
<p>We can <strong>introduce a third variable</strong> into the plot by
<strong>modifying the color</strong> of the points based on the value of
that third variable.</p>
<ul>
<li><code>color</code> is <em>an aesthetic</em> and the color of each
point <em>can be mapped to a variable</em>.
<ul>
<li>In this case we will map the color to the <code>drv</code> variable
which indicates whether a car is front wheel drive, rear wheel drive, or
4-wheel drive.<br />
</li>
</ul></li>
<li>Note that the <code>x-coordinates</code> and
<code>y-coordinates</code> are <em>aesthetics too</em>, and they got
<em>mapped to</em> the <code>displ</code> and <code>hwy</code>
variables, respectively.</li>
</ul>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(displ, hwy, <span class="at">data =</span> mpg, <span class="at">color =</span> drv)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<ul>
<li>The <strong>legend to the right</strong> is helpfully supplied by
<code>qplot()</code>.<br />
</li>
<li>The <strong>colors</strong> were <strong>automatically
assigned</strong> so the legend decodes the colors for us.<br />
</li>
<li>We can see that the front wheel drive cars tend to have lower
displacement relative to the 4-wheel or rear wheel drive cars.<br />
</li>
<li>Also, it’s clear that the 4-wheel drive cars have the lowest highway
gas mileage.</li>
</ul>
</div>
<div
id="adding-a-geom-introducing-a-smoother-a-geom-that-is-also-a-statistic-to-highlight-trends."
class="section level4" number="3.2.1.3">
<h4><span class="header-section-number">3.2.1.3</span> Adding a geom:
introducing a smoother (a geom that is also a statistic) to highlight
trends.</h4>
<p>Sometimes it’s nice to <strong>add a smoother</strong> to a
scatterplot <em>to highlight any trends</em>.</p>
<ul>
<li>Trends can be difficult to see if the data are very noisy or there
are many data points obscuring the view.<br />
</li>
<li>A <strong>smooth</strong> is a <code>geom</code> that we can add
along with our data points.
<ul>
<li>It consist of a trend line that is surrounded by a gray zone
representing the 95% confidence intervals for that line.</li>
</ul></li>
</ul>
<p>There are basically <strong>two ways to add a geom</strong>.</p>
<div id="adding-a-geom-using-the-geom-argument-to-qplot."
class="section level5" number="3.2.1.3.1">
<h5><span class="header-section-number">3.2.1.3.1</span> Adding a geom
using the <code>geom</code> argument to <code>qplot()</code>.</h5>
<p><strong>Notice</strong> that previously, we didn’t have to specify
<code>geom = "point"</code> to <code>qplot())</code> but now, if we want
the <strong>smoother overlayed with the points</strong>, then we
<em>need to</em> <em>specify both explicitly</em>.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(displ, hwy, <span class="at">data =</span> mpg, <span class="at">geom =</span> <span class="fu">c</span>(<span class="st">&quot;point&quot;</span>, <span class="st">&quot;smooth&quot;</span>))</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">geom_smooth()</span><span class="st">`</span> using method <span class="ot">=</span> <span class="st">&#39;loess&#39;</span> and formula <span class="st">&#39;y ~ x&#39;</span></span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<ul>
<li>It <em>seems</em> that engine displacement and highway mileage have
a <em>nonlinear U-shaped</em> relationship, <strong>but from the
previous plot</strong> we know that <em>this is largely due</em> to
confounding by the <em>drive class</em> of the car.</li>
</ul>
<p>With the third variable <code>drv</code> mapped to color, adding our
second geom results in the following plot:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(displ, hwy, <span class="at">data =</span> mpg, <span class="at">color =</span> drv, <span class="at">geom =</span> <span class="fu">c</span>(<span class="st">&quot;point&quot;</span>, <span class="st">&quot;smooth&quot;</span>))</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">geom_smooth()</span><span class="st">`</span> using method <span class="ot">=</span> <span class="st">&#39;loess&#39;</span> and formula <span class="st">&#39;y ~ x&#39;</span></span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
</div>
<div id="adding-a-geom-with-the-corrisponding-geom-function."
class="section level5" number="3.2.1.3.2">
<h5><span class="header-section-number">3.2.1.3.2</span> Adding a geom
with the corrisponding geom function.</h5>
<p>We can also add a <em>smooth</em> geom, by literally adding it’s
corrisponding geom function: <code>geom_smooth()</code></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(displ, hwy, <span class="at">data =</span> mpg) <span class="sc">+</span> <span class="fu">geom_smooth</span>()</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">geom_smooth()</span><span class="st">`</span> using method <span class="ot">=</span> <span class="st">&#39;loess&#39;</span> and formula <span class="st">&#39;y ~ x&#39;</span></span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
</div>
</div>
<div id="histograms-one-dimensional-data-with-geom-bar-by-default."
class="section level4" number="3.2.1.4">
<h4><span class="header-section-number">3.2.1.4</span> Histograms (one
dimensional data, with geom bar by default).</h4>
<p>The <code>qplot()</code> function can be used to <strong>plot
1-dimensional data too</strong>.</p>
<ul>
<li>By <strong>specifying a single variable</strong>,
<code>qplot()</code> will <em>by default</em> make a
<em>histogram</em>.</li>
</ul>
<p>Here we make a histogram of the highway mileage data <em>and
stratify</em> on the drive class.</p>
<ul>
<li>So technically this is <em>three histograms overlayed</em> on top of
each other.</li>
</ul>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(hwy, <span class="at">data =</span> mpg, <span class="at">fill =</span> drv, <span class="at">binwidth =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<p><strong>Notice</strong>:</p>
<ul>
<li><p>The variable we are interested in, <code>hwy</code>, is
<strong>mapped to the <code>x</code> parameter</strong>.</p></li>
<li><p>What happens if we <strong>only specify the <code>y</code>
parameter</strong>?</p>
<ul>
<li>We <strong>wont get an histogram</strong>.<br />
</li>
<li>Instead, the function will <strong>plot the values</strong> of the
<code>y</code> argument in the <strong>order in which they
occur</strong> in the data.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="at">y =</span> hwy, <span class="at">data =</span> mpg, <span class="at">color =</span> drv)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<ul>
<li>In fact, there are <em>234 observations</em> in the <code>mpg</code>
dataset (indicated in the <code>x</code> axis) and each point in the
plot represents one of the <code>hwy</code> values (indicated by the
<code>y</code> axis).</li>
</ul>
</div>
<div id="boxplots-one-dimensional-data-with-geom-boxplot."
class="section level4" number="3.2.1.5">
<h4><span class="header-section-number">3.2.1.5</span> Boxplots (one
dimensional data, with geom boxplot).</h4>
<p>Having the different colors for each drive class is nice, but the
previous three histograms can be a bit difficult to separate out.</p>
<p>Side-by-side boxplots is one solution to this problem.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(drv, hwy, <span class="at">data =</span> mpg, <span class="at">geom =</span> <span class="st">&quot;boxplot&quot;</span>)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p>As we saw, equivalently:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(drv, hwy, <span class="at">data =</span> mpg) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<p>So, in order to make <code>qplot()</code> plot a
<strong>boxplot</strong>, we have to:</p>
<ul>
<li>Specify the <strong>variable we want to examine</strong>, in this
case <code>hwy</code>, as the <code>y</code> variable.<br />
</li>
<li>And of course tell it that we want the <code>geom</code>
“boxplot.<br />
</li>
<li><em>Optionally</em>, we can <strong>specify the variable by which we
want to split the data</strong> as the <code>x</code> variable, like we
did with <code>drv</code>.</li>
</ul>
<p>As <strong>an example</strong> of the <strong>interesting
capabilites</strong> of <code>qplot()</code>, let’s add to our previous
boxplot a <em>third variable</em>, <code>manufacturer</code>, mapped to
<code>color</code> aesthetics.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(drv, hwy, <span class="at">data =</span> mpg, <span class="at">geom =</span> <span class="st">&quot;boxplot&quot;</span>, <span class="at">color =</span> manufacturer)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<ul>
<li>Notice that there are <em>still 3 regions</em> of the plot
(determined by the factor drv).<br />
</li>
<li><em>Each is subdivided</em> into several boxes depicting different
manufacturers.</li>
</ul>
</div>
<div id="facets-multiple-panels." class="section level4"
number="3.2.1.6">
<h4><span class="header-section-number">3.2.1.6</span> Facets (multiple
panels).</h4>
<p>Another solution is to plot the histograms in separate panels using
facets.</p>
<p>In general, facets are a <strong>way to create multiple
panels</strong> of plots based on the <em>levels</em> of <em>categorical
variable</em>.</p>
<p>We can do that using <strong>the <code>facets</code> argument to
<code>qplot()</code></strong>.</p>
<ul>
<li>It expects a <strong>formula</strong> type of input, with a
<code>∼</code> separating the left hand side variable and the right hand
side variable.<br />
</li>
<li>The <em>left hand side variable</em> indicates how the <strong>rows
of the panels</strong> should be divided.<br />
</li>
<li>The <em>right hand side variable</em> indicates how the
<strong>columns of the panels</strong> should be divided.</li>
</ul>
<p>Here, we want to see a histogram of the highway mileages
(<code>hwy</code>) and the categorical variable is the drive class
variable (<code>drv</code>). And we want <em>three rows of
histograms</em> (and <em>just one column</em>), one for each drive
class.</p>
<ul>
<li>We then specify <code>drv</code> <em>on the left</em> hand side of
the formula.<br />
</li>
<li>And <code>.</code> <em>on the right</em> hand side
<strong>indicating</strong> that <strong>there’s no variable</strong>
there (it’s <strong>empty</strong>), that is to say, <strong>just one
column</strong>.</li>
</ul>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(hwy, <span class="at">data =</span> mpg, <span class="at">facets =</span> drv <span class="sc">~</span> ., <span class="at">binwidth =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<p>Instead of histograms <strong>we could look at scatterplots</strong>
of engine displacement and highway mileage <em>by drive class</em>.</p>
<ul>
<li>This time we put the <code>drv</code> variable <em>on the right</em>
hand side to indicate that we want <em>a column for each drive
class</em> (as opposed to splitting by rows like we did above).</li>
</ul>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(displ, hwy, <span class="at">data =</span> mpg, <span class="at">facets =</span> . <span class="sc">~</span> drv)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
</div>
<div id="adding-a-smoother-to-each-of-the-panels."
class="section level4" number="3.2.1.7">
<h4><span class="header-section-number">3.2.1.7</span> Adding a smoother
to each of the panels.</h4>
<p>It’s simple, we just add the geom function <code>geom_smooth()</code>
or use the <code>geom</code> argument to <code>qplot()</code>.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(displ, hwy, <span class="at">data =</span> mpg, <span class="at">facets =</span> . <span class="sc">~</span> drv) <span class="sc">+</span> <span class="fu">geom_smooth</span>()</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">geom_smooth()</span><span class="st">`</span> using method <span class="ot">=</span> <span class="st">&#39;loess&#39;</span> and formula <span class="st">&#39;y ~ x&#39;</span></span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(displ, hwy, <span class="at">data =</span> mpg, <span class="at">facets =</span> . <span class="sc">~</span> drv, <span class="at">geom =</span> <span class="fu">c</span>(<span class="st">&quot;point&quot;</span>, <span class="st">&quot;smooth&quot;</span>))</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">geom_smooth()</span><span class="st">`</span> using method <span class="ot">=</span> <span class="st">&#39;loess&#39;</span> and formula <span class="st">&#39;y ~ x&#39;</span></span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-51-2.png" width="672" /></p>
</div>
</div>
<div id="another-example-maacs-cohort-study." class="section level3"
number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Another example:
MAACS Cohort Study.</h3>
<p>Let’s return to the Mouse Allergen and Asthma Cohort Study
(MAACS):</p>
<ul>
<li>Aimed at characterizing the indoor (home) environment and its
relationship with asthma morbidity amonst children aged 5–17 living in
BaltimorePersistent.<br />
</li>
<li>The children all had persistent asthma, defined as having had an
exacerbation in the past year.<br />
</li>
<li>Representative publication of results: <a
href="http://goo.gl/WqE9j8" class="uri">http://goo.gl/WqE9j8</a></li>
</ul>
<p><strong>Notice</strong>:</p>
<ul>
<li>Because the individual-level data for this study are protected by
various U.S. privacy laws, we cannot make those data available.<br />
</li>
<li>For the purposes of this section, we’ll use simulated data that
share many of the same features of the original data, but do not contain
any of the actual measurements or values contained in the original
dataset:<br />
<a
href="https://github.com/lupok2001/datasciencecoursera/blob/master/maacs.Rda"
class="uri">https://github.com/lupok2001/datasciencecoursera/blob/master/maacs.Rda</a></li>
</ul>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;4_data/maacs.Rda&quot;</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(maacs)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;data.frame&#39;</span><span class="sc">:</span>   <span class="dv">750</span> obs. of  <span class="dv">9</span> variables<span class="sc">:</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a> <span class="er">$</span> id            <span class="sc">:</span> int  <span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">9</span> <span class="dv">10</span> ...</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> eno           <span class="sc">:</span> num  <span class="dv">141</span> <span class="dv">124</span> <span class="dv">126</span> <span class="dv">164</span> <span class="dv">99</span> <span class="dv">68</span> <span class="dv">41</span> <span class="dv">50</span> <span class="dv">12</span> <span class="dv">30</span> ...</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> duBedMusM     <span class="sc">:</span> num  <span class="dv">2423</span> <span class="dv">2793</span> <span class="dv">3055</span> <span class="dv">775</span> <span class="dv">1634</span> ...</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> pm25          <span class="sc">:</span> num  <span class="fl">15.6</span> <span class="fl">34.4</span> <span class="dv">39</span> <span class="fl">33.2</span> <span class="fl">27.1</span> ...</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> mopos         <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">&quot;no&quot;</span>,<span class="st">&quot;yes&quot;</span><span class="sc">:</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> ...</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> logpm25       <span class="sc">:</span> num  <span class="fl">1.19</span> <span class="fl">1.54</span> <span class="fl">1.59</span> <span class="fl">1.52</span> <span class="fl">1.43</span> ...</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> NocturnalSympt<span class="sc">:</span> int  <span class="dv">0</span> <span class="dv">0</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> bmicat        <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">&quot;normal weight&quot;</span>,..<span class="sc">:</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">1</span> ...</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> logno2_new    <span class="sc">:</span> num  <span class="fl">1.62</span> <span class="fl">1.88</span> <span class="fl">1.71</span> <span class="fl">1.46</span> <span class="fl">1.29</span> ...</span></code></pre></div>
<p>The key variables are:</p>
<ul>
<li><code>mopos</code>:
<ul>
<li>an indicator of whether the subject is allergic to mouse allergen
(yes/no).<br />
</li>
</ul></li>
<li><code>pm25</code>:
<ul>
<li>average level of PM2.5 over the course of 7 days (micrograms per
cubic meter).<br />
</li>
</ul></li>
<li><code>eno</code>:
<ul>
<li>exhaled nitric oxide.</li>
</ul></li>
</ul>
<div id="histogram-of-eno." class="section level4" number="3.2.2.1">
<h4><span class="header-section-number">3.2.2.1</span> Histogram of
eNO.</h4>
<p>The outcome of interest for this analysis will be exhaled nitric
oxide (eNO), which is a <em>measure of pulmonary inflamation</em>.</p>
<p>We can get a sense of how eNO is distributed in this population by
making a quick histogram of the variable.</p>
<ul>
<li>Here, we <em>take the log</em> of eNO because some right-skew in the
data.</li>
</ul>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="fu">log</span>(eno), <span class="at">data =</span> maacs)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">stat_bin()</span><span class="st">`</span> using <span class="st">`</span><span class="at">bins = 30</span><span class="st">`</span>. Pick better value with <span class="st">`</span><span class="at">binwidth</span><span class="st">`</span>.</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">108</span> rows containing non<span class="sc">-</span>finite <span class="fu">values</span> (stat_bin).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<ul>
<li>A quick glance suggests that the <strong>histogram is a bit
“fat”</strong>, suggesting that there might be <em>multiple groups of
people being lumped together</em>.</li>
</ul>
</div>
<div id="histogram-by-group." class="section level4" number="3.2.2.2">
<h4><span class="header-section-number">3.2.2.2</span> Histogram by
Group.</h4>
<p>We can <em>stratify the histogram</em> by whether they are allergic
to mouse.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="fu">log</span>(eno), <span class="at">data =</span> maacs, <span class="at">fill =</span> mopos)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">stat_bin()</span><span class="st">`</span> using <span class="st">`</span><span class="at">bins = 30</span><span class="st">`</span>. Pick better value with <span class="st">`</span><span class="at">binwidth</span><span class="st">`</span>.</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">108</span> rows containing non<span class="sc">-</span>finite <span class="fu">values</span> (stat_bin).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<ul>
<li>We can see from this plot that <em>the non-allergic subjects</em>
are shifted slightly to the left, indicating a <strong>lower eNO and
less pulmonary inflammation</strong>.<br />
</li>
<li>That said, <em>there is significant overlap</em> between the two
groups.</li>
</ul>
</div>
<div id="density-smoother-geom-density." class="section level4"
number="3.2.2.3">
<h4><span class="header-section-number">3.2.2.3</span> Density Smoother
(geom density).</h4>
<p>An alternative to histograms is <strong>a density smoother</strong>,
which sometimes can be <em>easier</em> <em>to visualize</em> when there
are <em>multiple groups</em>.</p>
<p>Here is a density smooth of <strong>the entire study
population</strong>.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="fu">log</span>(eno), <span class="at">data =</span> maacs, <span class="at">geom =</span> <span class="st">&quot;density&quot;</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">108</span> rows containing non<span class="sc">-</span>finite <span class="fu">values</span> (stat_density).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-55-1.png" width="672" /></p>
<p>And here are the densities <strong>straitified by allergic
status</strong>.</p>
<ul>
<li>We can <em>map the color aesthetic</em> to the <code>mopos</code>
variable.</li>
</ul>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="fu">log</span>(eno), <span class="at">data =</span> maacs, <span class="at">geom =</span> <span class="st">&quot;density&quot;</span>, <span class="at">color =</span> mopos)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">108</span> rows containing non<span class="sc">-</span>finite <span class="fu">values</span> (stat_density).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<ul>
<li>These tell the same story as the stratified histograms, which sould
come as no surprise.</li>
</ul>
</div>
<div id="scatterplots-eno-vs.-pm_2.5" class="section level4"
number="3.2.2.4">
<h4><span class="header-section-number">3.2.2.4</span> Scatterplots: eNO
vs. PM<span class="math inline">\(_{2.5}\)</span></h4>
<p>Now we can <strong>examine the indoor environment and its
relationship to eNO</strong>.</p>
<ul>
<li>Here, we use the level of indoor PM2.5 as a measure of indoor
environment air quality.</li>
</ul>
<p>We can make a <em>simple scatterplot of PM2.5 and eNO</em>.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="fu">log</span>(pm25), <span class="fu">log</span>(eno), <span class="at">data =</span> maacs, <span class="at">geom =</span> <span class="fu">c</span>(<span class="st">&quot;point&quot;</span>, <span class="st">&quot;smooth&quot;</span>))</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">geom_smooth()</span><span class="st">`</span> using method <span class="ot">=</span> <span class="st">&#39;loess&#39;</span> and formula <span class="st">&#39;y ~ x&#39;</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">184</span> rows containing non<span class="sc">-</span>finite <span class="fu">values</span> (stat_smooth).</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">184</span> rows containing missing <span class="fu">values</span> (geom_point).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
<ul>
<li>The relationship appears modest at best, as there is
<strong>substantial noise</strong> in the data.</li>
</ul>
<p>However, one <strong>question that we might be interested in</strong>
is whether <em>allergic</em> individuals are prehaps <em>more
sensitive</em> to PM2.5 inhalation than <em>non-allergic</em>
individuals.</p>
<p>To examine that question we can <em>stratify the data into two
groups</em>.</p>
<p>This <em>first plot</em> uses <strong>different plot symbols</strong>
for the two groups and overlays them on a single canvas, by
<em>mapping</em> the <code>mopos</code> variable to the
<code>shape</code> aesthetic.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="fu">log</span>(pm25), <span class="fu">log</span>(eno), <span class="at">data =</span> maacs, <span class="at">shape =</span> mopos)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">184</span> rows containing missing <span class="fu">values</span> (geom_point).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
<ul>
<li>Because there is <em>substantial overlap</em> in the data it is a
bit <strong>challenging to</strong> <strong>discern</strong> the circles
from the triangles.<br />
</li>
<li>Part of the reason might be that all of the symbols are the same
color (black).</li>
</ul>
<p>We can make a <em>second plot</em> mapping to each group a
<strong>different color</strong> to see if that helps.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="fu">log</span>(pm25), <span class="fu">log</span>(eno), <span class="at">data =</span> maacs, <span class="at">color =</span> mopos)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">184</span> rows containing missing <span class="fu">values</span> (geom_point).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
<ul>
<li>This is slightly better but the <em>substantial overlap</em> makes
it <strong>difficult to</strong> <strong>discern</strong> any
<em>trends</em> in the data.</li>
</ul>
<p>For trends we need to <strong>add a smoother</strong> of some
sort.</p>
<ul>
<li>Here we add a <strong>linear regression line</strong> (a type of
smoother) to each group to see if there’s any difference.</li>
</ul>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="fu">log</span>(pm25), <span class="fu">log</span>(eno), <span class="at">data =</span> maacs, <span class="at">color =</span> mopos) <span class="sc">+</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">geom_smooth()</span><span class="st">`</span> using formula <span class="st">&#39;y ~ x&#39;</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">184</span> rows containing non<span class="sc">-</span>finite <span class="fu">values</span> (stat_smooth).</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">184</span> rows containing missing <span class="fu">values</span> (geom_point).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<ul>
<li>Finally we see <strong>quite clearly</strong> that the red group and
the green group exhibit rather <strong>different relationships</strong>
between PM2.5 and eNO.<br />
</li>
<li>For the <em>non-allergic individuals</em>, there appears to be a
<strong>slightly negative</strong> relationship between PM2.5 and
eNO.<br />
</li>
<li>For the <em>allergic individuals</em>, there is a
<strong>positive</strong> relationship.<br />
</li>
<li>This <strong>suggests a strong interaction</strong> between
<em>PM2.5</em> and <em>allergic status</em>, an <strong>hypothesis
perhaps worth following</strong> up on in greater detail than this brief
exploratory analysis.</li>
</ul>
<p>Another, and <strong>perhaps more clear</strong>, way to visualize
this interaction is to use <strong>separate panels</strong> for the
non-allergic and allergic individuals using the <code>facets</code>
argument to <code>qplot()</code>.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="fu">log</span>(pm25), <span class="fu">log</span>(eno), <span class="at">data =</span> maacs, <span class="at">facets =</span> . <span class="sc">~</span> mopos) <span class="sc">+</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">geom_smooth()</span><span class="st">`</span> using formula <span class="st">&#39;y ~ x&#39;</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">184</span> rows containing non<span class="sc">-</span>finite <span class="fu">values</span> (stat_smooth).</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">184</span> rows containing missing <span class="fu">values</span> (geom_point).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
</div>
</div>
<div id="summary-of-qplot" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Summary of
<code>qplot()</code></h3>
<ul>
<li>The <code>qplot()</code> function is a simple function that you can
use to <em>make very quick</em> <em>plots</em>.<br />
</li>
<li>It is the analog to <code>plot()</code> but with many built-in
features.
<ul>
<li>If we want to color code subsets of the data, it’s very easy to
do.<br />
</li>
<li>If we want to split out different panels, that’s also very easy to
do with the facets.<br />
</li>
<li>We can choose different plotting symbols with the shape
argument.<br />
</li>
</ul></li>
<li>Syntax somewhere in between
<code>base</code>/<code>lattice</code>.<br />
</li>
<li>Produces very nice graphics, essentially publication ready (if you
like the design).
<ul>
<li>If we don’t, if there are features we don’t like or we don’t like
the design of a particular function, it’s a little bit tricky to modify
the <code>qplot()</code> function to suit your needs.<br />
</li>
<li>If we want to do a lower level customization of different aspects of
the plot, we really have to go into the guts of the
<code>ggplot()</code> function, and that’s something that we discuss in
the next section.</li>
</ul></li>
</ul>
</div>
</div>
<div id="the-nitty-gritty-of-ggplot2." class="section level2"
number="3.3">
<h2><span class="header-section-number">3.3</span> The nitty gritty of
<code>ggplot2</code>.</h2>
<p>In this section we’ll get into a little more of the nitty gritty
of:</p>
<ul>
<li><p><strong>how</strong> <code>ggplot2</code> <strong>builds
plots</strong>, and</p></li>
<li><p><strong>how</strong> we can <strong>customize</strong> various
aspects of any plot.</p></li>
</ul>
<p>It’s worth knowing the underlying details of how ggplot2 works so
that we can really exploit its power.</p>
<div id="basic-components-of-a-ggplot2-plot." class="section level3"
number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Basic components of
a <code>ggplot2</code> plot.</h3>
<p>Here are a few of the more commonly used components of a
<code>ggplot2</code> plot:</p>
<ul>
<li>A <em>data frame</em>:
<ul>
<li>stores all of the data that will be displayed on the plot.<br />
</li>
</ul></li>
<li><em>aesthetic mappings</em>:
<ul>
<li>describe how data are mapped to color, size, shape, location.<br />
</li>
</ul></li>
<li><em>geoms</em>:
<ul>
<li>geometric objects like points, lines, shapes.<br />
</li>
</ul></li>
<li><em>facets</em>:
<ul>
<li>describes how conditional/panel plots should be constructed.<br />
</li>
</ul></li>
<li><em>stats</em>:
<ul>
<li>statistical transformations like binning, quantiles,
smoothing.<br />
</li>
</ul></li>
<li><em>scales</em>:
<ul>
<li>scales are to find how the different variables are coded, in terms
of the plot;<br />
</li>
<li>for example, we might have a binary variable that represents sex. So
we let the males will be red and the females blue, or something like
that (that is a scaling for a particular type of dichotomous
variable).<br />
</li>
</ul></li>
<li><em>coordinate system</em>:
<ul>
<li>describes the system in which the locations of the geoms will be
drawn.</li>
</ul></li>
</ul>
<p>It’s essential that:</p>
<ul>
<li><p>We properly organize our data into a <strong>data frame</strong>
before we start with <code>ggplot2</code>.</p></li>
<li><p>In particular, it’s important that we provide all of the
<strong>appropriate metadata</strong> so that our data frame is
self-describing and our plots will be self-documenting.</p></li>
</ul>
</div>
<div id="building-plots-with-ggplot2." class="section level3"
number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Building Plots with
<code>ggplot2</code>.</h3>
<p>When building plots in <code>ggplot2()</code>, rather than using
<code>qplot()</code>, the <em>“artist’s palette”</em> <em>model</em> may
be the <em>closest analogy</em>.</p>
<p>Plots are <strong>built up in layers</strong>, with the typically
ordering being:</p>
<ol style="list-style-type: decimal">
<li>Plot the data.<br />
</li>
<li>Overlay a summary (for instance, a regression line or
smoother).<br />
</li>
<li>Add metadata and annotation.</li>
</ol>
</div>
<div id="example-bmi-pm_2.5-asthma." class="section level3"
number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Example: BMI,
PM<span class="math inline">\(_{2.5}\)</span>, Asthma.</h3>
<p>To demonstrate the various pieces of <code>ggplot2</code> we will use
as running example the Mouse Allergen and Asthma Cohort Study (MAACS),
which we already described before.</p>
</div>
<div id="the-question." class="section level3" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> The question.</h3>
<p>Here, the question we are interested in is:</p>
<blockquote>
<p>“Are overweight individuals, as measured by body mass index (BMI),
more susceptible than normal weight individuals to the harmful effects
of PM2.5 on asthma symptoms?”</p>
</blockquote>
<p>In other words:</p>
<blockquote>
<p>Does BMI (normal vs. overweight) modify the relationship between
PM<span class="math inline">\(_{2.5}\)</span> and asthma symptoms?</p>
</blockquote>
</div>
<div id="the-suggestion." class="section level3" number="3.3.5">
<h3><span class="header-section-number">3.3.5</span> The
suggestion.</h3>
<p>There is a suggestion that <em>overweight individuals</em> may be
<em>more susceptible</em> to the negative effects of inhaling PM2.5.</p>
<p>This would suggest that <em>increases in PM2.5 exposure</em> in the
home of an overweight child would be more deleterious to his/her asthma
symptoms than they would be in the home of a normal weight child.</p>
<p>We want to see if we can see that difference in the data from
MAACS.</p>
</div>
<div id="the-outcome-well-look-at." class="section level3"
number="3.3.6">
<h3><span class="header-section-number">3.3.6</span> The outcome we’ll
look at.</h3>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;4_data/maacs.Rda&quot;</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(maacs)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;data.frame&#39;</span><span class="sc">:</span>   <span class="dv">750</span> obs. of  <span class="dv">9</span> variables<span class="sc">:</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a> <span class="er">$</span> id            <span class="sc">:</span> int  <span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">9</span> <span class="dv">10</span> ...</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> eno           <span class="sc">:</span> num  <span class="dv">141</span> <span class="dv">124</span> <span class="dv">126</span> <span class="dv">164</span> <span class="dv">99</span> <span class="dv">68</span> <span class="dv">41</span> <span class="dv">50</span> <span class="dv">12</span> <span class="dv">30</span> ...</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> duBedMusM     <span class="sc">:</span> num  <span class="dv">2423</span> <span class="dv">2793</span> <span class="dv">3055</span> <span class="dv">775</span> <span class="dv">1634</span> ...</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> pm25          <span class="sc">:</span> num  <span class="fl">15.6</span> <span class="fl">34.4</span> <span class="dv">39</span> <span class="fl">33.2</span> <span class="fl">27.1</span> ...</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> mopos         <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">&quot;no&quot;</span>,<span class="st">&quot;yes&quot;</span><span class="sc">:</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> ...</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> logpm25       <span class="sc">:</span> num  <span class="fl">1.19</span> <span class="fl">1.54</span> <span class="fl">1.59</span> <span class="fl">1.52</span> <span class="fl">1.43</span> ...</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> NocturnalSympt<span class="sc">:</span> int  <span class="dv">0</span> <span class="dv">0</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> bmicat        <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">&quot;normal weight&quot;</span>,..<span class="sc">:</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">1</span> ...</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> logno2_new    <span class="sc">:</span> num  <span class="fl">1.62</span> <span class="fl">1.88</span> <span class="fl">1.71</span> <span class="fl">1.46</span> <span class="fl">1.29</span> ...</span></code></pre></div>
<p>The outcome we will look at here, <code>NocturnalSymp</code>, is the
<strong>number of days</strong> in the <strong>past 2 weeks</strong>
where the <strong>child experienced asthma symptoms</strong>
(e.g. coughing, wheezing) <em>while sleeping</em>.</p>
</div>
<div id="the-quick-plot." class="section level3" number="3.3.7">
<h3><span class="header-section-number">3.3.7</span> The quick
plot.</h3>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(logpm25, NocturnalSympt, <span class="at">data =</span> maacs, <span class="at">facets =</span> . <span class="sc">~</span> bmicat, </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">geom =</span> <span class="fu">c</span>(<span class="st">&quot;point&quot;</span>, <span class="st">&quot;smooth&quot;</span>), <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Ignoring unknown parameters<span class="sc">:</span> method</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">geom_smooth()</span><span class="st">`</span> using formula <span class="st">&#39;y ~ x&#39;</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">134</span> rows containing non<span class="sc">-</span>finite <span class="fu">values</span> (stat_smooth).</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">134</span> rows containing missing <span class="fu">values</span> (geom_point).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>
</div>
<div id="building-up-in-layers-creating-a-ggplot-object."
class="section level3" number="3.3.8">
<h3><span class="header-section-number">3.3.8</span> Building up in
layers, creating a <code>ggplot</code> object.</h3>
<p>First we can create a <strong><code>ggplot</code> object</strong>
that <em>stores</em>:</p>
<ul>
<li>the <em>dataset</em>, and<br />
</li>
<li>the <em>basic aesthetics</em> for mapping the <em>x- and
y-coordinates</em> for the plot.</li>
</ul>
<p>Here we will eventually be plotting the log of PM2.5
(<code>logpm25</code>) and <code>NocturnalSymp</code> variable.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(maacs)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  id eno duBedMusM   pm25 mopos  logpm25 NocturnalSympt        bmicat</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">1</span> <span class="dv">141</span>      <span class="dv">2423</span> <span class="fl">15.560</span>   yes <span class="fl">1.192010</span>              <span class="dv">0</span> normal weight</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="dv">2</span> <span class="dv">124</span>      <span class="dv">2793</span> <span class="fl">34.370</span>   yes <span class="fl">1.536180</span>              <span class="dv">0</span>    overweight</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="dv">3</span> <span class="dv">126</span>      <span class="dv">3055</span> <span class="fl">38.953</span>   yes <span class="fl">1.590541</span>              <span class="dv">2</span>    overweight</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="dv">4</span> <span class="dv">164</span>       <span class="dv">775</span> <span class="fl">33.249</span>   yes <span class="fl">1.521779</span>              <span class="dv">2</span> normal weight</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="dv">5</span>  <span class="dv">99</span>      <span class="dv">1634</span> <span class="fl">27.060</span>   yes <span class="fl">1.432328</span>              <span class="dv">2</span> normal weight</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  <span class="dv">6</span>  <span class="dv">68</span>       <span class="dv">939</span> <span class="fl">18.890</span>   yes <span class="fl">1.276232</span>              <span class="dv">2</span> normal weight</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  logno2_new</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   <span class="fl">1.617849</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   <span class="fl">1.884490</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   <span class="fl">1.712953</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   <span class="fl">1.458879</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>   <span class="fl">1.294510</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>   <span class="fl">1.468377</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(maacs, <span class="fu">aes</span>(logpm25, NocturnalSympt))</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(g)</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>data<span class="sc">:</span> id, eno, duBedMusM, pm25, mopos, logpm25, NocturnalSympt, bmicat,</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>  logno2_new [750x9]</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>mapping<span class="sc">:</span>  x <span class="ot">=</span> <span class="er">~</span>logpm25, y <span class="ot">=</span> <span class="er">~</span>NocturnalSympt</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>faceting<span class="sc">:</span> <span class="er">&lt;</span>ggproto object<span class="sc">:</span> Class FacetNull, Facet, gg<span class="sc">&gt;</span></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>    compute_layout<span class="sc">:</span> <span class="cf">function</span></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>    draw_back<span class="sc">:</span> <span class="cf">function</span></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>    draw_front<span class="sc">:</span> <span class="cf">function</span></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>    draw_labels<span class="sc">:</span> <span class="cf">function</span></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>    draw_panels<span class="sc">:</span> <span class="cf">function</span></span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>    finish_data<span class="sc">:</span> <span class="cf">function</span></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>    init_scales<span class="sc">:</span> <span class="cf">function</span></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>    map_data<span class="sc">:</span> <span class="cf">function</span></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>    params<span class="sc">:</span> list</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>    setup_data<span class="sc">:</span> <span class="cf">function</span></span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a>    setup_params<span class="sc">:</span> <span class="cf">function</span></span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a>    shrink<span class="sc">:</span> <span class="cn">TRUE</span></span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a>    train_scales<span class="sc">:</span> <span class="cf">function</span></span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a>    vars<span class="sc">:</span> <span class="cf">function</span></span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a>    super<span class="sc">:</span>  <span class="er">&lt;</span>ggproto object<span class="sc">:</span> Class FacetNull, Facet, gg<span class="sc">&gt;</span></span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(g)</span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;gg&quot;</span>     <span class="st">&quot;ggplot&quot;</span></span></code></pre></div>
<ul>
<li>We can see above that the object <code>g</code> contains the
<em>dataset</em> maacs and the <em>mappings</em>.</li>
</ul>
</div>
<div id="no-plot-yet" class="section level3" number="3.3.9">
<h3><span class="header-section-number">3.3.9</span> No Plot Yet!</h3>
<p>Now, normally if we were to <code>print()</code> a
<code>ggplot</code> object, a plot would appear on the plot device.</p>
<p>However, our object <code>g</code> actually <strong>doesn’t contain
enough information</strong> to make a plot yet.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(maacs, <span class="fu">aes</span>(logpm25, NocturnalSympt))</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(g)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
</div>
<div id="first-plot-with-point-layer." class="section level3"
number="3.3.10">
<h3><span class="header-section-number">3.3.10</span> First plot with
point layer.</h3>
<p>To make a <em>scatterplot</em> we need add <strong>at least one
geom</strong>, such as points.</p>
<p>Here we literally <strong><em>add</em></strong> the
<code>geom_point()</code> function to create a traditional
scatterplot.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(maacs, <span class="fu">aes</span>(logpm25, NocturnalSympt))</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">134</span> rows containing missing <span class="fu">values</span> (geom_point).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
<ul>
<li>Notice that the <code>geom_point()</code> function was called with
no arguments.<br />
</li>
<li>We didn’t have to tell it about the data, we didn’t have to tell it
where the points were, we didn’t have to tell it anything.<br />
</li>
<li>That’s because the original ggplot object, which is encoded in this
g object, has all the information the <code>geom_point</code> will need.
And so we don’t have to separately specify it again.<br />
</li>
<li>Also, there are a bunch of defaults that <code>geom_point</code>
will use.</li>
</ul>
</div>
<div id="adding-more-layers-smooth." class="section level3"
number="3.3.11">
<h3><span class="header-section-number">3.3.11</span> Adding more
layers: smooth.</h3>
<p>Because the <em>data appear rather noisy</em>, it might be better if
we added <strong>a smoother</strong> <em>on top of the points</em> to
see if there is a <em>trend</em> in the data with PM2.5.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>()</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">geom_smooth()</span><span class="st">`</span> using method <span class="ot">=</span> <span class="st">&#39;loess&#39;</span> and formula <span class="st">&#39;y ~ x&#39;</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">134</span> rows containing non<span class="sc">-</span>finite <span class="fu">values</span> (stat_smooth).</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">134</span> rows containing missing <span class="fu">values</span> (geom_point).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
<ul>
<li>The <strong>default smoother</strong> is a <em>loess smoother</em>,
which is flexible and nonparametric but might be <em>too flexible for
our purposes</em>.<br />
</li>
<li>There’s in fact a lot of noise on the boundaries (because there’s
not much data), so on the left and right side of the smoother the
confidence intervals get very wide because it’s a flexible
smoother.</li>
</ul>
<p>Perhaps we’d prefer a <strong>simple linear regression line</strong>
to highlight any <em>first order</em> <em>trends</em>.</p>
<ul>
<li>We can do this by <em>specifying</em> <code>method = "lm"</code> to
<code>geom_smooth()</code>.</li>
</ul>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">geom_smooth()</span><span class="st">`</span> using formula <span class="st">&#39;y ~ x&#39;</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">134</span> rows containing non<span class="sc">-</span>finite <span class="fu">values</span> (stat_smooth).</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">134</span> rows containing missing <span class="fu">values</span> (geom_point).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
<ul>
<li>We can see that on the edges of the linear model, the uncertainty in
the compass band is a lot smaller than it is for the previous loess
smoother.<br />
</li>
<li>And we can see there appears to be a <em>slight increasing
trend</em>, suggesting that higher levels of PM2.5 are associated with
increased days with nocturnal symptoms.</li>
</ul>
</div>
<div id="adding-more-layers-facets." class="section level3"
number="3.3.12">
<h3><span class="header-section-number">3.3.12</span> Adding more
layers: facets.</h3>
<p>Because our primary question involves comparing overweight
individuals to normal weight individuals, we can <em>stratify the
scatterplot</em> of PM2.5 and nocturnal symptoms by the <em>BMI
category</em> (<code>bmicat</code>) variable, which indicates whether an
individual is <em>overweight</em> or <em>not</em>.</p>
<p>To visualize this we can <strong><em>add</em></strong> a
<code>facet_grid()</code>.</p>
<ul>
<li>It takes a <strong>formula</strong> argument.<br />
</li>
<li>Here we want <em>one row</em> and <em>two columns</em> (one column
for each weight category).<br />
</li>
<li>So we specify <em>bmicat on the right</em> hand side of the
forumla.</li>
</ul>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">facet_grid</span>(. <span class="sc">~</span> bmicat)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">geom_smooth()</span><span class="st">`</span> using formula <span class="st">&#39;y ~ x&#39;</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">134</span> rows containing non<span class="sc">-</span>finite <span class="fu">values</span> (stat_smooth).</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">134</span> rows containing missing <span class="fu">values</span> (geom_point).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
<ul>
<li>It seems clear that the <em>relationship</em> between PM2.5 and
nocturnal symptoms is <em>relatively flat</em> amongst <em>normal weight
individuals</em>, while the relationship is <em>increasing</em> amongst
<em>overweight individuals</em>.<br />
</li>
<li>This plot suggests that overweight individuals may be more
susceptible to the effects of PM2.5.</li>
</ul>
</div>
<div id="annotations." class="section level3" number="3.3.13">
<h3><span class="header-section-number">3.3.13</span> Annotations.</h3>
<p>There are a variety of annotations you can add to a plot, including
different kinds of labels.</p>
<ul>
<li>For <strong>labels</strong>, we can use:
<ul>
<li><code>xlab()</code>, <code>ylab()</code>.<br />
</li>
<li><code>ggtitle()</code>, for specifying plot titles.<br />
</li>
<li><code>labs()</code>, is a generic function that can be used to
modify multiple types of labels <em>at once</em>.<br />
</li>
</ul></li>
<li>Each of the <strong>“geom” functions</strong> has options to
modify.<br />
</li>
<li>For <strong>things</strong> that <strong>only make sense
globally</strong>, use <code>theme()</code>.
<ul>
<li>For example: <code>theme(legend.position = "none")</code>.<br />
</li>
</ul></li>
<li><strong>Two standard appearance themes</strong> are included:
<ul>
<li><code>theme_gray()</code>: the default theme (gray
background).<br />
</li>
<li><code>theme_bw()</code>: more stark/plain.</li>
</ul></li>
</ul>
<div id="modifying-geom-properties." class="section level4"
number="3.3.13.1">
<h4><span class="header-section-number">3.3.13.1</span> Modifying geom
properties.</h4>
<p>We can modify properties of geoms <em>by specifying options</em> to
their <strong>respective geom_*()</strong> functions.</p>
<p>For example, here we <em>modify the points</em> in the scatterplot to
make the <code>color</code> “steelblue”, the <code>size</code> larger
and the <code>alpha</code> transparency greater.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">134</span> rows containing missing <span class="fu">values</span> (geom_point).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
</div>
<div id="using-aes-to-map-geom-properties-aesthetics-to-variables."
class="section level4" number="3.3.13.2">
<h4><span class="header-section-number">3.3.13.2</span> Using
<code>aes()</code> to map geom properties (aesthetics) to
variables.</h4>
<p>In addition to setting specific geom attributes to constants, we can
<em>map aesthetics</em> to <em>variables</em>.</p>
<p>So, here, we map the <code>color</code> aesthetic to the variable
<code>bmicat</code>, so the points will be colored according to the
levels of bmicat.</p>
<p>We use <strong>the <code>aes()</code> function</strong> to indicate
this difference from the plot above.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> bmicat), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">134</span> rows containing missing <span class="fu">values</span> (geom_point).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-71-1.png" width="672" /></p>
</div>
<div id="modifying-labels." class="section level4" number="3.3.13.3">
<h4><span class="header-section-number">3.3.13.3</span> Modifying
labels.</h4>
<p>Here is an example of modifying the <code>title</code> and the
<code>x</code> and <code>y</code> labels to make the plot a bit more
informative.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> bmicat)) <span class="sc">+</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;MAACS Cohort&quot;</span>) <span class="sc">+</span> </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="st">&quot;log &quot;</span> <span class="sc">*</span> PM[<span class="fl">2.5</span>]), <span class="at">y =</span> <span class="st">&quot;Nocturnal Symptoms&quot;</span>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">134</span> rows containing missing <span class="fu">values</span> (geom_point).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
</div>
<div id="customizing-the-smooth." class="section level4"
number="3.3.13.4">
<h4><span class="header-section-number">3.3.13.4</span> Customizing the
smooth.</h4>
<p>We can also <strong>customize aspects of the smoother</strong> that
we overlay on the points with <code>geom_smooth()</code> (again, we
modify properties of this paricular geom).</p>
<p>Here we change the <code>linetype</code> and increase the
<code>size</code> from the default. We also remove the shaded standard
error (<code>se</code>) from the line.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> bmicat), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_smooth</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">geom_smooth()</span><span class="st">`</span> using formula <span class="st">&#39;y ~ x&#39;</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">134</span> rows containing non<span class="sc">-</span>finite <span class="fu">values</span> (stat_smooth).</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">134</span> rows containing missing <span class="fu">values</span> (geom_point).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
</div>
<div id="changing-the-theme." class="section level4" number="3.3.13.5">
<h4><span class="header-section-number">3.3.13.5</span> Changing the
theme.</h4>
<p>The default theme for <code>ggplot2</code> uses the <em>gray
background</em> with <em>white grid lines</em>.</p>
<p>If we don’t find this suitable, we can use the <strong>black and
white theme</strong> by using the <code>theme_bw()</code> function.</p>
<ul>
<li>The <code>theme_bw()</code> function <em>also allows</em> you to set
the <strong>type font</strong> for the plot, in case we don’t want the
<em>default Helvetica</em>.<br />
</li>
<li>Here we change the type font to <em>Times</em>.</li>
</ul>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> bmicat)) <span class="sc">+</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_bw</span>(<span class="at">base_family =</span> <span class="st">&quot;Times&quot;</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">134</span> rows containing missing <span class="fu">values</span> (geom_point).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
</div>
<div
id="a-note-about-axis-limits-ylim-param-of-coord_cartesian-function-instead-of-ylim-function."
class="section level4" number="3.3.13.6">
<h4><span class="header-section-number">3.3.13.6</span> A note about
axis limits: <code>ylim</code> param of <code>coord_cartesian()</code>
function instead of <code>ylim()</code> function.</h4>
<p>One <strong>quick quirk about <code>ggplot2</code></strong> can be
displayed in the following situation.</p>
<p>Suppose we make a <em>lot of time series plots</em> and we often want
to <em>restrict the range</em> of the <em>y-axis</em> while <em>still
plotting all the data</em>.</p>
<p>In the <code>base</code> graphics system we can do that as
follows.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>testdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>))</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>testdat[<span class="dv">50</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">100</span>                                       <span class="do">## Outlier!</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(testdat<span class="sc">$</span>x, testdat<span class="sc">$</span>y, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>))</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<ul>
<li>Here we’ve restricted the y-axis range to be between -3 and 3, even
though there is a clear outlier in the data.<br />
</li>
<li>Typically if we have some outlier like this we don’t want to look at
the outlier, we just want to look at the core of the data. So it’s
typical to set the the y axis limits to be roughly kind of where the
data are and just ignore the outlier.<br />
</li>
<li>So we can see that the time series that gets drawn has all the data
connected and that we can see roughly where it’s going to shoot off to a
hundred (the outlier) and comes back down to be roughly where it’s
suppose to be.<br />
</li>
<li>So we know that outlier is out there somewhere, but we don’t see it
in the plot.</li>
</ul>
<p>With <code>ggplot2</code> the <em>default settings</em> will <em>give
us</em> this.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(testdat, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y))</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
<p><strong>Modifying the <code>ylim()</code> attribute</strong> would
seem to give us the same thing as the <code>base</code> plot, but
<strong><em>it doesn’t</em></strong>.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
<ul>
<li>Effectively, <strong><em>what this does</em></strong> is
<strong><em>subset the data</em></strong> so that only observations
between -3 and 3 are included, <strong><em>then plot</em></strong> the
data.</li>
</ul>
<p>To <strong><em>plot the data without subsetting it
first</em></strong> and still get the restricted range, we have to
<em>do the following</em>:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>))</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
<ul>
<li>The outlier y value at x = 50 is not shown, but the plot indicates
that it is larger than 3.</li>
</ul>
</div>
</div>
<div id="more-complex-example." class="section level3" number="3.3.14">
<h3><span class="header-section-number">3.3.14</span> More complex
example.</h3>
<p>Let’s see a slightly more complicated example with an <em>additional
variable</em>.</p>
<p>Now, we will ask <strong>the question</strong>:</p>
<blockquote>
<p>How does the relationship between <em>PM2.5</em> and <em>nocturnal
symptoms</em> vary by <em>BMI category</em> and <em>nitrogen
dioxide</em> (NO2)?</p>
</blockquote>
<p>Unlike our previous BMI variable, <strong>NO2 is continuous</strong>,
and so we <em>need to make</em> <em>NO2 categorical</em> so we can
condition on it in the plotting.</p>
<ul>
<li>We can use <strong>the <code>cut()</code> function</strong> for this
purpose.<br />
</li>
<li>We will <em>divide</em> the NO2 variable <em>into
tertiles</em>.</li>
</ul>
<div id="making-no_2-tertiles." class="section level4"
number="3.3.14.1">
<h4><span class="header-section-number">3.3.14.1</span> Making NO<span
class="math inline">\(_2\)</span> tertiles.</h4>
<ul>
<li>First we need to <em>calculate the tertiles</em> with the
<code>quantile()</code> function.<br />
</li>
<li>Then we need to <em>divide</em> the original <code>logno2_new</code>
variable into the ranges defined by the cut points computed above.<br />
</li>
<li>We do that with the <code>cut()</code> function, which returns a
<code>factor</code> object (containing three levels indicating the
ranges of NO2 on the log scale) that we assign to a new
<code>no2tert</code> variable.</li>
</ul>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate the tertiles of the data</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>cutpoints <span class="ot">&lt;-</span> <span class="fu">quantile</span>(maacs<span class="sc">$</span>logno2_new, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">4</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Cut the data at the tertiles and create a new factor variable</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>maacs<span class="sc">$</span>no2tert <span class="ot">&lt;-</span> <span class="fu">cut</span>(maacs<span class="sc">$</span>logno2_new, cutpoints)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="do">## See the levels of the newly created factor variable</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(maacs<span class="sc">$</span>no2tert)</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;(-0.629,1.18]&quot;</span> <span class="st">&quot;(1.18,1.44]&quot;</span>   <span class="st">&quot;(1.44,2.48]&quot;</span>  </span></code></pre></div>
</div>
<div id="the-final-plot." class="section level4" number="3.3.14.2">
<h4><span class="header-section-number">3.3.14.2</span> The final
plot.</h4>
<p>The final plot shows the relationship between PM2.5 and nocturnal
symptoms by BMI category and NO2 tertile.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Setup ggplot with data frame</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(maacs, <span class="fu">aes</span>(logpm25, NocturnalSympt))</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Add layers</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">facet_wrap</span>(bmicat <span class="sc">~</span> no2tert, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">col =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span> </span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_bw</span>(<span class="at">base_family =</span> <span class="st">&quot;Avenir&quot;</span>, <span class="at">base_size =</span> <span class="dv">10</span>) <span class="sc">+</span> </span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="st">&quot;log &quot;</span> <span class="sc">*</span> PM[<span class="fl">2.5</span>])) <span class="sc">+</span> </span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Nocturnal Symptoms&quot;</span>) <span class="sc">+</span> </span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;MAACS Cohort&quot;</span>)</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">geom_smooth()</span><span class="st">`</span> using formula <span class="st">&#39;y ~ x&#39;</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">134</span> rows containing non<span class="sc">-</span>finite <span class="fu">values</span> (stat_smooth).</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Removed <span class="dv">134</span> rows containing missing <span class="fu">values</span> (geom_point).</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
</div>
<div id="just-for-fun." class="section level4" number="3.3.14.3">
<h4><span class="header-section-number">3.3.14.3</span> Just for
fun.</h4>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, hwy, <span class="at">color =</span> <span class="fu">factor</span>(year)))</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">facet_grid</span>(drv <span class="sc">~</span> cyl, <span class="at">margins =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Displacement&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Highway Mileage&quot;</span>, <span class="at">title =</span> <span class="st">&quot;What a plot!&quot;</span>)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">geom_smooth()</span><span class="st">`</span> using formula <span class="st">&#39;y ~ x&#39;</span></span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="ggplot2-extras." class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> <code>ggplot2</code>
extras.</h2>
<p>We’ll go through a few more <code>qplot()</code> examples using
<code>diamond</code> data which comes with the <code>ggplot2</code>
package.</p>
<ul>
<li>This data is a little more complicated than the <code>mpg</code>
data and it contains information on various characteristics of
diamonds.</li>
</ul>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(diamonds)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>tibble [<span class="dv">53</span>,<span class="dv">940</span> × <span class="dv">11</span>] (S3<span class="sc">:</span> tbl_df<span class="sc">/</span>tbl<span class="sc">/</span>data.frame)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> carat  <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="fl">0.23</span> <span class="fl">0.21</span> <span class="fl">0.23</span> <span class="fl">0.29</span> <span class="fl">0.31</span> <span class="fl">0.24</span> <span class="fl">0.24</span> <span class="fl">0.26</span> <span class="fl">0.22</span> <span class="fl">0.23</span> ...</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> cut    <span class="sc">:</span> Ord.factor w<span class="sc">/</span> <span class="dv">5</span> levels <span class="st">&quot;Fair&quot;</span><span class="sc">&lt;</span><span class="st">&quot;Good&quot;</span><span class="sc">&lt;</span>..<span class="sc">:</span> <span class="dv">5</span> <span class="dv">4</span> <span class="dv">2</span> <span class="dv">4</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">1</span> <span class="dv">3</span> ...</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> color  <span class="sc">:</span> Ord.factor w<span class="sc">/</span> <span class="dv">7</span> levels <span class="st">&quot;D&quot;</span><span class="sc">&lt;</span><span class="st">&quot;E&quot;</span><span class="sc">&lt;</span><span class="st">&quot;F&quot;</span><span class="sc">&lt;</span><span class="st">&quot;G&quot;</span><span class="sc">&lt;</span>..<span class="sc">:</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">7</span> <span class="dv">6</span> <span class="dv">5</span> <span class="dv">2</span> <span class="dv">5</span> ...</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> clarity<span class="sc">:</span> Ord.factor w<span class="sc">/</span> <span class="dv">8</span> levels <span class="st">&quot;I1&quot;</span><span class="sc">&lt;</span><span class="st">&quot;SI2&quot;</span><span class="sc">&lt;</span><span class="st">&quot;SI1&quot;</span><span class="sc">&lt;</span>..<span class="sc">:</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">5</span> <span class="dv">4</span> <span class="dv">2</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span> ...</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> depth  <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="fl">61.5</span> <span class="fl">59.8</span> <span class="fl">56.9</span> <span class="fl">62.4</span> <span class="fl">63.3</span> <span class="fl">62.8</span> <span class="fl">62.3</span> <span class="fl">61.9</span> <span class="fl">65.1</span> <span class="fl">59.4</span> ...</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> table  <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="dv">55</span> <span class="dv">61</span> <span class="dv">65</span> <span class="dv">58</span> <span class="dv">58</span> <span class="dv">57</span> <span class="dv">57</span> <span class="dv">55</span> <span class="dv">61</span> <span class="dv">61</span> ...</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> price  <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="dv">326</span> <span class="dv">326</span> <span class="dv">327</span> <span class="dv">334</span> <span class="dv">335</span> <span class="dv">336</span> <span class="dv">336</span> <span class="dv">337</span> <span class="dv">337</span> <span class="dv">338</span> ...</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> x      <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="fl">3.95</span> <span class="fl">3.89</span> <span class="fl">4.05</span> <span class="fl">4.2</span> <span class="fl">4.34</span> <span class="fl">3.94</span> <span class="fl">3.95</span> <span class="fl">4.07</span> <span class="fl">3.87</span> <span class="dv">4</span> ...</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> y      <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="fl">3.98</span> <span class="fl">3.84</span> <span class="fl">4.07</span> <span class="fl">4.23</span> <span class="fl">4.35</span> <span class="fl">3.96</span> <span class="fl">3.98</span> <span class="fl">4.11</span> <span class="fl">3.78</span> <span class="fl">4.05</span> ...</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> z      <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="fl">2.43</span> <span class="fl">2.31</span> <span class="fl">2.31</span> <span class="fl">2.63</span> <span class="fl">2.75</span> <span class="fl">2.48</span> <span class="fl">2.47</span> <span class="fl">2.53</span> <span class="fl">2.49</span> <span class="fl">2.39</span> ...</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> car2   <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">3</span> levels <span class="st">&quot;(0.2,0.5]&quot;</span>,<span class="st">&quot;(0.5,1]&quot;</span>,..<span class="sc">:</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span></code></pre></div>
<p>Now <strong>let’s plot a histogram of the price</strong> of the 53940
diamonds in this dataset.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(price, <span class="at">data =</span> diamonds)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">stat_bin()</span><span class="st">`</span> using <span class="st">`</span><span class="at">bins = 30</span><span class="st">`</span>. Pick better value with <span class="st">`</span><span class="at">binwidth</span><span class="st">`</span>.</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p>
<ul>
<li>We can see the frequency of different diamond prices.<br />
</li>
<li>And we get not only a histogram, but also a <strong>message about
the binwidth</strong> <em>defaulting</em> to <strong>range/30</strong>
(range refers to the spread or dispersion of the data, in this case
price of diamonds).</li>
</ul>
<p>So, let’s see the range of the variable price.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(diamonds<span class="sc">$</span>price)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>]   <span class="dv">326</span> <span class="dv">18823</span></span></code></pre></div>
<p>We know now that the <strong>price range</strong> is max price - min
price = $18,497, se let’s <strong>specify explicitly the
<code>bindwidth</code></strong>.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(price, <span class="at">data =</span> diamonds, <span class="at">binwidth =</span> <span class="dv">18497</span><span class="sc">/</span><span class="dv">30</span>)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-85-1.png" width="672" /></p>
<ul>
<li>We get <em>practically the same</em> plot, but <strong>without any
message about binwidth</strong>.<br />
</li>
<li>The <code>binwidth</code> 18497/30 = 616.5667, means that the height
of each bin tells us how many diamonds have a price <strong>between
<code>x</code> and <code>x + 617</code></strong>, where <code>x</code>
is the <strong>left edge of the bin</strong>.</li>
</ul>
<p>Now we can <strong>map a third variable,
<code>cut</code></strong>:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(price, <span class="at">data =</span> diamonds, <span class="at">binwidth =</span> <span class="dv">18497</span><span class="sc">/</span><span class="dv">30</span>, <span class="at">fill =</span> cut)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-86-1.png" width="672" /></p>
<ul>
<li>This shows how the counts within each price grouping (bin) are
distributed among the different cuts of diamonds.<br />
</li>
<li>Notice how <code>qplot</code> displays these distributions relative
to the cut legend on the right.
<ul>
<li>The <em>fair cut</em> diamonds are at the <strong>bottom of each
bin</strong>.<br />
</li>
<li>The <em>good cuts</em> are <strong>above them</strong>, then the
<em>very good</em> <strong>above them</strong>.<br />
</li>
<li>Until the <em>ideal cuts</em> are <strong>at the top of each
bin</strong>.<br />
</li>
</ul></li>
<li>We can quickly see from this display that there are very few fair
cut diamonds priced above $5000.</li>
</ul>
<p>Now we’ll <em>replot the histogram</em> as a <strong>density
function</strong> which will show the <em>proportion</em> of diamonds
<em>in each bin</em>.</p>
<ul>
<li>This means that the <em>shape will be similar</em> <strong>but the
scale</strong> on the <strong>y-axis</strong> will be
<strong>different</strong> since, <strong>by definition</strong>:
<ul>
<li>The density function is <em>nonnegative everywhere</em>, and<br />
</li>
<li>The <em>area under the curve is one</em>.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(price, <span class="at">data =</span> diamonds, <span class="at">geom =</span> <span class="st">&quot;density&quot;</span>)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-87-1.png" width="672" /></p>
<ul>
<li>In fact, the shape is similar to that of the histogram we saw
previously.<br />
</li>
<li>The <em>highest peak</em> is close to <code>0</code> on the x-axis
meaning that most of the diamonds in the dataset were inexpensive.<br />
</li>
<li>In general, as <em>prices increase</em> the <em>number of diamonds
(at those prices) decrease</em>.<br />
</li>
<li>The <em>exception</em> to this is when the price is <em>around
$4000</em>; there’s a <strong>slight</strong> <strong>increase in
frequency</strong>.</li>
</ul>
<p>Let’s see if <code>cut</code> is responsible for that exceptional
increase.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(price, <span class="at">data =</span> diamonds, <span class="at">geom =</span> <span class="st">&quot;density&quot;</span>, <span class="at">color =</span> cut)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-88-1.png" width="672" /></p>
<ul>
<li>Four of the five cuts have 2 peaks, one at price $1000 and the other
between $4000 and $5000.<br />
</li>
<li>The exception is the <em>Fair cut</em> which has a <em>single peak
at $2500</em>.<br />
</li>
<li>This gives us a little more understanding of the histogram we saw
before.</li>
</ul>
<p>Let’s <strong>move on to scatterplots</strong>.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(carat, price, <span class="at">data =</span> diamonds)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-89-1.png" width="672" /></p>
<ul>
<li>We see the positive trend here, as the number of carats increases
the price also goes up.</li>
</ul>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(carat, price, <span class="at">data =</span> diamonds, <span class="at">shape =</span> cut)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Using shapes <span class="cf">for</span> an ordinal variable is not advised</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-90-1.png" width="672" /></p>
<ul>
<li>Mapping <code>cut</code> to <code>shape aesthetics</code> doesn’t
seem a good choice: the symbols are small and hard to read.</li>
</ul>
<p>So let’s try mapping to <code>color</code>.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(carat, price, <span class="at">data =</span> diamonds, <span class="at">color =</span> cut)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-91-1.png" width="672" /></p>
<ul>
<li>That’s easier to see!</li>
</ul>
<p>Now we can <strong>add a smoother</strong>, in particular, a
<strong>regression line</strong>.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(carat, price, <span class="at">data =</span> diamonds, <span class="at">color =</span> cut) <span class="sc">+</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">geom_smooth()</span><span class="st">`</span> using formula <span class="st">&#39;y ~ x&#39;</span></span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-92-1.png" width="672" /></p>
<ul>
<li>We see the same scatterplot, but slightly more compressed and
showing 5 regression lines, one for each cut of diamonds.<br />
</li>
<li>It might be <em>hard to see</em>, but around each line is a
<em>shadow</em> showing the 95% confidence interval.<br />
</li>
<li>We see, unsurprisingly, that <em>the better</em> the cut, <em>the
steeper</em> (more positive) the slope of the lines.</li>
</ul>
<p>We could <strong>divide the plot in panels</strong> if we wanted, one
for each <code>cut</code>.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(carat, price, <span class="at">data =</span> diamonds, <span class="at">color =</span> cut, <span class="at">facets =</span> . <span class="sc">~</span> cut) <span class="sc">+</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">geom_smooth()</span><span class="st">`</span> using formula <span class="st">&#39;y ~ x&#39;</span></span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-93-1.png" width="672" /></p>
<p>Now let’s put aside <code>qplot()</code> and <strong>start using
<code>ggplot()</code></strong> and make a scatterplot of diamonds
<code>depth</code> and <code>price</code>.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(depth, price))</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-94-1.png" width="672" /></p>
<ul>
<li>That’s somewhat interesting.<br />
</li>
<li>We see that <code>depth</code> ranges <em>from 43 to 79</em>, but
the <em>densest distribution</em> is <em>around 60 to 65</em>.</li>
</ul>
<p>Suppose we want to see if this relationship (between depth and price)
is affected by <code>cut</code> or <code>carat</code>.</p>
<ul>
<li>We know <code>cut</code> is a <strong>factor</strong> with 5 levels
(Fair, Good, Very Good, Premium and Ideal).<br />
</li>
<li>But <code>carat</code> is <strong>numeric</strong> and not a
discrete factor.</li>
</ul>
<p>So let’s use the <code>cut()</code> function on <code>carat</code>,
to create a new factor by:</p>
<ul>
<li>dividing the data into sets and labeling each entry as belonging to
one of the sets.</li>
</ul>
<p>First, we know that we’ll have to decide where to cut the data and
use the <code>quantile()</code> command to do it:</p>
<ul>
<li>Let’s divide the data into <em>3 pockets</em>, so 1/3 of the data
falls into each.</li>
</ul>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>cutpoints <span class="ot">&lt;-</span> <span class="fu">quantile</span>(diamonds<span class="sc">$</span>carat, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">4</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>cutpoints</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>       <span class="dv">0</span><span class="sc">% 33.33333%</span> <span class="fl">66.66667</span><span class="sc">%      100%</span> </span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.20</span>      <span class="fl">0.50</span>      <span class="fl">1.00</span>      <span class="fl">5.01</span> </span></code></pre></div>
<ul>
<li>We see a <em>4-long</em> vector (explaining <em>why length was set
equal to 4</em>).<br />
</li>
<li>We also see that <code>0.20</code> is the <em>smallest</em> carat
size in the dataset and <code>5.01</code> is the <em>largest</em>.<br />
</li>
<li><em>One third</em> of the diamonds are between .2 and .5 carats and
<em>another third</em> are between .5 and 1 carat in size. The
<em>remaining third</em> are between 1 and 5.01 carats.</li>
</ul>
<p>Now we can use the R command <code>cut()</code> <strong>to
label</strong> each of the 53940 diamonds in the dataset <strong>as
belonging to one of these 3 factors</strong>.</p>
<div class="sourceCode" id="cb100"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>diamonds<span class="sc">$</span>car2 <span class="ot">&lt;-</span> <span class="fu">cut</span>(diamonds<span class="sc">$</span>carat, cutpoints)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(diamonds<span class="sc">$</span>car2)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;(0.2,0.5]&quot;</span> <span class="st">&quot;(0.5,1]&quot;</span>   <span class="st">&quot;(1,5.01]&quot;</span> </span></code></pre></div>
<p>Now we can <strong>continue with our multi-facet plot</strong>.</p>
<ul>
<li>First we have to <strong>reset <code>g</code></strong> since
<strong>we changed the dataset</strong> it contained (by <em>adding a
new column</em>).</li>
</ul>
<div class="sourceCode" id="cb101"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(depth, price))</span></code></pre></div>
<ul>
<li>Now let’s finally make the panels appear.</li>
</ul>
<div class="sourceCode" id="cb102"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span> <span class="fu">facet_grid</span>(cut <span class="sc">~</span> car2)</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-98-1.png" width="672" /></p>
<ul>
<li>The first 3 columns are labeled with the cutpoint boundaries. The
fourth is labeled NA and shows us where the data points with
<strong>missing data</strong> (NA or Not Available) occurred.<br />
</li>
<li>We see that there were only a handful (12 in fact) and they occurred
in Very Good, Premium, and Ideal cuts.</li>
</ul>
<div class="sourceCode" id="cb103"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>diamonds[<span class="fu">which</span>(<span class="fu">is.na</span>(diamonds<span class="sc">$</span>car2)), ]</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 12 × 11</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>   carat cut       color clarity depth table price     x     y     z car2 </span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>   <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>ord<span class="sc">&gt;</span>     <span class="er">&lt;</span>ord<span class="sc">&gt;</span> <span class="er">&lt;</span>ord<span class="sc">&gt;</span>   <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>fct<span class="sc">&gt;</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span>   <span class="fl">0.2</span> Premium   E     SI2      <span class="fl">60.2</span>    <span class="dv">62</span>   <span class="dv">345</span>  <span class="fl">3.79</span>  <span class="fl">3.75</span>  <span class="fl">2.27</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span>   <span class="fl">0.2</span> Premium   E     VS2      <span class="fl">59.8</span>    <span class="dv">62</span>   <span class="dv">367</span>  <span class="fl">3.79</span>  <span class="fl">3.77</span>  <span class="fl">2.26</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span>   <span class="fl">0.2</span> Premium   E     VS2      <span class="dv">59</span>      <span class="dv">60</span>   <span class="dv">367</span>  <span class="fl">3.81</span>  <span class="fl">3.78</span>  <span class="fl">2.24</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span>   <span class="fl">0.2</span> Premium   E     VS2      <span class="fl">61.1</span>    <span class="dv">59</span>   <span class="dv">367</span>  <span class="fl">3.81</span>  <span class="fl">3.78</span>  <span class="fl">2.32</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span>   <span class="fl">0.2</span> Premium   E     VS2      <span class="fl">59.7</span>    <span class="dv">62</span>   <span class="dv">367</span>  <span class="fl">3.84</span>  <span class="fl">3.8</span>   <span class="fl">2.28</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span>   <span class="fl">0.2</span> Ideal     E     VS2      <span class="fl">59.7</span>    <span class="dv">55</span>   <span class="dv">367</span>  <span class="fl">3.86</span>  <span class="fl">3.84</span>  <span class="fl">2.3</span>  <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span>   <span class="fl">0.2</span> Premium   F     VS2      <span class="fl">62.6</span>    <span class="dv">59</span>   <span class="dv">367</span>  <span class="fl">3.73</span>  <span class="fl">3.71</span>  <span class="fl">2.33</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span>   <span class="fl">0.2</span> Ideal     D     VS2      <span class="fl">61.5</span>    <span class="dv">57</span>   <span class="dv">367</span>  <span class="fl">3.81</span>  <span class="fl">3.77</span>  <span class="fl">2.33</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span>   <span class="fl">0.2</span> Very Good E     VS2      <span class="fl">63.4</span>    <span class="dv">59</span>   <span class="dv">367</span>  <span class="fl">3.74</span>  <span class="fl">3.71</span>  <span class="fl">2.36</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>   <span class="fl">0.2</span> Ideal     E     VS2      <span class="fl">62.2</span>    <span class="dv">57</span>   <span class="dv">367</span>  <span class="fl">3.76</span>  <span class="fl">3.73</span>  <span class="fl">2.33</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span>   <span class="fl">0.2</span> Premium   D     VS2      <span class="fl">62.3</span>    <span class="dv">60</span>   <span class="dv">367</span>  <span class="fl">3.73</span>  <span class="fl">3.68</span>  <span class="fl">2.31</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span>   <span class="fl">0.2</span> Premium   D     VS2      <span class="fl">61.7</span>    <span class="dv">60</span>   <span class="dv">367</span>  <span class="fl">3.77</span>  <span class="fl">3.72</span>  <span class="fl">2.31</span> <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span></code></pre></div>
<ul>
<li>The <code>car2</code> field is, in fact, <code>NA</code> for these
entries, but the <code>carat</code> field shows they each had a carat
size of <code>0.2</code>.<br />
</li>
<li><strong>What’s going on here?</strong><br />
</li>
<li>Actually our plot answers this question. The <strong>boundaries for
each column</strong> appear in the gray labels at the top of each
column, and we see that the first column is labeled
<code>(0.2,0.5]</code>.<br />
</li>
<li>This indicates that this column contains data <em>greater</em> than
<code>.2</code>, so diamonds with carat size <em>equal</em> to
<code>.2</code> were excluded from the <code>car2</code> field.</li>
</ul>
<p>Let’s <strong>add a regression line</strong>.</p>
<div class="sourceCode" id="cb104"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">facet_grid</span>(cut <span class="sc">~</span> car2) <span class="sc">+</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">&quot;pink&quot;</span>)</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">geom_smooth()</span><span class="st">`</span> using formula <span class="st">&#39;y ~ x&#39;</span></span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-100-1.png" width="672" /></p>
<ul>
<li>Nice thick regression lines which are somewhat interesting.</li>
</ul>
<p>And <strong>some labels?</strong></p>
<ul>
<li>Naaaa, enough!</li>
</ul>
<p>But we can’t deny a final <strong>boxplot</strong>.</p>
<div class="sourceCode" id="cb105"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, price)) <span class="sc">+</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">facet_grid</span>(. <span class="sc">~</span> cut)</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>Warning<span class="sc">:</span> Continuous x aesthetic <span class="sc">--</span> did you forget <span class="fu">aes</span>(<span class="at">group=</span>...)?</span></code></pre></div>
<p><img src="4_ExploratoryDataAnalysis_Module2_files/figure-html/unnamed-chunk-101-1.png" width="672" /></p>
</div>
<div id="resources" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Resources</h2>
<ul>
<li><p>The <em>ggplot2</em> book by Hadley Wickham.</p></li>
<li><p>The <em>R Graphics Cookbook</em> by Winston Chang (examples in
base plots and in ggplot2).</p></li>
<li><p>ggplot2 web site <a href="http://ggplot2.org"
class="uri">http://ggplot2.org</a></p></li>
<li><p>ggplot2 mailing list (<a href="http://goo.gl/OdW3uB"
class="uri">http://goo.gl/OdW3uB</a>), primarily for
developers.</p></li>
</ul>
<hr />
</div>
</div>
<div id="session-info." class="section level1" number="4">
<h1><span class="header-section-number">4</span> Session Info.</h1>
<div class="sourceCode" id="cb106"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>R version <span class="dv">3</span>.<span class="fl">6.3</span> (<span class="dv">2020-02-29</span>)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>Platform<span class="sc">:</span> x86_64<span class="sc">-</span>pc<span class="sc">-</span>linux<span class="sc">-</span><span class="fu">gnu</span> (<span class="dv">64</span><span class="sc">-</span>bit)</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>Running under<span class="sc">:</span> Ubuntu <span class="dv">18</span>.<span class="fl">04.6</span> LTS</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>Matrix products<span class="sc">:</span> default</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>BLAS<span class="sc">:</span>   <span class="er">/</span>usr<span class="sc">/</span>lib<span class="sc">/</span>x86_64<span class="sc">-</span>linux<span class="sc">-</span>gnu<span class="sc">/</span>blas<span class="sc">/</span>libblas.so.<span class="dv">3</span>.<span class="fl">7.1</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>LAPACK<span class="sc">:</span> <span class="er">/</span>usr<span class="sc">/</span>lib<span class="sc">/</span>x86_64<span class="sc">-</span>linux<span class="sc">-</span>gnu<span class="sc">/</span>lapack<span class="sc">/</span>liblapack.so.<span class="dv">3</span>.<span class="fl">7.1</span></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>locale<span class="sc">:</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] LC_CTYPE<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span>          LC_NUMERIC<span class="ot">=</span>C                 </span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a> [<span class="dv">3</span>] LC_TIME<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span>           LC_COLLATE<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span>       </span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a> [<span class="dv">5</span>] LC_MONETARY<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span>       LC_MESSAGES<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span>      </span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a> [<span class="dv">7</span>] LC_PAPER<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span>          LC_NAME<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span>          </span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a> [<span class="dv">9</span>] LC_ADDRESS<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span>        LC_TELEPHONE<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span>     </span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>[<span class="dv">11</span>] LC_MEASUREMENT<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span>    LC_IDENTIFICATION<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>attached base packages<span class="sc">:</span></span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>other attached packages<span class="sc">:</span></span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] RColorBrewer_1<span class="fl">.1</span><span class="dv">-2</span> maps_3.<span class="fl">3.0</span>         stringr_1.<span class="fl">4.0</span>      lubridate_1.<span class="fl">9.2</span>   </span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a> [<span class="dv">5</span>] quantmod_0.<span class="fl">4.20</span>    TTR_0.<span class="fl">24.2</span>         xts_0.<span class="fl">12.1</span>         zoo_1<span class="fl">.8</span><span class="dv">-9</span>         </span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a> [<span class="dv">9</span>] readr_2.<span class="fl">0.1</span>        tidyr_1.<span class="fl">2.0</span>        dplyr_1.<span class="fl">0.8</span>        reshape2_1.<span class="fl">4.4</span>    </span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a>[<span class="dv">13</span>] Hmisc_4<span class="fl">.4</span><span class="dv">-0</span>        ggplot2_3.<span class="fl">3.5</span>      Formula_1<span class="fl">.2</span><span class="dv">-3</span>      survival_3<span class="fl">.4</span><span class="dv">-0</span>    </span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>[<span class="dv">17</span>] lattice_0<span class="fl">.20</span><span class="dv">-45</span>    jpeg_0<span class="fl">.1-8.1</span>       gitignore_0.<span class="fl">1.3</span>    rhdf5_2.<span class="fl">30.1</span>      </span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>[<span class="dv">21</span>] httr_1.<span class="fl">4.2</span>         httpuv_1.<span class="fl">6.3</span>       sqldf_0<span class="fl">.4</span><span class="dv">-11</span>       RSQLite_2.<span class="fl">2.0</span>     </span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>[<span class="dv">25</span>] gsubfn_0<span class="fl">.7</span>         proto_1.<span class="fl">0.0</span>        DBI_1.<span class="fl">1.1</span>          data.table_1.<span class="fl">14.0</span> </span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a>[<span class="dv">29</span>] jsonlite_1.<span class="fl">7.2</span>     XML_3<span class="fl">.99-0.3</span>       xlsx_0.<span class="fl">6.3</span>         plyr_1.<span class="fl">8.6</span>        </span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a>loaded via a <span class="fu">namespace</span> (and not attached)<span class="sc">:</span></span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] nlme_3<span class="fl">.1</span><span class="dv">-162</span>        bit64_4.<span class="fl">0.5</span>         tools_3.<span class="fl">6.3</span>        </span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a> [<span class="dv">4</span>] backports_1.<span class="fl">4.1</span>     bslib_0.<span class="fl">3.0</span>         utf8_1.<span class="fl">2.2</span>         </span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a> [<span class="dv">7</span>] R6_2.<span class="fl">5.1</span>            KernSmooth_2<span class="fl">.23</span><span class="dv">-20</span>  rpart_4.<span class="fl">1.19</span>       </span>
<span id="cb106-35"><a href="#cb106-35" aria-hidden="true" tabindex="-1"></a>[<span class="dv">10</span>] mgcv_1<span class="fl">.8</span><span class="dv">-41</span>         colorspace_2<span class="fl">.0</span><span class="dv">-3</span>    nnet_7<span class="fl">.3</span><span class="dv">-18</span>        </span>
<span id="cb106-36"><a href="#cb106-36" aria-hidden="true" tabindex="-1"></a>[<span class="dv">13</span>] withr_2.<span class="fl">5.0</span>         tidyselect_1.<span class="fl">2.0</span>    gridExtra_2<span class="fl">.3</span>      </span>
<span id="cb106-37"><a href="#cb106-37" aria-hidden="true" tabindex="-1"></a>[<span class="dv">16</span>] bit_4.<span class="fl">0.4</span>           curl_4.<span class="fl">3.2</span>          compiler_3.<span class="fl">6.3</span>     </span>
<span id="cb106-38"><a href="#cb106-38" aria-hidden="true" tabindex="-1"></a>[<span class="dv">19</span>] chron_2<span class="fl">.3</span><span class="dv">-55</span>        cli_3.<span class="fl">6.0</span>           formatR_1<span class="fl">.14</span>       </span>
<span id="cb106-39"><a href="#cb106-39" aria-hidden="true" tabindex="-1"></a>[<span class="dv">22</span>] htmlTable_2.<span class="fl">0.1</span>     labeling_0.<span class="fl">4.2</span>      sass_0.<span class="fl">4.0</span>         </span>
<span id="cb106-40"><a href="#cb106-40" aria-hidden="true" tabindex="-1"></a>[<span class="dv">25</span>] scales_1.<span class="fl">1.1</span>        checkmate_2.<span class="fl">0.0</span>     askpass_1<span class="fl">.1</span>        </span>
<span id="cb106-41"><a href="#cb106-41" aria-hidden="true" tabindex="-1"></a>[<span class="dv">28</span>] digest_0.<span class="fl">6.29</span>       foreign_0<span class="fl">.8</span><span class="dv">-76</span>      rmarkdown_2<span class="fl">.11</span>     </span>
<span id="cb106-42"><a href="#cb106-42" aria-hidden="true" tabindex="-1"></a>[<span class="dv">31</span>] base64enc_0<span class="fl">.1</span><span class="dv">-3</span>     pkgconfig_2.<span class="fl">0.3</span>     htmltools_0.<span class="fl">5.2</span>    </span>
<span id="cb106-43"><a href="#cb106-43" aria-hidden="true" tabindex="-1"></a>[<span class="dv">34</span>] fastmap_1.<span class="fl">1.0</span>       highr_0<span class="fl">.9</span>           htmlwidgets_1.<span class="fl">5.4</span>  </span>
<span id="cb106-44"><a href="#cb106-44" aria-hidden="true" tabindex="-1"></a>[<span class="dv">37</span>] rlang_1.<span class="fl">0.6</span>         rstudioapi_0<span class="fl">.13</span>     farver_2.<span class="fl">1.0</span>       </span>
<span id="cb106-45"><a href="#cb106-45" aria-hidden="true" tabindex="-1"></a>[<span class="dv">40</span>] jquerylib_0.<span class="fl">1.4</span>     generics_0.<span class="fl">1.2</span>      acepack_1.<span class="fl">4.1</span>      </span>
<span id="cb106-46"><a href="#cb106-46" aria-hidden="true" tabindex="-1"></a>[<span class="dv">43</span>] magrittr_2.<span class="fl">0.2</span>      Matrix_1<span class="fl">.5</span><span class="dv">-1</span>        Rcpp_1.<span class="fl">0.7</span>         </span>
<span id="cb106-47"><a href="#cb106-47" aria-hidden="true" tabindex="-1"></a>[<span class="dv">46</span>] munsell_0.<span class="fl">5.0</span>       Rhdf5lib_1.<span class="fl">8.0</span>      fansi_1.<span class="fl">0.2</span>        </span>
<span id="cb106-48"><a href="#cb106-48" aria-hidden="true" tabindex="-1"></a>[<span class="dv">49</span>] clipr_0.<span class="fl">7.1</span>         lifecycle_1.<span class="fl">0.3</span>     stringi_1.<span class="fl">7.6</span>      </span>
<span id="cb106-49"><a href="#cb106-49" aria-hidden="true" tabindex="-1"></a>[<span class="dv">52</span>] yaml_2.<span class="fl">2.1</span>          grid_3.<span class="fl">6.3</span>          blob_1.<span class="fl">2.2</span>         </span>
<span id="cb106-50"><a href="#cb106-50" aria-hidden="true" tabindex="-1"></a>[<span class="dv">55</span>] promises_1.<span class="dv">2</span>.<span class="fl">0.1</span>    crayon_1.<span class="fl">5.0</span>        splines_3.<span class="fl">6.3</span>      </span>
<span id="cb106-51"><a href="#cb106-51" aria-hidden="true" tabindex="-1"></a>[<span class="dv">58</span>] xlsxjars_0.<span class="fl">6.1</span>      hms_1.<span class="fl">1.0</span>           knitr_1<span class="fl">.41</span>         </span>
<span id="cb106-52"><a href="#cb106-52" aria-hidden="true" tabindex="-1"></a>[<span class="dv">61</span>] pillar_1.<span class="fl">7.0</span>        tcltk_3.<span class="fl">6.3</span>         glue_1.<span class="fl">6.2</span>         </span>
<span id="cb106-53"><a href="#cb106-53" aria-hidden="true" tabindex="-1"></a>[<span class="dv">64</span>] evaluate_0<span class="fl">.19</span>       latticeExtra_0<span class="fl">.6</span><span class="dv">-29</span> vctrs_0.<span class="fl">5.2</span>        </span>
<span id="cb106-54"><a href="#cb106-54" aria-hidden="true" tabindex="-1"></a>[<span class="dv">67</span>] png_0<span class="fl">.1</span><span class="dv">-7</span>           tzdb_0.<span class="fl">3.0</span>          gtable_0.<span class="fl">3.0</span>       </span>
<span id="cb106-55"><a href="#cb106-55" aria-hidden="true" tabindex="-1"></a>[<span class="dv">70</span>] openssl_2.<span class="fl">0.5</span>       purrr_0.<span class="fl">3.4</span>         assertthat_0.<span class="fl">2.1</span>   </span>
<span id="cb106-56"><a href="#cb106-56" aria-hidden="true" tabindex="-1"></a>[<span class="dv">73</span>] xfun_0<span class="fl">.36</span>           later_1.<span class="fl">3.0</span>         viridisLite_0.<span class="fl">4.0</span>  </span>
<span id="cb106-57"><a href="#cb106-57" aria-hidden="true" tabindex="-1"></a>[<span class="dv">76</span>] tibble_3.<span class="fl">1.8</span>        rJava_0<span class="fl">.9</span><span class="dv">-13</span>        memoise_1.<span class="fl">1.0</span>      </span>
<span id="cb106-58"><a href="#cb106-58" aria-hidden="true" tabindex="-1"></a>[<span class="dv">79</span>] cluster_2.<span class="fl">1.4</span>       timechange_0.<span class="fl">2.0</span>    ellipsis_0.<span class="fl">3.2</span>     </span></code></pre></div>
</div>

<div style="width: 100%; padding: 10px; box-sizing: border-box; text-align: justify; border: 1px solid gray;">
  <p style="font-family: 'Playfair Display', serif; font-style: italic;">Copyright &copy; 2020 por <b>Christian A. Karanicolas</b>.  Todos los derechos reservados.  La elaboración de este sitio ha tenido como fuente principal de información el curso de <b>Especialización en Ciencias de Datos</b> brindado por la <b>Johns Hopkins University</b> a través de <b>Coursera</b>.</p>
</div>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Playfair+Display&display=swap');
</style>


<!--
<p style="font-family: 'Playfair Display', serif; font-style: italic;">Copyright &copy; 2020 por <b>Christian A. Karanicolas</b>.  Todos los derechos reservados.  La elaboración de este sitio ha tenido como fuente principal de información el curso de <b>Especialización en Ciencias de Datos</b> brindado por la <b>Johns Hopkins University</b> a través de <b>Coursera</b>.</p>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Playfair+Display&display=swap');
</style>
-->


<!--
<p style="font-style: italic;">Copyright &copy; 2020 por <b>Christian A. Karanicolas</b>.  Todos los derechos reservados.  La elaboración de este sitio ha tenido como fuente principal de información el curso de <b>Especialización en Ciencias de Datos</b> brindado por la <b>Johns Hopkins University</b> a través de <b>Coursera</b>.</p>
-->




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
