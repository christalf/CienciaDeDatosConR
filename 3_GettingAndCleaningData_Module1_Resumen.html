<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Getting and Cleaning Data Course - Module 1</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Aprendiendo ciencia de datos con R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-hand-spock"></span>
     
    Resumen del contenido
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-bars"></span>
     
    Contenido
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="divider"></li>
    <li class="dropdown-header">Data Science Toolbox</li>
    <li class="divider"></li>
    <li>
      <a href="1_DataScienceToolBox_Resumen.html">Módulo único</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">R</li>
    <li class="divider"></li>
    <li>
      <a href="2_R_Module1_Resumen.html">Módulo 1</a>
    </li>
    <li>
      <a href="2_R_Module2_Resumen.html">Módulo 2</a>
    </li>
    <li>
      <a href="2_R_Module2_ProgAssmt_PrevPract.html">_práctica</a>
    </li>
    <li>
      <a href="2_R_Module2_ProgAssmt.html">_ejercicio</a>
    </li>
    <li>
      <a href="2_R_Module3_Resumen.html">Módulo 3</a>
    </li>
    <li>
      <a href="2_R_Module3_ProgAssmt.html">_ejercicio</a>
    </li>
    <li>
      <a href="2_R_Module4_Resumen.html">Módulo 4</a>
    </li>
    <li>
      <a href="2_R_Module4_ProgAssmt.html">Ejercicio final</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Getting &amp; Cleaning Data</li>
    <li class="divider"></li>
    <li>
      <a href="3_GettingAndCleaningData_Module1_Resumen.html">Módulo 1</a>
    </li>
    <li>
      <a href="3_GettingAndCleaningData_Module2_Resumen.html">Módulo 2</a>
    </li>
    <li>
      <a href="3_GettingAndCleaningData_Module2_Ejercicios.html">_ejercicios</a>
    </li>
    <li>
      <a href="3_GettingAndCleaningData_Module3_Resumen.html">Módulo 3</a>
    </li>
    <li>
      <a href="3_GettingAndCleaningData_Module3_Ejercicios.html">_ejercicios</a>
    </li>
    <li>
      <a href="3_GettingAndCleaningData_Module4.html">Módulo 4</a>
    </li>
    <li>
      <a href="3_GettingAndCleaningData_Module4_Ejercicios.html">_ejercicios</a>
    </li>
    <li>
      <a href="3_GettingAndCleaningData_FinalProj.html">Proyecto final</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Exploratory Data Analysis</li>
    <li class="divider"></li>
    <li>
      <a href="4_ExploratoryDataAnalysis_Module1.html">Módulo 1</a>
    </li>
    <li>
      <a href="4_ExploratoryDataAnalysis_Module1_Ejercicios.html">_ejercicios</a>
    </li>
    <li>
      <a href="4_ExploratoryDataAnalysis_Module2.html">Módulo 2</a>
    </li>
    <li>
      <a href="4_ExploratoryDataAnalysis_Module3.html">Módulo 3</a>
    </li>
    <li>
      <a href="4_ExploratoryDataAnalysis_Module4.html">Módulo 4</a>
    </li>
    <li>
      <a href="4_ExploratoryDataAnalysis_FinalProj.html">Proyecto final</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Reproducible Research</li>
    <li class="divider"></li>
    <li>
      <a href="5_ReproducibleResearch_Module1.html">Módulo 1</a>
    </li>
    <li>
      <a href="5_ReproducibleResearch_Module2.html">Módulo 2</a>
    </li>
    <li>
      <a href="5_ReproducibleResearch_Module3.html">Módulo 3</a>
    </li>
    <li>
      <a href="5_ReproducibleResearch_Module4.html">Módulo 4</a>
    </li>
    <li>
      <a href="5_ReproducibleResearch_FinalProj.html">Proyectos finales</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://bookdown.org/yihui/rmarkdown/rmarkdown-site.html">
    <span class="fa fa-gears"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Getting and Cleaning Data Course - Module
1</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction." id="toc-introduction."><span
class="toc-section-number">1</span> Introduction.</a>
<ul>
<li><a href="#examples." id="toc-examples."><span
class="toc-section-number">1.1</span> Examples.</a>
<ul>
<li><a href="#fastq-files---unstructured-data."
id="toc-fastq-files---unstructured-data."><span
class="toc-section-number">1.1.1</span> FASTQ files - unstructured
data.</a></li>
<li><a
href="#apis---json-format.-website-requests-open-data-website-from-baltimore."
id="toc-apis---json-format.-website-requests-open-data-website-from-baltimore."><span
class="toc-section-number">1.1.2</span> APIs - JSON format. Website
requests (Open Data website from Baltimore).</a></li>
<li><a href="#free-text-instructions."
id="toc-free-text-instructions."><span
class="toc-section-number">1.1.3</span> Free-text instructions.</a></li>
<li><a href="#databases---structured-environment."
id="toc-databases---structured-environment."><span
class="toc-section-number">1.1.4</span> Databases - structured
environment.</a></li>
</ul></li>
<li><a href="#conclusion." id="toc-conclusion."><span
class="toc-section-number">1.2</span> Conclusion.</a></li>
</ul></li>
<li><a href="#definition-of-data-population-and-variables."
id="toc-definition-of-data-population-and-variables."><span
class="toc-section-number">2</span> Definition of data, population and
variables.</a>
<ul>
<li><a
href="#how-actually-variables-are-measured---low-level-measurements."
id="toc-how-actually-variables-are-measured---low-level-measurements."><span
class="toc-section-number">2.1</span> How actually variables are
measured - low level measurements.</a></li>
</ul></li>
<li><a href="#raw-versus-processed-data."
id="toc-raw-versus-processed-data."><span
class="toc-section-number">3</span> Raw versus processed data.</a>
<ul>
<li><a
href="#example-of-a-processing-pipeline-with-different-low-levels-of-raw-data."
id="toc-example-of-a-processing-pipeline-with-different-low-levels-of-raw-data."><span
class="toc-section-number">3.1</span> Example of a processing pipeline
with different “low” levels of raw data.</a></li>
</ul></li>
<li><a href="#components-of-tidy-data."
id="toc-components-of-tidy-data."><span
class="toc-section-number">4</span> Components of Tidy Data.</a>
<ul>
<li><a href="#the-raw-data." id="toc-the-raw-data."><span
class="toc-section-number">4.1</span> The raw data.</a></li>
<li><a href="#the-tidy-data-set." id="toc-the-tidy-data-set."><span
class="toc-section-number">4.2</span> The tidy data set.</a>
<ul>
<li><a href="#an-example-from-genomics."
id="toc-an-example-from-genomics."><span
class="toc-section-number">4.2.1</span> An example from
genomics.</a></li>
</ul></li>
<li><a href="#the-code-book." id="toc-the-code-book."><span
class="toc-section-number">4.3</span> The code book.</a>
<ul>
<li><a href="#sections-of-the-code-book."
id="toc-sections-of-the-code-book."><span
class="toc-section-number">4.3.1</span> Sections of the code
book.</a></li>
<li><a href="#how-to-code-variables"
id="toc-how-to-code-variables"><span
class="toc-section-number">4.3.2</span> How to code variables</a></li>
<li><a href="#the-genomics-example."
id="toc-the-genomics-example."><span
class="toc-section-number">4.3.3</span> The genomics example.</a></li>
<li><a
href="#an-example-from-the-us-national-oceanographic-and-atmospheric-administration-noaa."
id="toc-an-example-from-the-us-national-oceanographic-and-atmospheric-administration-noaa."><span
class="toc-section-number">4.3.4</span> An example from the US National
Oceanographic and Atmospheric Administration (NOAA).</a></li>
</ul></li>
<li><a href="#the-instruction-listscript."
id="toc-the-instruction-listscript."><span
class="toc-section-number">4.4</span> The instruction
list/script.</a></li>
</ul></li>
<li><a href="#downloading-files." id="toc-downloading-files."><span
class="toc-section-number">5</span> Downloading Files.</a>
<ul>
<li><a href="#set-your-working-directory."
id="toc-set-your-working-directory."><span
class="toc-section-number">5.1</span> Set your working
directory.</a></li>
<li><a href="#create-a-directory---file.exists-and-dir.create."
id="toc-create-a-directory---file.exists-and-dir.create."><span
class="toc-section-number">5.2</span> Create a directory -
<code>file.exists()</code> and <code>dir.create()</code>.</a></li>
<li><a href="#the-download.file-function."
id="toc-the-download.file-function."><span
class="toc-section-number">5.3</span> The <code>download.file()</code>
function.</a></li>
</ul></li>
<li><a href="#reading-local-files-containing-tabular-data."
id="toc-reading-local-files-containing-tabular-data."><span
class="toc-section-number">6</span> Reading local files containing
tabular data.</a>
<ul>
<li><a
href="#reading-flat-files-with-read.table-and-read.csv-functions."
id="toc-reading-flat-files-with-read.table-and-read.csv-functions."><span
class="toc-section-number">6.1</span> Reading flat files with
<code>read.table()</code> and <code>read.csv()</code>
functions.</a></li>
<li><a href="#reading-excel-files-with-xlsx-packages-functions."
id="toc-reading-excel-files-with-xlsx-packages-functions."><span
class="toc-section-number">6.2</span> Reading Excel files with
<code>xlsx package</code>’s functions.</a>
<ul>
<li><a href="#the-read.xlsx-function."
id="toc-the-read.xlsx-function."><span
class="toc-section-number">6.2.1</span> The <code>read.xlsx()</code>
function.</a></li>
<li><a href="#expample-of-reading-specific-rows-and-columns."
id="toc-expample-of-reading-specific-rows-and-columns."><span
class="toc-section-number">6.2.2</span> Expample of reading specific
rows and columns.</a></li>
<li><a href="#theres-also-a-write.xlsx-function-in-this-package."
id="toc-theres-also-a-write.xlsx-function-in-this-package."><span
class="toc-section-number">6.2.3</span> There’s also a
<code>write.xlsx()</code> function in this package.</a></li>
<li><a
href="#and-therere-also-the-read.xlsx2-and-the-write.xlsx2-functions."
id="toc-and-therere-also-the-read.xlsx2-and-the-write.xlsx2-functions."><span
class="toc-section-number">6.2.4</span> And there’re also the
<code>read.xlsx2()</code> and the <code>write.xlsx2()</code>
functions.</a></li>
<li><a href="#for-serious-excel-work-consider-xlconnect-package."
id="toc-for-serious-excel-work-consider-xlconnect-package."><span
class="toc-section-number">6.2.5</span> For serious Excel work: consider
<code>XLConnect package</code>.</a></li>
<li><a href="#final-consideration-about-excel-files-in-statistics."
id="toc-final-consideration-about-excel-files-in-statistics."><span
class="toc-section-number">6.2.6</span> Final consideration about Excel
files in statistics.</a></li>
</ul></li>
</ul></li>
<li><a href="#reading-xml-files." id="toc-reading-xml-files."><span
class="toc-section-number">7</span> Reading XML files.</a>
<ul>
<li><a href="#tags-elements-and-attributes."
id="toc-tags-elements-and-attributes."><span
class="toc-section-number">7.1</span> Tags, elements and
attributes.</a></li>
<li><a href="#reading-xml-files-with-xml-packages-functions."
id="toc-reading-xml-files-with-xml-packages-functions."><span
class="toc-section-number">7.2</span> Reading <code>XML</code> files
with <code>XML</code> package’s functions.</a>
<ul>
<li><a href="#installing-xml-package-from-cran."
id="toc-installing-xml-package-from-cran."><span
class="toc-section-number">7.2.1</span> Installing <code>XML</code>
package from CRAN.</a></li>
<li><a
href="#the-xmltreeparse-and-the-htmltreeparse-functions---aka-the-xmlhtml-parsers."
id="toc-the-xmltreeparse-and-the-htmltreeparse-functions---aka-the-xmlhtml-parsers."><span
class="toc-section-number">7.2.2</span> The <code>xmlTreeParse()</code>
and the <code>htmlTreeParse()</code> functions - aka the XML/HTML
parsers.</a></li>
</ul></li>
<li><a
href="#looking-at-the-root-node-its-xml-name-and-the-names-of-all-nested-elements."
id="toc-looking-at-the-root-node-its-xml-name-and-the-names-of-all-nested-elements."><span
class="toc-section-number">7.3</span> Looking at the root node, it’s XML
name and the names of all nested elements.</a></li>
<li><a href="#the-value-of-an-xlm-element-xmlvalue-function."
id="toc-the-value-of-an-xlm-element-xmlvalue-function."><span
class="toc-section-number">7.4</span> The value of an XLM element:
<code>xmlValue()</code> function.</a></li>
<li><a href="#directly-access-to-parts-of-the-xml-document."
id="toc-directly-access-to-parts-of-the-xml-document."><span
class="toc-section-number">7.5</span> Directly access to parts of the
XML document.</a></li>
<li><a
href="#programmatically-access-to-parts-of-the-xml-document-xmlsapply."
id="toc-programmatically-access-to-parts-of-the-xml-document-xmlsapply."><span
class="toc-section-number">7.6</span> Programmatically access to parts
of the XML document: <code>xmlSApply()</code>.</a></li>
<li><a
href="#programmatically-extract-more-specific-values-the-xpath-language-and-the-xpathsapply-function."
id="toc-programmatically-extract-more-specific-values-the-xpath-language-and-the-xpathsapply-function."><span
class="toc-section-number">7.7</span> Programmatically extract more
specific values: the <code>XPath language</code> and the
<code>xpathSApply()</code> function.</a>
<ul>
<li><a href="#breakfast-menu-example."
id="toc-breakfast-menu-example."><span
class="toc-section-number">7.7.1</span> Breakfast menu example.</a></li>
<li><a href="#baltimore-ravens-example."
id="toc-baltimore-ravens-example."><span
class="toc-section-number">7.7.2</span> Baltimore Ravens
example.</a></li>
<li><a
href="#in-summary-strategy-to-programmatically-access-and-get-aka-scraping-specific-xmlhtml-values."
id="toc-in-summary-strategy-to-programmatically-access-and-get-aka-scraping-specific-xmlhtml-values."><span
class="toc-section-number">7.7.3</span> In summary: strategy to
programmatically access and get (aka scraping) specific XML/HTML
values.</a></li>
</ul></li>
<li><a href="#where-to-know-more-about-xml."
id="toc-where-to-know-more-about-xml."><span
class="toc-section-number">7.8</span> Where to know more about
<code>XML</code>.</a></li>
</ul></li>
<li><a href="#reading-json." id="toc-reading-json."><span
class="toc-section-number">8</span> Reading JSON.</a>
<ul>
<li><a href="#example-of-a-json-file-from-an-api."
id="toc-example-of-a-json-file-from-an-api."><span
class="toc-section-number">8.1</span> Example of a JSON file from an
API.</a></li>
<li><a
href="#reading-data-from-json-the-jsonlite-package-and-its-fromjson-function."
id="toc-reading-data-from-json-the-jsonlite-package-and-its-fromjson-function."><span
class="toc-section-number">8.2</span> Reading data from JSON: the
<code>jsonlite package</code> and it’s <code>fromJSON()</code>
function.</a></li>
<li><a href="#now-we-have-a-data-frame-to-work-with."
id="toc-now-we-have-a-data-frame-to-work-with."><span
class="toc-section-number">8.3</span> Now we have a
<code>data frame</code> to work with.</a></li>
</ul></li>
<li><a href="#writing-data-frames-to-json-tojson-jsonlite-package."
id="toc-writing-data-frames-to-json-tojson-jsonlite-package."><span
class="toc-section-number">9</span> Writing data frames to JSON:
<code>toJSON()</code> {<code>jsonlite package</code>}.</a>
<ul>
<li><a
href="#lets-write-a-function-to-be-able-to-see-the-first-lines-of-a-json-string."
id="toc-lets-write-a-function-to-be-able-to-see-the-first-lines-of-a-json-string."><span
class="toc-section-number">9.1</span> Let’s write a function to be able
to see the first lines of a JSON string.</a></li>
<li><a href="#now-convert-back-to-json."
id="toc-now-convert-back-to-json."><span
class="toc-section-number">9.2</span> Now convert back to JSON.</a></li>
<li><a href="#where-to-know-more-about-json."
id="toc-where-to-know-more-about-json."><span
class="toc-section-number">9.3</span> Where to know more about
JSON.</a></li>
</ul></li>
<li><a href="#using-data.table-package."
id="toc-using-data.table-package."><span
class="toc-section-number">10</span> Using
<code>data.table package</code>.</a>
<ul>
<li><a
href="#create-data-tables-just-like-data-frames-with-data.table-function."
id="toc-create-data-tables-just-like-data-frames-with-data.table-function."><span
class="toc-section-number">10.1</span> Create data tables just like data
frames: with <code>data.table()</code> function.</a></li>
<li><a href="#see-all-the-data-tables-in-memory-tables-function."
id="toc-see-all-the-data-tables-in-memory-tables-function."><span
class="toc-section-number">10.2</span> See all the data tables in
memory: <code>tables()</code> function.</a></li>
<li><a href="#subsetting-rows." id="toc-subsetting-rows."><span
class="toc-section-number">10.3</span> Subsetting rows.</a></li>
<li><a href="#subsetting-columns." id="toc-subsetting-columns."><span
class="toc-section-number">10.4</span> Subsetting columns.</a>
<ul>
<li><a
href="#no-default-dropping-behaviour-when-selecting-a-single-column."
id="toc-no-default-dropping-behaviour-when-selecting-a-single-column."><span
class="toc-section-number">10.4.1</span> No default dropping behaviour
when selecting a single column.</a></li>
</ul></li>
<li><a href="#addingupdatingdeleting-columns-operator-."
id="toc-addingupdatingdeleting-columns-operator-."><span
class="toc-section-number">10.5</span> Adding/updating/deleting columns:
<code>operator :=</code>.</a></li>
<li><a
href="#assignment-operator-also-works-by-reference-with-data.table-objects.-caution-when-having-multiple-references-to-the-same-object.-how-to-make-a-real-copy-of-a-data.table-the-copy-function."
id="toc-assignment-operator-also-works-by-reference-with-data.table-objects.-caution-when-having-multiple-references-to-the-same-object.-how-to-make-a-real-copy-of-a-data.table-the-copy-function."><span
class="toc-section-number">10.6</span> <code>Assignment operator</code>
also works <em>by reference</em> with <code>data.table</code> objects.
Caution when having multiple references to the same object. How to make
a real copy of a <code>data.table</code>: the <code>copy()</code>
function.</a></li>
<li><a href="#creating-new-variables-from-multiple-operations."
id="toc-creating-new-variables-from-multiple-operations."><span
class="toc-section-number">10.7</span> Creating new variables from
multiple operations.</a></li>
<li><a
href="#grouping-creating-variables-with-plyr-like-operations-the-by-parameter."
id="toc-grouping-creating-variables-with-plyr-like-operations-the-by-parameter."><span
class="toc-section-number">10.8</span> Grouping: creating variables with
<code>plyr</code> like operations, the <code>by</code>
parameter.</a></li>
<li><a href="#special-variables-.n-dot-n"
id="toc-special-variables-.n-dot-n"><span
class="toc-section-number">10.9</span> Special variables:
<code>.N</code> (dot N)</a></li>
<li><a href="#keys-setkey-function."
id="toc-keys-setkey-function."><span
class="toc-section-number">10.10</span> Keys: <code>setkey()</code>
function.</a>
<ul>
<li><a href="#ultra-fast-subsetting-and-sorting."
id="toc-ultra-fast-subsetting-and-sorting."><span
class="toc-section-number">10.10.1</span> Ultra fast subsetting and
sorting.</a></li>
<li><a href="#ultra-fast-joints-between-data-tables."
id="toc-ultra-fast-joints-between-data-tables."><span
class="toc-section-number">10.10.2</span> Ultra fast joints between data
tables.</a></li>
</ul></li>
<li><a href="#fast-reading-fread-against-read.table."
id="toc-fast-reading-fread-against-read.table."><span
class="toc-section-number">10.11</span> Fast reading
(<code>fread()</code> against <code>read.table()</code>).</a></li>
<li><a href="#summary-and-further-reading."
id="toc-summary-and-further-reading."><span
class="toc-section-number">10.12</span> Summary and further
reading.</a></li>
</ul></li>
<li><a href="#session-info." id="toc-session-info."><span
class="toc-section-number">11</span> Session Info.</a></li>
</ul>
</div>

<hr />
<div id="introduction." class="section level1" number="1">
<h1><span class="header-section-number">1</span> Introduction.</h1>
<p>This course covers the basic ideas behind <strong>getting our data
ready to actually perform a data analysis</strong> on it.</p>
<p>So we’ll be dealing with the nitty-gritty of:</p>
<ul>
<li><p>Finding the raw data in whatever form they are, whether they’re
in a database or whether they’re in a row image file or something
else.</p></li>
<li><p>Extracting that data out.</p></li>
<li><p>Then it’s also concerned with tidy data principles.</p></li>
</ul>
<p>It also covers practical implementation through a range of <strong>R
packages</strong> and we’ll be covering a big range of R packages.</p>
<div id="examples." class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Examples.</h2>
<div id="fastq-files---unstructured-data." class="section level3"
number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> FASTQ files -
unstructured data.</h3>
<p>FASTQ format is a text-based format for <strong>storing both a
biological sequence</strong> (usually nucleotide sequence) and its
<strong>corresponding quality scores</strong>.</p>
<p>In a FASTQ file we might be interested in actually extracting only a
sequence of information from one line or from each separate line of the
file.</p>
<p>To do so, we actually have to <strong>parse the raw text</strong>
file and <strong>extract out the bits</strong> that we actually care
about.</p>
<p>And so one of the steps in getting data is actually getting into
these raw files, <strong>figuring out their</strong>
<strong>structure</strong> and being able to extract the relevant
bits.</p>
</div>
<div
id="apis---json-format.-website-requests-open-data-website-from-baltimore."
class="section level3" number="1.1.2">
<h3><span class="header-section-number">1.1.2</span> APIs - JSON format.
Website requests (Open Data website from Baltimore).</h3>
<p>Another thing that might happen is that we might get data that’s
actually <strong>quite neatly structured</strong>, for example,
<strong>data from an API</strong>.</p>
<p>It’s actually data that’s formatted in <strong>JSON format</strong>.
And JSON formatted data is actually <em>quite neat</em> and
<em>organized</em> and <em>very easy to distribute</em>, but it’s
<strong>very hard to actually use to do downstream analyses</strong> in
many programming languages.</p>
<p>So you might want to <strong>reorganize that data</strong> in such a
way that it’s easy to analyze and do things with.</p>
<p>In general we can try to get some information off of a website,
through <strong>get requests</strong>. For example:</p>
<ul>
<li>Requests from <strong>Twitter API</strong> about specific tweets or
specific users.<br />
</li>
<li>Or from a website that we’ll see relatively frequently: <strong>the
Open Data website from Baltimore</strong>.
<ul>
<li>This site contains a bunch of <strong>datasets</strong> that are
<strong>very interesting and useful</strong> for us to be able to
analyze and they’re <strong>all free</strong>.<br />
</li>
<li>We can get these datasets from the API or from one of the
downloadable files and <strong>clean them up</strong>, so that we can do
downstream analysis on them.</li>
</ul></li>
</ul>
</div>
<div id="free-text-instructions." class="section level3" number="1.1.3">
<h3><span class="header-section-number">1.1.3</span> Free-text
instructions.</h3>
<p>We might also have situations where we have instructions within a
text, like <em>take one tablet by mouth</em> and <em>take one-half
tablet with grapefruit juice</em>.</p>
<p>These are actually free-text instructions that we might want to be
able to get and extract out, a little piece of that information -say how
many tablets have they been instructed to take-, in order to categorize
it by each record that we are collecting.</p>
</div>
<div id="databases---structured-environment." class="section level3"
number="1.1.4">
<h3><span class="header-section-number">1.1.4</span> Databases -
structured environment.</h3>
<p>For example, <strong>MySQL</strong> and <strong>MongoDB</strong> are
two very popular <strong>free databases</strong> where data might be
stored.</p>
<p>And we might want to be able to go into a database, collect some of
that data in its raw form and then process it in such a way that:</p>
<ul>
<li>We can do analysis maybe on some subset of the data.<br />
</li>
<li>Or create an algorithm that will allow us to apply predictive
analytics to the collected data.</li>
</ul>
</div>
</div>
<div id="conclusion." class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Conclusion.</h2>
<p>Data analysis is only one step, an important one but not the only, in
the hole data processing pipline.</p>
<blockquote>
<p><strong>raw data -&gt; processing script -&gt; tidy data
-&gt;</strong> <strong><em>data analysis</em></strong> <strong>-&gt;
data communication</strong></p>
</blockquote>
<p>The early stage where we actually go from raw data to tidy data,
turns out to be one of the more important components in any kind of
environment where the data aren’t necessarily already pre-tidy for
us.</p>
<p>We want to know how to actually get at the raw data itself, so that
we can do the cleaning ourselves, so we understand the principles of
what’s going on.</p>
<p>That’s what this course is all about.</p>
<hr />
</div>
</div>
<div id="definition-of-data-population-and-variables."
class="section level1" number="2">
<h1><span class="header-section-number">2</span> Definition of data,
population and variables.</h1>
<blockquote>
<p>“Data are <strong>values</strong> of <em>qualitative</em> or
<em>quantitative</em> <strong>variables</strong>, belonging to a
<strong>set of items</strong>”.</p>
</blockquote>
<ul>
<li><strong>Set of items</strong>, aka the <strong>population</strong>:
<ul>
<li>The set of objects we are intetested in.</li>
</ul></li>
<li><strong>Variables</strong>:
<ul>
<li><p>A characteristic of an item being measured.</p></li>
<li><p>Two kinds of variables depending on the terms in which variables
are measured:</p>
<ul>
<li><strong>Qualitative</strong>:
<ul>
<li>Country of origin, sex, treatment.<br />
</li>
</ul></li>
<li><strong>Quantitative</strong>:
<ul>
<li>Height, weight, blood pressure.</li>
</ul></li>
</ul></li>
<li><p>We’ll se later in detail <strong>how to code variables</strong>,
when referring to the <strong>code book</strong>.</p></li>
</ul></li>
</ul>
<div id="how-actually-variables-are-measured---low-level-measurements."
class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> How actually
variables are measured - low level measurements.</h2>
<p>A lot of these <strong>measurements</strong> are actually
<strong>derived from much lower level measurements</strong>.</p>
<p>For example, if we think about <strong>blood pressure</strong>, it’s
actually measured <strong>by calculating</strong> a pressure
measurement. And there’s actually a lot of low level things that go into
calculating that pressure measurement.</p>
<p>So <strong>those low level things</strong> are the <strong>kinds of
things</strong> that we’re going to be talking about in <strong>raw
versus processed data</strong>.</p>
<hr />
</div>
</div>
<div id="raw-versus-processed-data." class="section level1" number="3">
<h1><span class="header-section-number">3</span> Raw versus processed
data.</h1>
<blockquote>
<p><strong>Raw data</strong> are the <strong>original source</strong> of
the data.</p>
<p><strong>Processed data</strong> is data that is <strong>ready for
analysis</strong>.</p>
</blockquote>
<p>Raw data is often hard to use for data analyses.</p>
<p>Data analysis <em>includes</em> the processing or the cleaning of the
data.</p>
<ul>
<li><p>If we obtain a dataset that’s actually a raw image file and we
process it, and turn it into a nice data frame that then we use to
analyze an ARM, that data processing <em>actually is part of</em> the
<em>data analysis</em>, our data science pipeline.</p></li>
<li><p>In fact a huge component of a data scientist’s job is performing
those sorts of processing operations.</p></li>
<li><p>Raw data may only need to be processed once.</p></li>
<li><p>Processing can include merging, subsetting, transforming, go into
a file and extract out a part of an image, go into a file and extract
out a little bit of a text from preformed text field, etc.</p></li>
<li><p>There may be standards for processing, depending on the field we
are working in.</p>
<ul>
<li>For example, in genomics, there are a lot of standard preprocessing
techniques that need to be applied before we can analyze data.</li>
</ul></li>
<li><p>All <strong>steps</strong> should be
<strong>recorded</strong>.</p>
<ul>
<li><p>This is a <strong>critical component</strong>.</p></li>
<li><p>Regardless of how often we process raw data, we need to
<strong>keep a record</strong> of all the different things we did,
because it can have a major impact on the data stream analysis.</p></li>
<li><p>Preprocessing often <strong>ends up being the most important
component</strong> of a data analysis <strong>in terms</strong> of
<strong>effects on the downstream data</strong>. So paying attention to
all the steps that we did is critically important if we’re going to be a
data scientist who’s careful about understanding what’s really happening
in the entire data processing pipeline.</p></li>
</ul></li>
</ul>
<div
id="example-of-a-processing-pipeline-with-different-low-levels-of-raw-data."
class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Example of a
processing pipeline with different “low” levels of raw data.</h2>
<p>Let’s take the example of <strong>sequencing DNA</strong>.</p>
<ul>
<li><em>Aside</em> note: when the original Human Genome Project got
started, it took almost a <strong>decade</strong> and
<strong>over</strong> <strong>a 1 billion dollars</strong> to sequence
<strong>one human genome</strong>. That same process can
<strong>now</strong> be performed in about <strong>a week</strong> for
<strong>about 10,000 dollars</strong> using a machine like an <a
href="http://www.illumina.com">Illumina</a>.</li>
</ul>
<div class="figure">
<img src="3_data/example_processing_pipeline.png" alt="" />
<p class="caption">Sequencing DNA processing pipeline example</p>
</div>
<ul>
<li><p>So the process of sequencing with a modern machine <strong>starts
with little fragments of DNA</strong> which are <strong>bound to a
slide</strong>.</p>
<ul>
<li>We can think of our DNA as a string of 3 billion letters.<br />
</li>
<li>We take a small chunk of that, each fragment might be 500 letters
long, and bind it to a slide.</li>
</ul></li>
<li><p>Then there’s a chemical process by which <strong>multiple copies
of that same sequence are made</strong>.</p></li>
<li><p>What ends up happening is that this process is performed through
<strong>sequencing by synthesis</strong>.</p>
<ul>
<li>The complementary base or the complementary letter to each letter in
the sequence that’s attached to the slide is attached one at a
time.<br />
</li>
<li>Each different letter A, C, T, and G get a different color. For each
little cluster, we get a color at every single new nucleotide that’s
synthesized.</li>
</ul></li>
<li><p>Those colors create a <strong>series of images</strong>. And so,
for example, when we’re synthesizing the first nucleotide we might get
the image we see in the picture above. Then the image at the second one
and the image at the third one and so forth.</p></li>
<li><p>If we zoom in on one specific little dot, <em>that</em>
corresponds to the sequence of exactly one of the little clusters of
sequences that are exactly the same.</p></li>
<li><p>And so we can follow along from image to image, we can see what
the color is in each image and, for each image, we end up with the color
corresponding to each letter, whichever one is the brightest is the one
that we assign to that sequence. That’s how we get the
<strong>profiles</strong> for each fragment.</p></li>
<li><p>So for example, the very first letter for the first profile is
going to be a C, because we can see that, of the four letters, the C is
actually the highest.</p></li>
<li><p>And then in the second nucleotide, we can actually see that the
highest letter out of the four letters, or the most bright letter, is
the G. And so the next letter that we’d assign would be a G and so
forth.</p></li>
<li><p>So, the <strong>final thing that we end up with</strong> is
something like the <strong>FASTQ file</strong> we can see in the
picture, the so called <strong>reads</strong>.</p>
<ul>
<li>A FASTQ file is a <strong>text file</strong> where, for each of
those little fragments that we’ve got on the plate, we actually see a
<strong>specific set of letters, As, Cs, Ts and Gs</strong>.</li>
</ul></li>
<li><p><strong>In summary</strong>: we can think about the <strong>raw
data being in several different steps</strong>.</p>
<ul>
<li>The raw data might be the <strong>images</strong>, so we have to
process those image files in order to get the <strong>profiles</strong>
for each different fragment.<br />
</li>
<li>And then, after we have the profiles, we have to process those in
order to <strong>make predictions about which</strong>
<strong>letters</strong> should go into the <strong>sequences</strong>
that actually we end up having as <strong>reads</strong> in the FASTQ
file.<br />
</li>
<li><strong><em>Any of these stages</em></strong> could be
<strong>considered raw</strong> and in each of these stages there are a
number of <strong>computational steps</strong> that could have
<strong>major impact</strong> that must be applied.<br />
</li>
<li>So one thing to keep in mind when we’re doing data analysis is,
frequently, we <strong>might end up analyzing</strong> the so called
<strong>reads</strong>, that come off of a machine like a DNA sequencing
machine.<br />
</li>
<li>Or we <strong>might even analyze something that’s
downstream</strong>, say some counts based on adding up some of those
reads.<br />
</li>
<li>When we do that, we’re <strong>glossing over the fact that all of
these processing steps happen beforehand</strong>, steps that can have a
major impact.</li>
</ul></li>
<li><p>Therefore it’s <strong>critical to understand</strong> what those
processing steps are so we can make sure that our <strong>analysis isn’t
being driven by artifacts</strong> caused by the <strong>way that we
went from the raw data to the</strong> <strong>tidy
data</strong>.</p></li>
<li><p>So <strong>that’s what getting data is all about</strong>, is
taking <strong>raw data</strong> and turning it into <strong>processed
data</strong>.</p></li>
</ul>
<hr />
</div>
</div>
<div id="components-of-tidy-data." class="section level1" number="4">
<h1><span class="header-section-number">4</span> Components of Tidy
Data.</h1>
<p>The soruces where this topic was taken from are the video lessons
from Coursera and <a href="https://github.com/jtleek/datasharing">this
Jet Leek GitHub repository</a>.</p>
<p>We should have <strong>four things</strong> when we <strong>finish
going</strong> from <strong>row data set</strong> to a <strong>tidy data
set</strong> (which we can then use to do downstream analysis
-regression modeling or prediction end machine learning-).</p>
<ol style="list-style-type: decimal">
<li><p>The raw data.</p></li>
<li><p>A <a href="http://vita.had.co.nz/papers/tidy-data.pdf">tidy data
set</a>.</p></li>
<li><p>A code book describing each variable and its values in the tidy
data set.</p></li>
<li><p>An explicit and exact recipe we used to go from 1 -&gt; 2,3.</p>
<ul>
<li>We can do this last <strong>critical step</strong> in a variety of
different ways, but for our purposes we’ll be <strong>putting together
the scripts</strong> that can be used to perform the <strong>processing
of the data</strong>.</li>
</ul></li>
</ol>
<div id="the-raw-data." class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> The raw data.</h2>
<p>It’s important to remember that there are, as we saw, <em>different
levels</em> of row data.</p>
<p>It is critical that we include the files that we are actually
extracting information from, that is, the files containing <strong>the
rawest form of the data that we have access to</strong>.</p>
<ul>
<li>This ensures that data provenance can be maintained throughout the
workflow.</li>
</ul>
<p>Here are <strong>some examples</strong> of the raw form of data:</p>
<ul>
<li><p>The strange <a
href="http://en.wikipedia.org/wiki/Binary_file">binary file</a> our
measurement machine spits out.</p></li>
<li><p>The unformatted Excel file with 10 worksheets the company we
contracted with sent us.</p></li>
<li><p>The complicated <a
href="http://en.wikipedia.org/wiki/JSON">JSON</a> data we got from
scraping the <a href="https://twitter.com/twitterapi">Twitter
API</a>.</p></li>
<li><p>The hand-entered numbers we collected looking through a
microscope.</p></li>
</ul>
<p>We know <strong>the raw data</strong> is in the <strong>right
format</strong> if it is <strong>unadulterated</strong>, that is to say,
if we:</p>
<ol style="list-style-type: decimal">
<li>Ran <em>no software</em> on the data.<br />
</li>
<li>Did <em>not modify</em> any of the data values.<br />
</li>
<li>Did <em>not remove any data</em> from the data set.<br />
</li>
<li>Did <em>not summarize</em> the data in any way.</li>
</ol>
</div>
<div id="the-tidy-data-set." class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> The tidy data
set.</h2>
<p>The tidy data is the <em>target</em> or the <em>end goal</em> of the
whole process.</p>
<p>The general principles of tidy data are laid out by <a
href="http://had.co.nz/">Hadley Wickham</a> in <a
href="http://vita.had.co.nz/papers/tidy-data.pdf">this paper</a> and <a
href="http://vimeo.com/33727555">this video</a>.</p>
<p>While both the paper and the video describe tidy data using R, the
principles are more generally applicable. The idea is end up having data
where:</p>
<ol style="list-style-type: decimal">
<li><p>Each <strong>variable</strong> we measure should be in one
<strong>column</strong>.</p></li>
<li><p>Each different <strong>observation</strong> of that variable
should be in a different <strong>row</strong>.</p></li>
<li><p>There should be <strong>one table/spreadsheet</strong> for each
<strong>“kind”</strong> of variable.</p></li>
<li><p>If we have <strong>multiple tables</strong>, they should
<strong>include a column</strong> in the table that allows them to be
linked (this is often an <code>id</code> that is used to join or merge
data sets).</p></li>
</ol>
<p>While these are the hard and fast rules, there are a number of other
things that will make our dataset much easier to handle.</p>
<ul>
<li>Include a <strong>row at the top</strong> of each data
table/spreadsheet that contains full <strong>variable
names</strong>.<br />
</li>
<li>Make variable names <strong>human readable</strong>.
<ul>
<li>If we measured age at diagnosis for patients, we would head that
column with the name <code>AgeAtDiagnosis</code> instead of something
like <code>ADx</code> or another abbreviation that may be hard for
another person to understand.<br />
</li>
</ul></li>
<li>In general data should be saved in <strong>one file per
table/spreadsheet</strong>.
<ul>
<li>If we are sharing data in <strong>Excel</strong>, the tidy data
should be in one Excel file per table.
<ul>
<li>It’s in a habit of some people to save data in multiple Excel
spreadsheets within a <em>single Excel file</em> but, as we’ll se later,
<strong>its a much better idea</strong> to save <strong>each</strong>
<strong>spreadsheet in a different file</strong>.<br />
</li>
</ul></li>
<li>Not only Excel files should <em>not</em> have <em>multiple
worksheets</em>, but also <strong>no macros</strong> should be applied
to the data, and <strong>no</strong> columns/cells should be
<strong>highlighted</strong>.<br />
</li>
<li>Alternatively share the data in a <a
href="http://en.wikipedia.org/wiki/Comma-separated_values">CSV</a> or <a
href="http://en.wikipedia.org/wiki/Tab-separated_values">TAB-delimited</a>
text file.
<ul>
<li>Beware however that reading CSV files into Excel can sometimes lead
to non-reproducible handling of date and time variables.</li>
</ul></li>
</ul></li>
</ul>
<div id="an-example-from-genomics." class="section level3"
number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> An example from
genomics.</h3>
<p>Here is an example of how this would work from genomics.</p>
<p>Suppose that for 20 people, we have collected:</p>
<ul>
<li>Gene expression measurements with <a
href="http://en.wikipedia.org/wiki/RNA-Seq">RNA-sequencing</a>.<br />
</li>
<li>Also demographic and clinical information about the patients
including their age, treatment, and diagnosis.</li>
</ul>
<p>We would have <strong>one table/spreadsheet</strong> that contains
the <strong>clinical/demographic information</strong>.</p>
<ul>
<li>It would have <strong>four columns</strong> (patient id, age,
treatment, diagnosis).<br />
</li>
<li>And <strong>21 rows</strong> (a row with variable names and one row
for every patient).</li>
</ul>
<p>We would also have <strong>one table/spreadsheet</strong> for the
<strong>summarized genomic data</strong>. Usually this type of data is
summarized at the level of the <em>number of counts per exon</em>.
Suppose we have <strong>100,000 exons</strong>, then this table would
have:</p>
<ul>
<li><strong>100,001 columns</strong> (one for patient ids and one for
each data type).<br />
</li>
<li>And also <strong>21 rows</strong> (a row for gene names, and one row
for each patient).</li>
</ul>
</div>
</div>
<div id="the-code-book." class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> The code book.</h2>
<p>It’s also often called the <strong>metadata</strong>, because the
code book has data that sorrunds the data, explaining what the data is
trying to say.</p>
<p>For almost any data set, the measurements we calculate will need to
be described in more detail than we can or should sneak into the
spreadsheet.</p>
<p>The code book, <strong>at minimum, should contain</strong>:</p>
<ol style="list-style-type: decimal">
<li>Information about the <em>variables (including units!)</em> in the
dataset, <strong>not contained</strong> in the tidy data.<br />
</li>
<li>Information about the <em>summary choices</em> we made.<br />
</li>
<li>Information about the <em>experimental study design</em> we
used.</li>
</ol>
<p>A <strong>common format</strong> for this document is a
<strong>Word</strong> or <strong>text</strong> file.</p>
<ul>
<li>Better if it is a <strong>Markdown</strong> file. This is a common
used format in data science.</li>
</ul>
<div id="sections-of-the-code-book." class="section level3"
number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Sections of the
code book.</h3>
<p>Usually, there is a <strong>section called “Code book”</strong> that
describes each variable and its units.</p>
<p>And there should be a <strong>section called “Study design”</strong>
that has a thorough description of how we collected the data:</p>
<ul>
<li>Whether we extracted the data out from a data base, or performed an
experiment, a randomized trial, or an A-B test or somthing like
that.<br />
</li>
<li>What observations we exctracted out, selected, excluded, and so
forth.</li>
</ul>
</div>
<div id="how-to-code-variables" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> How to code
variables</h3>
<p>When we put variables into a spreadsheet there are several main
categories we will run into depending on their <a
href="http://en.wikipedia.org/wiki/Statistical_data_type">data
type</a>:</p>
<ol style="list-style-type: decimal">
<li>Continuous</li>
<li>Ordinal</li>
<li>Categorical</li>
<li>Missing</li>
<li>Censored</li>
</ol>
<p><strong>Continuous</strong> variables are anything measured on a
<em>quantitative scale</em> that could be <em>any fractional</em>
<em>number</em>.</p>
<ul>
<li>An example would be something like <em>weight measured in
kg</em>.</li>
</ul>
<p><a
href="http://en.wikipedia.org/wiki/Ordinal_data"><strong>Ordinal</strong>
data</a> are data that have a <em>fixed, small (&lt; 100)</em>
<em>number of levels</em> but are <em>ordered</em>.</p>
<ul>
<li>This could be for example <em>survey responses</em> where the
choices are: <em>poor, fair, good</em>.<br />
</li>
<li>Try to <strong>avoid</strong> coding ordinal variables as
<em>numbers</em>.
<ul>
<li>The ordinal values in the data set should be “poor”, “fair”, and
“good” not 1, 2 ,3.<br />
</li>
<li>This will avoid potential mixups about which direction effects go
and will help identify coding errors.</li>
</ul></li>
</ul>
<p><a
href="http://en.wikipedia.org/wiki/Categorical_variable"><strong>Categorical</strong>
data</a> are data where there are <em>multiple categories</em>, but they
<em>aren’t ordered</em>.</p>
<ul>
<li>One example would be <em>sex: male or female</em> (this coding is
attractive because it is self-documenting).<br />
</li>
<li>Try to <strong>avoid</strong> coding categorical variables as
<em>numbers</em>.
<ul>
<li>When we enter the value for sex in the tidy data, it should be
“male” or “female”, not 0 or 1.<br />
</li>
<li>This will avoid potential mixups about which direction effects go
and will help identify coding errors.</li>
</ul></li>
</ul>
<p><a
href="http://en.wikipedia.org/wiki/Missing_data"><strong>Missing</strong>
data</a> are data that are <em>unobserved</em> and we <em>don’t</em>
<em>know the mechanism</em>.</p>
<ul>
<li>We should code missing values as <code>NA</code>.</li>
</ul>
<p><a
href="http://en.wikipedia.org/wiki/Censoring_(statistics)"><strong>Censored</strong>
data</a> are data where we <em>know the</em> <em>missingness mechanism
on some level</em>.</p>
<ul>
<li>Common examples are a <em>measurement</em> being <em>below a
detection limit</em>, or a <em>patient</em> being <em>lost to</em>
<em>follow-up</em>.<br />
</li>
<li>They should also be coded as <code>NA</code> when we don’t have the
data.<br />
</li>
<li>But we should also add a <strong>new column</strong> to our tidy
data called <strong>“VariableNameCensored”</strong> which should have
values of <code>TRUE</code> if censored and <code>FALSE</code> if
not.<br />
</li>
<li>In the code book we should <em>explain why</em> those values are
<em>missing</em>.
<ul>
<li>It is critical to report if there is a reason we know about that
some of the data are missing.<br />
</li>
</ul></li>
<li>We should also <strong>not</strong> <a
href="http://en.wikipedia.org/wiki/Imputation_(statistics)"><strong>impute</strong></a>
/<strong>make up</strong>/<strong>throw away</strong> missing
observations.</li>
</ul>
<p><strong>General advice</strong>: <strong>always encode</strong> every
piece of information about our observations <strong>using
text</strong>.<br />
For example, if we are storing data in Excel and use a form of colored
text or cell background formatting to indicate information about an
observation (“red variable entries were observed in experiment 1.”) then
this information will not be exported (and will be lost!) when the data
is exported as raw text.<br />
Every piece of data should be encoded as actual <strong>text that can be
exported</strong>.</p>
</div>
<div id="the-genomics-example." class="section level3" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> The genomics
example.</h3>
<p>In our genomics example, the code book should contain the
<strong>unit of measurement</strong> for <strong>each</strong>
<strong>clinical/demographic variable</strong> (age in <em>years</em>,
treatment by <em>name/dose</em>, <em>level</em> of diagnosis and <em>how
heterogeneous</em>).</p>
<p>Also, <em>how we picked the exons</em> we used for summarizing the
genomic data (UCSC/Ensembl, etc.).</p>
<p>And any other information about <em>how we did</em> the <em>data
collection/study design</em>.</p>
<ul>
<li>For example, are these the first 20 patients that walked into the
clinic?<br />
</li>
<li>Are they 20 highly selected patients by some characteristic like
age?<br />
</li>
<li>Are they randomized to treatments?</li>
</ul>
</div>
<div
id="an-example-from-the-us-national-oceanographic-and-atmospheric-administration-noaa."
class="section level3" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> An example from the
US National Oceanographic and Atmospheric Administration (NOAA).</h3>
<p>Here it’s an interesting code book example from the NOAA website
regarding a Sea Surface Temperature (SST) dataset - <a
href="https://psl.noaa.gov/data/gridded/data.noaa.oisst.v2.html">website
link</a>.</p>
<p><img src="3_data/sst_codebook.png" /></p>
</div>
</div>
<div id="the-instruction-listscript." class="section level2"
number="4.4">
<h2><span class="header-section-number">4.4</span> The instruction
list/script.</h2>
<p>As we know, <a
href="http://www.sciencemag.org/content/334/6060/1226">reproducibility
is critical in computational science</a>.</p>
<p>That means, when we submit our paper, the reviewers and the rest of
the world should be able to exactly replicate the analyses from raw data
all the way to final results.</p>
<p>In other words, even if we collected all that information and we made
it available in the certain terms of the tidy data, we should be able to
go back to the raw data and re-process it and get the same tidy data
set.</p>
<ul>
<li>If that doesn’t happen, then there’s something going wrong in our
data processing pipeline, and so, we want to be able to identify that
and fix it.</li>
</ul>
<p>So the ideal thing to do is to <strong>create a computer
script</strong> (in <code>R</code>, <code>Python</code>, or something
else) that will do this for us. This script should:</p>
<ul>
<li>Take the <strong>raw data</strong> as <em>input</em>.<br />
</li>
<li><em>Produce</em> the <strong>tidy data</strong> we are sharing as
output.<br />
</li>
<li>There are <strong>no parameters</strong> to the script (the end user
shouldn’t be able to tweak the exact recipie for all the processing
we’ve been able to write down).</li>
</ul>
<p>We can try running our script a couple of times and see if the code
produces the same output.</p>
<p>In some cases it will not be possible to script every step, In that
case, we should provide a <a
href="http://en.wikipedia.org/wiki/Pseudocode">pseudocode</a> written in
a <strong>text</strong> file, that should look something like this:</p>
<ol style="list-style-type: decimal">
<li>Step 1 - take the raw file, run version 3.1.2 of summarize software
with parameters a=1, b=2, c=3.</li>
<li>Step 2 - run the software separately for each sample.</li>
<li>Step 3 - take column three of outputfile.out for each sample and
that is the corresponding row in the output data set.</li>
</ol>
<p>We should <strong>also include</strong> information about
<strong>which system (Mac/Windows/Linux)</strong> we used the software
on and whether we tried it more than once to confirm it gave the same
results.</p>
<p>Ideally, we will run this by a fellow student/labmate to confirm that
they can obtain the same output file we did.</p>
<hr />
</div>
</div>
<div id="downloading-files." class="section level1" number="5">
<h1><span class="header-section-number">5</span> Downloading Files.</h1>
<p>This is the era of Internet, so we’re probably going to be
downloading a lot of our data from the Internet.</p>
<p>Why do we want to use R to download files as opposed to pointing and
clicking?</p>
<ul>
<li>It is because then the <strong>downloading process</strong> can be
<strong>included in a processing script</strong>, and so we get a
<strong>more complete picture</strong> of <strong>how the data were
collected and generated</strong>.<br />
</li>
<li>It improves <strong>reproducibility</strong>.</li>
</ul>
<div id="set-your-working-directory." class="section level2"
number="5.1">
<h2><span class="header-section-number">5.1</span> Set your working
directory.</h2>
<p>So, first we set as always our <strong>working
directory</strong>.</p>
<ul>
<li>Just for completeness we remember here the <code>setwd()</code>
command and the two kinds of paths we can pass to it:
<ul>
<li><strong>Relative paths</strong>: <code>setwd("./workingdir")</code>,
<code>setwd("../")</code>, etc.<br />
</li>
<li><strong>Absolute paths</strong>:
<code>setwd("/Users/chris/workingdir)"</code>(on Windows we need <em>two
back slashes</em>).</li>
</ul></li>
</ul>
</div>
<div id="create-a-directory---file.exists-and-dir.create."
class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Create a directory -
<code>file.exists()</code> and <code>dir.create()</code>.</h2>
<p>Normally we’ll want to create a directory and put there the data we
want to collect.</p>
<p>Again, we recall that there are two functions that we can use for
this task.</p>
<p><code>file.exists()</code></p>
<ul>
<li>It takes as <strong>input</strong> a <strong>character
vector</strong> containing: one or more <strong>paths to a “file”
name</strong>.<br />
</li>
<li>What constitute a <em>“file”</em> is system-dependent, but
<strong>should include directories</strong>. If we specify a directory
name, then it <strong>must not include the trailing backslash</strong>
(or the trailing slash on Windows).<br />
</li>
<li>If we pass <strong>only a name</strong> without any path, it
<strong>searches</strong> for that name in the <strong>current</strong>
<strong>directory</strong>, so if that name is a directory name it will
look within the current directory if there is a sub-directory with that
name.<br />
</li>
<li>This function <strong>returns</strong> a <strong>logical
vector</strong> indicating wheather the “files” named by its argument
exist or not.<br />
</li>
<li>We can use here <code>dir.exists()</code>, which only takes a
directory path.</li>
</ul>
<p><code>dir.create()</code></p>
<ul>
<li>This is the function that <strong>actually creates</strong> the
<strong>specified directory</strong> <strong><em>if it
doesn’t</em></strong> <strong><em>exist</em></strong>.<br />
</li>
<li>If the directory <strong>already exists</strong>, it <strong>does
not create</strong> what should be a duplicate and launches a
warning.</li>
</ul>
<p>So <strong>usually we’ll proceed</strong> creating our data directory
<strong>checking first if it doesn’t exists yet</strong>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">&quot;3_data&quot;</span>)) {       <span class="co"># we are already in our working dir, no need to specify path.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">dir.create</span>(<span class="st">&quot;3_data&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
</div>
<div id="the-download.file-function." class="section level2"
number="5.3">
<h2><span class="header-section-number">5.3</span> The
<code>download.file()</code> function.</h2>
<p>This is function is the main way through wich we can get data from
the Internet, especially when we are talking about files:</p>
<ul>
<li>CSV, tab-delimited, Excel files and a hole bunch of other different
files.<br />
</li>
<li>This function is a sort of agnostic to the file type that we might
be downloading.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(download.file)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> (url, destfile, method, <span class="at">quiet =</span> <span class="cn">FALSE</span>, <span class="at">mode =</span> <span class="st">&quot;w&quot;</span>, <span class="at">cacheOK =</span> <span class="cn">TRUE</span>, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">extra =</span> <span class="fu">getOption</span>(<span class="st">&quot;download.file.extra&quot;</span>), <span class="at">headers =</span> <span class="cn">NULL</span>, ...)  </span></code></pre></div>
<ul>
<li><code>url</code> parameter is the place that we’re going to be
getting the data from.<br />
</li>
<li><code>destfile</code> is the destination file where that data is
going to go.<br />
</li>
<li><code>method</code> also needs to be specified, particularly when
dealing with <em>https</em>, as we’ll see in the following example.</li>
</ul>
<p>As <strong>an example</strong>, we’re going to be using the
<strong>Baltimore fixed camera data</strong>.</p>
<ul>
<li>Here’s the <a
href="https://data.baltimorecity.gov/Transportation/Baltimore-Fixed-Speed-Cameras/dz54-2aru">url</a>.<br />
</li>
<li>We find there speed cameras that are set up around Baltimore. And we
might want to be able to download these data and figure out where they
are.<br />
</li>
<li>So if we go over under the Export button on this website, we
actually get a bunch of different kinds of files. For example, we might
go down to CSV and if we right click we can <strong>copy the link
address</strong> the CSV with the camera positions.<br />
</li>
<li>We save that link into a variable called <code>fileUrl</code>.<br />
</li>
<li>Then we pass that file url as a download file url. We say we’d like
to put it in the <code>data</code> directory and we’d like to call it
<code>cameras.csv</code>.<br />
</li>
<li>We’re using <code>.csv</code> because that’s the extension that’s
used for <strong>comma separated files</strong>.</li>
<li>Finally, the <code>method</code> that we’re going to use is
<strong><code>curl</code></strong>.
<ul>
<li>This is necessary because this website is an <strong>https</strong>,
secure website, and so if we’re doing this from a <strong>Mac or
Unix</strong>, we <strong>need to specify the method is curl</strong> in
order for it to work. If we’re working from Windows, I don’t think that
we need to set the method to be curl, the default method will work all
right.<br />
</li>
</ul></li>
<li>So then if we <strong>list the files</strong> in the <strong>data
directory</strong>, we’ll see that we now have <strong>one file</strong>
there, the <code>cameras.csv</code> file.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>fileUrl <span class="ot">&lt;-</span> <span class="st">&quot;https://data.baltimorecity.gov/api/views/dz54-2aru/rows.csv?accessType=DOWNLOAD&quot;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(fileUrl, <span class="at">destfile =</span> <span class="st">&quot;./3_data/cameras.csv&quot;</span>, <span class="at">method =</span> <span class="st">&quot;curl&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(<span class="st">&quot;./3_data&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">&quot;acs.csv&quot;</span>                                                      </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a> [<span class="dv">2</span>] <span class="st">&quot;baltimore_restaurants_dataset.png&quot;</span>                            </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a> [<span class="dv">3</span>] <span class="st">&quot;baltimore_restos.xml&quot;</span>                                         </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a> [<span class="dv">4</span>] <span class="st">&quot;Baltimore-Ravens_SourceCode.png&quot;</span>                              </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a> [<span class="dv">5</span>] <span class="st">&quot;baltimore-ravens.html&quot;</span>                                        </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a> [<span class="dv">6</span>] <span class="st">&quot;Baltimore-Ravens.png&quot;</span>                                         </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a> [<span class="dv">7</span>] <span class="st">&quot;Baltimore-Sun_homicides.png&quot;</span>                                  </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a> [<span class="dv">8</span>] <span class="st">&quot;cameras.csv&quot;</span>                                                  </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a> [<span class="dv">9</span>] <span class="st">&quot;chicago.rds&quot;</span>                                                  </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>[<span class="dv">10</span>] <span class="st">&quot;cran.csv&quot;</span>                                                     </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>[<span class="dv">11</span>] <span class="st">&quot;disasterLoanProg.xlsx&quot;</span>                                        </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>[<span class="dv">12</span>] <span class="st">&quot;ed-stats.csv&quot;</span>                                                 </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>[<span class="dv">13</span>] <span class="st">&quot;employees-schema.png&quot;</span>                                         </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>[<span class="dv">14</span>] <span class="st">&quot;example_processing_pipeline.png&quot;</span>                              </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>[<span class="dv">15</span>] <span class="st">&quot;failed.csv&quot;</span>                                                   </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>[<span class="dv">16</span>] <span class="st">&quot;fixed.for&quot;</span>                                                    </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>[<span class="dv">17</span>] <span class="st">&quot;gasprogram.xlsx&quot;</span>                                              </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>[<span class="dv">18</span>] <span class="st">&quot;gdp-rank.csv&quot;</span>                                                 </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>[<span class="dv">19</span>] <span class="st">&quot;getdata_data_PUMSDataDict06.pdf&quot;</span>                              </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>[<span class="dv">20</span>] <span class="st">&quot;GoogleScholar_JeffLeek.png&quot;</span>                                   </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>[<span class="dv">21</span>] <span class="st">&quot;homicides.txt&quot;</span>                                                </span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>[<span class="dv">22</span>] <span class="st">&quot;housing.csv&quot;</span>                                                  </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>[<span class="dv">23</span>] <span class="st">&quot;Housing.csv&quot;</span>                                                  </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>[<span class="dv">24</span>] <span class="st">&quot;Housing2.csv&quot;</span>                                                 </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>[<span class="dv">25</span>] <span class="st">&quot;How Netflix Reverse-Engineered Hollywood - The Atlantic_files&quot;</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>[<span class="dv">26</span>] <span class="st">&quot;How Netflix Reverse-Engineered Hollywood - The Atlantic.html&quot;</span> </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>[<span class="dv">27</span>] <span class="st">&quot;jeff.jpg&quot;</span>                                                     </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>[<span class="dv">28</span>] <span class="st">&quot;jsonfile_example.png&quot;</span>                                         </span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>[<span class="dv">29</span>] <span class="st">&quot;passed.csv&quot;</span>                                                   </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>[<span class="dv">30</span>] <span class="st">&quot;restaurants.csv&quot;</span>                                              </span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>[<span class="dv">31</span>] <span class="st">&quot;reviews.csv&quot;</span>                                                  </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>[<span class="dv">32</span>] <span class="st">&quot;sat.csv&quot;</span>                                                      </span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>[<span class="dv">33</span>] <span class="st">&quot;simple.xml&quot;</span>                                                   </span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>[<span class="dv">34</span>] <span class="st">&quot;simpleXML.png&quot;</span>                                                </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>[<span class="dv">35</span>] <span class="st">&quot;solutions.csv&quot;</span>                                                </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>[<span class="dv">36</span>] <span class="st">&quot;sst_codebook.png&quot;</span>                                             </span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>[<span class="dv">37</span>] <span class="st">&quot;sst_data.png&quot;</span>                                                 </span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>[<span class="dv">38</span>] <span class="st">&quot;students.csv&quot;</span>                                                 </span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>[<span class="dv">39</span>] <span class="st">&quot;students2.csv&quot;</span>                                                </span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>[<span class="dv">40</span>] <span class="st">&quot;students3.csv&quot;</span>                                                </span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>[<span class="dv">41</span>] <span class="st">&quot;students4.csv&quot;</span>                                                </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>[<span class="dv">42</span>] <span class="st">&quot;ucsc-genome-browser.png&quot;</span>                                      </span></code></pre></div>
<ul>
<li>An important component of downloading files from the internet is
that <strong>those files might change</strong>. So for example, if they
update the cameras, there might be a new set of cameras and the data
that we’re analyzing might be different.</li>
<li>We want to <strong>keep track of the date</strong> that we
<strong>downloaded the data</strong>, and we can do that with the
<code>date()</code> function.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dateDownloaded <span class="ot">&lt;-</span> <span class="fu">date</span>()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dateDownloaded</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;Sat Feb 18 08:03:15 2023&quot;</span></span></code></pre></div>
<ul>
<li>So with those data having been downloaded, and knowing the date, we
can go back and see if we can find the right version of the file if we
have trouble later on.</li>
</ul>
<p><strong>In summary</strong></p>
<ul>
<li>If the <strong>url</strong> starts with <strong>http</strong>, we
should be okay.<br />
</li>
<li>Even if the url starts with <strong>https</strong> on Windows we
should be okay. But on Unix and Mac we need to set the
<code>method = "curl"</code>.<br />
</li>
<li>One thing to keep in mind is that, depending on the size of the file
and the internet connection, this <strong>could end up taking a
while</strong>. So sometimes what we may want to do is <strong>have the
instruction list</strong>, but when we actually run new versions of the
processing software, we <strong>don’t rerun</strong> the file download
<strong>every single time</strong> if it’s a really big file.<br />
</li>
<li>Finally, remember to <strong>record when the file was
downloaded</strong> so that we can go back and check the version of the
file later when we’re trying to figure things out.</li>
</ul>
</div>
</div>
<div id="reading-local-files-containing-tabular-data."
class="section level1" number="6">
<h1><span class="header-section-number">6</span> Reading local files
containing tabular data.</h1>
<div id="reading-flat-files-with-read.table-and-read.csv-functions."
class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Reading flat files
with <code>read.table()</code> and <code>read.csv()</code>
functions.</h2>
<blockquote>
<p>See “R Programming”, Module 1, paragraph 14.</p>
</blockquote>
<p>Just for the sake of completeness, because we have already downloaded
a <code>csv</code> file in the previous section, lets read it with
<code>read.csv()</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>camerasData <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;3_data/cameras.csv&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(camerasData)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;data.frame&#39;</span><span class="sc">:</span>   <span class="dv">80</span> obs. of  <span class="dv">9</span> variables<span class="sc">:</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a> <span class="er">$</span> address                     <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">71</span> levels <span class="st">&quot;E 33RD ST &amp; THE ALAMEDA&quot;</span>,..<span class="sc">:</span> <span class="dv">17</span> <span class="dv">25</span> <span class="dv">12</span> <span class="dv">71</span> <span class="dv">48</span> <span class="dv">52</span> <span class="dv">35</span> <span class="dv">6</span> <span class="dv">58</span> <span class="dv">8</span> ...</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> direction                   <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">4</span> levels <span class="st">&quot;E/B&quot;</span>,<span class="st">&quot;N/B&quot;</span>,<span class="st">&quot;S/B&quot;</span>,..<span class="sc">:</span> <span class="dv">1</span> <span class="dv">4</span> <span class="dv">1</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">1</span> <span class="dv">4</span> <span class="dv">1</span> <span class="dv">4</span> ...</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> street                      <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">61</span> levels <span class="st">&quot;</span><span class="sc">\n</span><span class="st">Pulaski Hwy </span><span class="sc">\n</span><span class="st">&quot;</span>,..<span class="sc">:</span> <span class="dv">17</span> <span class="dv">24</span> <span class="dv">9</span> <span class="dv">61</span> <span class="dv">50</span> <span class="dv">31</span> <span class="dv">38</span> <span class="dv">37</span> <span class="dv">5</span> <span class="dv">37</span> ...</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> crossStreet                 <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">66</span> levels <span class="st">&quot;33rd St&quot;</span>,<span class="st">&quot;4th St&quot;</span>,..<span class="sc">:</span> <span class="dv">60</span> <span class="dv">20</span> <span class="dv">65</span> <span class="dv">25</span> <span class="dv">28</span> <span class="dv">50</span> <span class="dv">38</span> <span class="dv">56</span> <span class="dv">53</span> <span class="dv">66</span> ...</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> intersection                <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">74</span> levels <span class="st">&quot;</span><span class="sc">\n</span><span class="st">Pulaski Hwy </span><span class="sc">\n</span><span class="st"> &amp; Moravia Park Drive&quot;</span>,..<span class="sc">:</span> <span class="dv">21</span> <span class="dv">29</span> <span class="dv">10</span> <span class="dv">74</span> <span class="dv">62</span> <span class="dv">37</span> <span class="dv">48</span> <span class="dv">42</span> <span class="dv">6</span> <span class="dv">43</span> ...</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> Location<span class="fl">.1</span>                  <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">76</span> levels <span class="st">&quot;(39.199913, -76.555977)&quot;</span>,..<span class="sc">:</span> <span class="dv">54</span> <span class="dv">30</span> <span class="dv">23</span> <span class="dv">76</span> <span class="dv">12</span> <span class="dv">15</span> <span class="dv">29</span> <span class="dv">70</span> <span class="dv">57</span> <span class="dv">71</span> ...</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> X2010.Census.Neighborhoods  <span class="sc">:</span> int  <span class="dv">252</span> <span class="dv">179</span> <span class="dv">213</span> <span class="dv">37</span> <span class="dv">250</span> <span class="dv">11</span> <span class="dv">141</span> <span class="dv">116</span> <span class="dv">214</span> <span class="dv">132</span> ...</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> X2010.Census.Wards.Precincts<span class="sc">:</span> int  <span class="dv">63</span> <span class="dv">108</span> <span class="dv">75</span> <span class="dv">270</span> <span class="dv">178</span> <span class="dv">168</span> <span class="dv">123</span> <span class="dv">271</span> <span class="dv">236</span> <span class="dv">257</span> ...</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> Zip.Codes                   <span class="sc">:</span> int  <span class="dv">27295</span> <span class="dv">13645</span> <span class="dv">27950</span> <span class="dv">14009</span> <span class="dv">27953</span> <span class="dv">27953</span> <span class="dv">27935</span> <span class="dv">14009</span> <span class="dv">14004</span> <span class="dv">14009</span> ...</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(camerasData)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                                    address direction          street</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>                GARRISON BLVD <span class="sc">&amp;</span> WABASH AVE       E<span class="sc">/</span>B     Garrison \n</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>                    HILLEN ST <span class="sc">&amp;</span> FORREST ST       W<span class="sc">/</span>B       Hillen \n</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>               EDMONDSON AVE <span class="sc">&amp;</span> N ATHOL AVE       E<span class="sc">/</span>B      Edmonson\n</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>                    YORK RD <span class="sc">&amp;</span> GITTINGS AVE       S<span class="sc">/</span>B      York Rd \n</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>                 RUSSELL ST <span class="sc">&amp;</span> W HAMBURG ST       S<span class="sc">/</span>B       Russell\n</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> S MARTIN LUTHER KING JR BLVD <span class="sc">&amp;</span> W PRATT ST       S<span class="sc">/</span>B MLK Jr. Blvd \n</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>     crossStreet                 intersection              Location<span class="fl">.1</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     Wabash Ave     Garrison \n <span class="sc">&amp;</span> Wabash <span class="fu">Ave</span> (<span class="fl">39.341209</span>, <span class="sc">-</span><span class="fl">76.683117</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     Forrest St       Hillen \n <span class="sc">&amp;</span> Forrest <span class="fu">St</span>  (<span class="fl">39.29686</span>, <span class="sc">-</span><span class="fl">76.605532</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> Woodbridge Ave Edmonson\n  <span class="sc">&amp;</span> Woodbridge <span class="fu">Ave</span> (<span class="fl">39.293453</span>, <span class="sc">-</span><span class="fl">76.689391</span>)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    Gitting Ave     York Rd \n <span class="sc">&amp;</span> Gitting <span class="fu">Ave</span> (<span class="fl">39.370493</span>, <span class="sc">-</span><span class="fl">76.609812</span>)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>     Hamburg St      Russell\n  <span class="sc">&amp;</span> Hamburg <span class="fu">St</span> (<span class="fl">39.279819</span>, <span class="sc">-</span><span class="fl">76.623911</span>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>       Pratt St   MLK Jr. Blvd \n <span class="sc">&amp;</span> Pratt <span class="fu">St</span> (<span class="fl">39.286027</span>, <span class="sc">-</span><span class="fl">76.627846</span>)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  X2010.Census.Neighborhoods X2010.Census.Wards.Precincts Zip.Codes</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>                        <span class="dv">252</span>                           <span class="dv">63</span>     <span class="dv">27295</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>                        <span class="dv">179</span>                          <span class="dv">108</span>     <span class="dv">13645</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>                        <span class="dv">213</span>                           <span class="dv">75</span>     <span class="dv">27950</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>                         <span class="dv">37</span>                          <span class="dv">270</span>     <span class="dv">14009</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>                        <span class="dv">250</span>                          <span class="dv">178</span>     <span class="dv">27953</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>                         <span class="dv">11</span>                          <span class="dv">168</span>     <span class="dv">27953</span></span></code></pre></div>
</div>
<div id="reading-excel-files-with-xlsx-packages-functions."
class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Reading Excel files
with <code>xlsx package</code>’s functions.</h2>
<p>Some data scientists show a certain snobbery about Excel files. But
Excel files are <strong>still</strong> <strong>probably the most widely
used format</strong> for sharing data.</p>
<ul>
<li>The main reason for this could be that lot of <em>people are used to
using spreadsheets</em>, so whether we’re working in business
applications or in science, people know how to use spreadsheets to
collect, and put data in, and share it with each other.<br />
</li>
<li>It’s true <strong>now, even more than ever</strong>, with things
like <em>Google spreadsheets</em>, which allow people to share them
collaboratively on the internet.</li>
</ul>
<p>The <strong>problem</strong> arises when we’re <strong>analyzing data
with a scripting language</strong> like R, because we need to be able to
<em>extract the data out</em> of those files so that we can do
downstream analyses and processing on them.</p>
<p>As <strong>an example</strong>, let us download form Data.gov
website, a dataset with statistics stored in an Excel file about the US
Small Buisness Administration Disaster Loan Program - <a
href="https://catalog.data.gov/dataset/sba-disaster-loan-data-fy2008">here’s
the link</a></p>
<ul>
<li>Again we just pick the URL off the website.<br />
</li>
<li>And then we download the file as a <code>.xlsx</code> or
<code>.xls</code> file because those are the extension for Excel
files.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">&quot;3_data&quot;</span>)) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">dir.create</span>(<span class="st">&quot;3_data&quot;</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>fileUrl <span class="ot">&lt;-</span> <span class="st">&quot;https://www.sba.gov/sites/default/files/articles/SBA_Disaster_Loan_Data_FY08.xlsx&quot;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(fileUrl, <span class="at">destfile =</span> <span class="st">&quot;./3_data/disasterLoanProg.xlsx&quot;</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>dateDownloaded <span class="ot">&lt;-</span> <span class="fu">date</span>()</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(<span class="st">&quot;./3_data&quot;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">&quot;acs.csv&quot;</span>                                                      </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a> [<span class="dv">2</span>] <span class="st">&quot;baltimore_restaurants_dataset.png&quot;</span>                            </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a> [<span class="dv">3</span>] <span class="st">&quot;baltimore_restos.xml&quot;</span>                                         </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a> [<span class="dv">4</span>] <span class="st">&quot;Baltimore-Ravens_SourceCode.png&quot;</span>                              </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a> [<span class="dv">5</span>] <span class="st">&quot;baltimore-ravens.html&quot;</span>                                        </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a> [<span class="dv">6</span>] <span class="st">&quot;Baltimore-Ravens.png&quot;</span>                                         </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a> [<span class="dv">7</span>] <span class="st">&quot;Baltimore-Sun_homicides.png&quot;</span>                                  </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a> [<span class="dv">8</span>] <span class="st">&quot;cameras.csv&quot;</span>                                                  </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a> [<span class="dv">9</span>] <span class="st">&quot;chicago.rds&quot;</span>                                                  </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>[<span class="dv">10</span>] <span class="st">&quot;cran.csv&quot;</span>                                                     </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>[<span class="dv">11</span>] <span class="st">&quot;disasterLoanProg.xlsx&quot;</span>                                        </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>[<span class="dv">12</span>] <span class="st">&quot;ed-stats.csv&quot;</span>                                                 </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>[<span class="dv">13</span>] <span class="st">&quot;employees-schema.png&quot;</span>                                         </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>[<span class="dv">14</span>] <span class="st">&quot;example_processing_pipeline.png&quot;</span>                              </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>[<span class="dv">15</span>] <span class="st">&quot;failed.csv&quot;</span>                                                   </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>[<span class="dv">16</span>] <span class="st">&quot;fixed.for&quot;</span>                                                    </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>[<span class="dv">17</span>] <span class="st">&quot;gasprogram.xlsx&quot;</span>                                              </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>[<span class="dv">18</span>] <span class="st">&quot;gdp-rank.csv&quot;</span>                                                 </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>[<span class="dv">19</span>] <span class="st">&quot;getdata_data_PUMSDataDict06.pdf&quot;</span>                              </span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>[<span class="dv">20</span>] <span class="st">&quot;GoogleScholar_JeffLeek.png&quot;</span>                                   </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>[<span class="dv">21</span>] <span class="st">&quot;homicides.txt&quot;</span>                                                </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>[<span class="dv">22</span>] <span class="st">&quot;housing.csv&quot;</span>                                                  </span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>[<span class="dv">23</span>] <span class="st">&quot;Housing.csv&quot;</span>                                                  </span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>[<span class="dv">24</span>] <span class="st">&quot;Housing2.csv&quot;</span>                                                 </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>[<span class="dv">25</span>] <span class="st">&quot;How Netflix Reverse-Engineered Hollywood - The Atlantic_files&quot;</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>[<span class="dv">26</span>] <span class="st">&quot;How Netflix Reverse-Engineered Hollywood - The Atlantic.html&quot;</span> </span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>[<span class="dv">27</span>] <span class="st">&quot;jeff.jpg&quot;</span>                                                     </span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>[<span class="dv">28</span>] <span class="st">&quot;jsonfile_example.png&quot;</span>                                         </span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>[<span class="dv">29</span>] <span class="st">&quot;passed.csv&quot;</span>                                                   </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>[<span class="dv">30</span>] <span class="st">&quot;restaurants.csv&quot;</span>                                              </span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>[<span class="dv">31</span>] <span class="st">&quot;reviews.csv&quot;</span>                                                  </span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>[<span class="dv">32</span>] <span class="st">&quot;sat.csv&quot;</span>                                                      </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>[<span class="dv">33</span>] <span class="st">&quot;simple.xml&quot;</span>                                                   </span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>[<span class="dv">34</span>] <span class="st">&quot;simpleXML.png&quot;</span>                                                </span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>[<span class="dv">35</span>] <span class="st">&quot;solutions.csv&quot;</span>                                                </span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>[<span class="dv">36</span>] <span class="st">&quot;sst_codebook.png&quot;</span>                                             </span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>[<span class="dv">37</span>] <span class="st">&quot;sst_data.png&quot;</span>                                                 </span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>[<span class="dv">38</span>] <span class="st">&quot;students.csv&quot;</span>                                                 </span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>[<span class="dv">39</span>] <span class="st">&quot;students2.csv&quot;</span>                                                </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>[<span class="dv">40</span>] <span class="st">&quot;students3.csv&quot;</span>                                                </span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>[<span class="dv">41</span>] <span class="st">&quot;students4.csv&quot;</span>                                                </span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>[<span class="dv">42</span>] <span class="st">&quot;ucsc-genome-browser.png&quot;</span>                                      </span></code></pre></div>
<p>The <strong>R library</strong> has a useful package for reading Excel
files locally and working with them: the <code>xlsx package</code>.</p>
<div id="the-read.xlsx-function." class="section level3" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> The
<code>read.xlsx()</code> function.</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xlsx)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(read.xlsx)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> (file, sheetIndex, <span class="at">sheetName =</span> <span class="cn">NULL</span>, <span class="at">rowIndex =</span> <span class="cn">NULL</span>, <span class="at">startRow =</span> <span class="cn">NULL</span>, </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">endRow =</span> <span class="cn">NULL</span>, <span class="at">colIndex =</span> <span class="cn">NULL</span>, <span class="at">as.data.frame =</span> <span class="cn">TRUE</span>, <span class="at">header =</span> <span class="cn">TRUE</span>, </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">colClasses =</span> <span class="cn">NA</span>, <span class="at">keepFormulas =</span> <span class="cn">FALSE</span>, <span class="at">encoding =</span> <span class="st">&quot;unknown&quot;</span>, <span class="at">password =</span> <span class="cn">NULL</span>, </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    ...)  </span></code></pre></div>
<p>So <strong>let’s read</strong> from disk our Excel file,
<strong>knowing the following circumstances</strong>:</p>
<ul>
<li>The data we want is stored on <strong>sheet number 4</strong> (the
first 3 sheets of this dataset have metadata).<br />
</li>
<li>The <strong>first four rows</strong> of the data sheet are useless,
we <strong>must skip them</strong>.<br />
</li>
<li>The dataset has thousands of observations and we are interested in
<strong>only the first 100 obs</strong>.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>disasterLoanProgData <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(<span class="st">&quot;./3_data/disasterLoanProg.xlsx&quot;</span>, <span class="at">sheetIndex =</span> <span class="dv">4</span>, <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">startRow =</span> <span class="dv">5</span>, <span class="at">endRow =</span> <span class="dv">105</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(disasterLoanProgData)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;data.frame&#39;</span><span class="sc">:</span>   <span class="dv">100</span> obs. of  <span class="dv">14</span> variables<span class="sc">:</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a> <span class="er">$</span> SBA.Physical.Declaration.Number    <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">4</span> levels <span class="st">&quot;11055&quot;</span>,<span class="st">&quot;11067&quot;</span>,..<span class="sc">:</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> SBA.EIDL.Declaration.Number        <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">4</span> levels <span class="st">&quot;11056&quot;</span>,<span class="st">&quot;11068&quot;</span>,..<span class="sc">:</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> FEMA.Disaster.Number               <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">&quot;1730&quot;</span>,<span class="st">&quot;1731&quot;</span><span class="sc">:</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> SBA.Disaster.Number                <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">4</span> levels <span class="st">&quot;CA-00074&quot;</span>,<span class="st">&quot;FL-00028&quot;</span>,..<span class="sc">:</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> ...</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> Damaged.Property.City.Name         <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">67</span> levels <span class="st">&quot;ABILENE&quot;</span>,<span class="st">&quot;ADKINS&quot;</span>,..<span class="sc">:</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">12</span> <span class="dv">14</span> <span class="dv">23</span> <span class="dv">25</span> <span class="dv">27</span> <span class="dv">31</span> ...</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> Damaged.Property.Zip.Code          <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">92</span> levels <span class="st">&quot;33441&quot;</span>,<span class="st">&quot;77004&quot;</span>,..<span class="sc">:</span> <span class="dv">40</span> <span class="dv">41</span> <span class="dv">42</span> <span class="dv">23</span> <span class="dv">21</span> <span class="dv">5</span> <span class="dv">37</span> <span class="dv">22</span> <span class="dv">2</span> <span class="dv">6</span> ...</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> Damaged.Property.County.Parish.Name<span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">14</span> levels <span class="st">&quot;BEXAR&quot;</span>,<span class="st">&quot;BROWARD&quot;</span>,..<span class="sc">:</span> <span class="dv">7</span> <span class="dv">14</span> <span class="dv">14</span> <span class="dv">1</span> <span class="dv">8</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">1</span> <span class="dv">5</span> <span class="dv">5</span> ...</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> Damaged.Property.State.Code        <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">3</span> levels <span class="st">&quot;CA&quot;</span>,<span class="st">&quot;FL&quot;</span>,<span class="st">&quot;TX&quot;</span><span class="sc">:</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> ...</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> Total.Verified.Loss                <span class="sc">:</span> num  <span class="dv">24164</span> <span class="dv">9586</span> <span class="dv">12984</span> <span class="dv">55566</span> <span class="dv">95391</span> ...</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> Verified.Loss.Real.Estate          <span class="sc">:</span> num  <span class="dv">22604</span> <span class="dv">9586</span> <span class="dv">12984</span> <span class="dv">55566</span> <span class="dv">61158</span> ...</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> Verified.Loss.Content              <span class="sc">:</span> num  <span class="dv">1560</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">34233</span> ...</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> Total.Approved.Loan.Amount         <span class="sc">:</span> num  <span class="dv">13100</span> <span class="dv">9600</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">7100</span> <span class="dv">10000</span> <span class="dv">694000</span> <span class="dv">24600</span> <span class="dv">0</span> <span class="dv">47100</span> ...</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> Approved.Amount.Real.Estate        <span class="sc">:</span> num  <span class="dv">13100</span> <span class="dv">9600</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">7100</span> ...</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> Approved.Amount.Content            <span class="sc">:</span> num  <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span></code></pre></div>
<ul>
<li>So we need to pass the <code>sheetIndex</code>, that is, <em>which
sheet is the data stored on</em>.<br />
</li>
<li>We tell also that there’s a <code>header</code> line so that the
column names are labeled.<br />
</li>
<li>We set <code>startRow</code> and <code>endRow</code> properly to
read what we want.<br />
</li>
<li>And as we’ll see in the next section, we can also set
<code>rowIndex</code> and <code>colIndex</code> parameters to read
<em>specific rows</em> and <em>specific columns</em>.</li>
</ul>
</div>
<div id="expample-of-reading-specific-rows-and-columns."
class="section level3" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Expample of reading
specific rows and columns.</h3>
<p>For example, if we want to read just the <strong>second and third
columns</strong> and we want to read just from <strong>the fifth
row</strong> -that is the first useful row- <strong>through the tenth
row</strong>, we proceed as follows:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>disasterLoanProgData_Subset <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(<span class="st">&quot;./3_data/disasterLoanProg.xlsx&quot;</span>, <span class="at">sheetIndex =</span> <span class="dv">4</span>,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">colIndex =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">rowIndex =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>disasterLoanProgData_Subset</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  SBA.EIDL.Declaration.Number FEMA.Disaster.Number</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>                       <span class="dv">11056</span>                 <span class="dv">1730</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>                       <span class="dv">11056</span>                 <span class="dv">1730</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>                       <span class="dv">11056</span>                 <span class="dv">1730</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>                       <span class="dv">11056</span>                 <span class="dv">1730</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>                       <span class="dv">11056</span>                 <span class="dv">1730</span></span></code></pre></div>
</div>
<div id="theres-also-a-write.xlsx-function-in-this-package."
class="section level3" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> There’s also a
<code>write.xlsx()</code> function in this package.</h3>
<p>It’s useful to know that we can use the <code>write.xlsx</code>
function.</p>
<p>If we’re working with people that like Excel files, we can actually
write them back out after our analysis. Share them with people.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(write.xlsx)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> (x, file, <span class="at">sheetName =</span> <span class="st">&quot;Sheet1&quot;</span>, <span class="at">col.names =</span> <span class="cn">TRUE</span>, <span class="at">row.names =</span> <span class="cn">TRUE</span>, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">append =</span> <span class="cn">FALSE</span>, <span class="at">showNA =</span> <span class="cn">TRUE</span>, <span class="at">password =</span> <span class="cn">NULL</span>)  </span></code></pre></div>
<p>This function is very similar as the reading one. Just passing to
it:</p>
<ul>
<li>the object <code>x</code> that we want to write out and the
<code>file</code> name,</li>
</ul>
<p>it will write that file out.</p>
</div>
<div id="and-therere-also-the-read.xlsx2-and-the-write.xlsx2-functions."
class="section level3" number="6.2.4">
<h3><span class="header-section-number">6.2.4</span> And there’re also
the <code>read.xlsx2()</code> and the <code>write.xlsx2()</code>
functions.</h3>
<p><code>read.xlsx2</code> function is <strong>quite a bit
faster</strong> than <code>read.xlsx</code>.</p>
<p>However, if we’re reading <strong>subsets of rows</strong>, it might
be a <strong>little bit unstable</strong>.</p>
</div>
<div id="for-serious-excel-work-consider-xlconnect-package."
class="section level3" number="6.2.5">
<h3><span class="header-section-number">6.2.5</span> For serious Excel
work: consider <code>XLConnect package</code>.</h3>
<p>There’re <strong>other packages</strong>, like <code>XLConnect</code>
that can also can be used and they provide a <strong>more flexible
interface</strong> for reading, writing and manipulating Excel
files.</p>
<p>So, if we really need to do a lot of serious processing of Excel
files, we should consider that <code>XLConnect</code> might be a little
bit better.</p>
<p>In that case, the <strong><code>XLConnect vignette</code></strong>
(<code>browseVignettes(package = "XLConnect"</code>) is actually a
really <strong>great place to start</strong>.</p>
<ul>
<li>It has lot of information about how you can do all sorts of
different things.<br />
</li>
<li>How you can manipulate and create files directly from R.</li>
</ul>
</div>
<div id="final-consideration-about-excel-files-in-statistics."
class="section level3" number="6.2.6">
<h3><span class="header-section-number">6.2.6</span> Final consideration
about Excel files in statistics.</h3>
<p>In general, and for the purposes of most analyses it’s a little bit
<strong>faster and easier</strong> to <strong>read files</strong> if we
store them <strong>as comma separated</strong>, or <strong>tab
separated</strong> <strong><em>flat files</em></strong>.</p>
<p>They’re <strong>also</strong> a little bit <strong>easier to
distribute</strong>, as not everybody has Excel.</p>
<p>Excel is not necessarily as cross-platform as using something like a
plain text file, with just comma separated or tab separated values.</p>
<hr />
</div>
</div>
</div>
<div id="reading-xml-files." class="section level1" number="7">
<h1><span class="header-section-number">7</span> Reading XML files.</h1>
<p><code>XML</code>, as we know, is <strong>Extensible Markup
Language</strong>, it’s frequently <strong>used to score
structured</strong> <strong>data</strong> and is particularly widely
used in <strong>internet applications</strong>.</p>
<p>For example, extracting <code>XML</code> is the bases for most
<strong>web scraping</strong>:</p>
<ul>
<li>when trying to get data from an internet <strong>API</strong>;<br />
</li>
<li>when trying to download data from <strong>open data of
websites</strong>, like an open government website.</li>
</ul>
<p>There are <strong>two components</strong> to an <code>XML</code>
file.</p>
<ul>
<li>The <strong>markup</strong>: that’s the <em>labels</em> that give
the text structure.
<ul>
<li>Imagine if we just started typing, we would end up with sort of an
unstructured text file.<br />
</li>
<li>The markup is the way that we add labels so that the file ends being
structured.<br />
</li>
</ul></li>
<li>The <strong>content</strong>: it’s the <em>actual text</em> that we
type in, in between of the labels that give the structure to the
text.</li>
</ul>
<div id="tags-elements-and-attributes." class="section level2"
number="7.1">
<h2><span class="header-section-number">7.1</span> Tags, elements and
attributes.</h2>
<p>To be a little bit more concrete, we’ll talk about
<strong><code>tags</code>, <code>elements</code> and
<code>attributes</code></strong>.</p>
<p><strong><code>Tags</code></strong> correspond to the
<em>labels</em>.</p>
<ul>
<li>tags in <code>XML</code> are “invented” by the author of the
<code>XML</code> document.
<ul>
<li><code>HTML</code> works with predefined tags like
<code>&lt;p&gt;</code>, <code>&lt;h1&gt;</code>,
<code>&lt;table&gt;</code>, etc.<br />
</li>
<li>With <code>XML</code>, the author must define both the tags and the
document structure.<br />
</li>
</ul></li>
<li>There are <strong>start tags</strong>, like
<strong><code>&lt;section&gt;</code></strong>:
<ul>
<li>They start with an <em>open caret</em> on one side and then they
have <em>a phrase</em> and then a <em>closed caret</em> on the other
side.<br />
</li>
<li>So, we’ll have that at the beginning of a certain part of the text
and will start the text as a labelled section called
<code>section</code>.<br />
</li>
</ul></li>
<li>And <strong>end tags</strong>, like
<strong><code>&lt;/section&gt;</code></strong>:
<ul>
<li>They end or close a start tag.<br />
</li>
<li>They have the <em>same phrase</em> as the starting tag, but begins
with a <em>forward slash</em> inside of the two carets.<br />
</li>
</ul></li>
<li>We have also <strong>empty tags</strong>, like
<strong><code>&lt;line-break /&gt;</code></strong>.
<ul>
<li>These tags correspond to lines where we don’t necessarily need both
an open and then a close tag to deliminate a certain part of a
text.<br />
</li>
<li>We might just want to denote one specific line, say, as a line
break.<br />
</li>
<li>And so we have the same structure, but the <em>forward slash at the
right end</em>.</li>
</ul></li>
</ul>
<p><strong><code>Elements</code></strong> are <strong>specific
examples</strong> of <strong>tags</strong>.</p>
<ul>
<li>For example, one element of the <code>XML</code> markup could be the
following <strong>tag Greeting</strong>:
<ul>
<li><code>&lt;Greeting&gt; Hello, world &lt;/Greeting&gt;</code></li>
</ul></li>
</ul>
<p><strong><code>Attributes</code></strong> are
<strong>components</strong> of the <strong>tag</strong>.</p>
<ul>
<li>We can actually add <strong>components</strong> to tags.<br />
</li>
<li>For example, we might have the following <strong>image tag</strong>:
<ul>
<li><code>&lt;img src="chris.jpg" alt="student"/&gt;</code></li>
<li>We wanted there to correlate the image tag with a specific image
file, so we used an <strong>attribute</strong> referred to as
<strong>the source</strong>. That’s where the image is actually coming
from.<br />
</li>
<li>And then <strong>another attribute</strong> that is an
<strong>alternate phrase</strong> for that tag.<br />
</li>
</ul></li>
<li>Other example, a <strong>tag step</strong>:
<ul>
<li><code>&lt;step number="3"&gt; Connect A to B. &lt;/step&gt;</code><br />
</li>
<li>We might have multiple tags step, so we give them the
<strong>attribute number</strong> to identify tag step number one, two
and then this tag step number three.</li>
</ul></li>
</ul>
</div>
<div id="reading-xml-files-with-xml-packages-functions."
class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Reading
<code>XML</code> files with <code>XML</code> package’s functions.</h2>
<div id="installing-xml-package-from-cran." class="section level3"
number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Installing
<code>XML</code> package from CRAN.</h3>
<p>We’ll have to install a version of this package that is compatible
with the R version we are running.</p>
<ul>
<li><p>By the time of writing these notes the current version of
<code>XML</code> package is <code>3.99-0.5</code> and, since version
<code>3.99-0.4</code>, this package <em>needs a version of
<code>R &gt;= 4.0.0</code></em>.</p></li>
<li><p>Because I’m running <code>R v. 3.6.3</code>, I have to install
the latest <code>XML</code> package version that is compatible with that
version of R, that is, <code>XML</code> version <code>3.99-0.3</code>
which indeed is compatible with versions of
<code>R &gt;= 2.13.0</code>.</p></li>
</ul>
<p>So, I’ve installed the appropriate version of this package via the
<code>install_version()</code> function of the <code>devtools</code>
package, through the following commands.</p>
<pre><code>library(devtools)
install_version(&quot;XML&quot;, version = &quot;3.99-0.3&quot;, repos = &quot;http://cran.us.r-project.org&quot;)</code></pre>
</div>
<div
id="the-xmltreeparse-and-the-htmltreeparse-functions---aka-the-xmlhtml-parsers."
class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> The
<code>xmlTreeParse()</code> and the <code>htmlTreeParse()</code>
functions - aka the XML/HTML parsers.</h3>
<p>Let’s suppose that we want to read in (parse) the following XML
file.</p>
<div class="figure">
<img src="3_data/simpleXML.png" alt="" />
<p class="caption">source: www.w3schools.com/xml/simple.xml</p>
</div>
<p>To do so, we are going to use the reading functions of the
<code>XML package</code>:</p>
<ul>
<li><p><code>xmlTreeParse()</code> function, and</p></li>
<li><p><code>htmlTreeeParse()</code> function.</p></li>
</ul>
<p>These functions parse an XML or HTLM file or string containing
XML/HTML content, respectevly, and <strong>generates an R structure
representing the XML/HTML tree</strong>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(XML)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(xmlTreeParse)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> (file, <span class="at">ignoreBlanks =</span> <span class="cn">TRUE</span>, <span class="at">handlers =</span> <span class="cn">NULL</span>, <span class="at">replaceEntities =</span> <span class="cn">FALSE</span>, </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">asText =</span> <span class="cn">FALSE</span>, <span class="at">trim =</span> <span class="cn">TRUE</span>, <span class="at">validate =</span> <span class="cn">FALSE</span>, <span class="at">getDTD =</span> <span class="cn">TRUE</span>, <span class="at">isURL =</span> <span class="cn">FALSE</span>, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">asTree =</span> <span class="cn">FALSE</span>, <span class="at">addAttributeNamespaces =</span> <span class="cn">FALSE</span>, <span class="at">useInternalNodes =</span> <span class="cn">FALSE</span>, </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">isSchema =</span> <span class="cn">FALSE</span>, <span class="at">fullNamespaceInfo =</span> <span class="cn">FALSE</span>, <span class="at">encoding =</span> <span class="fu">character</span>(), </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">useDotNames =</span> <span class="fu">length</span>(<span class="fu">grep</span>(<span class="st">&quot;^</span><span class="sc">\\</span><span class="st">.&quot;</span>, <span class="fu">names</span>(handlers))) <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">xinclude =</span> <span class="cn">TRUE</span>, </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">addFinalizer =</span> <span class="cn">TRUE</span>, <span class="at">error =</span> <span class="fu">xmlErrorCumulator</span>(), <span class="at">isHTML =</span> <span class="cn">FALSE</span>, <span class="at">options =</span> <span class="fu">integer</span>(), </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">parentFirst =</span> <span class="cn">FALSE</span>)  </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(htmlTreeParse)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> (file, <span class="at">ignoreBlanks =</span> <span class="cn">TRUE</span>, <span class="at">handlers =</span> <span class="cn">NULL</span>, <span class="at">replaceEntities =</span> <span class="cn">FALSE</span>, </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">asText =</span> <span class="cn">FALSE</span>, <span class="at">trim =</span> <span class="cn">TRUE</span>, <span class="at">validate =</span> <span class="cn">FALSE</span>, <span class="at">getDTD =</span> <span class="cn">TRUE</span>, <span class="at">isURL =</span> <span class="cn">FALSE</span>, </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">asTree =</span> <span class="cn">FALSE</span>, <span class="at">addAttributeNamespaces =</span> <span class="cn">FALSE</span>, <span class="at">useInternalNodes =</span> <span class="cn">FALSE</span>, </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">isSchema =</span> <span class="cn">FALSE</span>, <span class="at">fullNamespaceInfo =</span> <span class="cn">FALSE</span>, <span class="at">encoding =</span> <span class="fu">character</span>(), </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">useDotNames =</span> <span class="fu">length</span>(<span class="fu">grep</span>(<span class="st">&quot;^</span><span class="sc">\\</span><span class="st">.&quot;</span>, <span class="fu">names</span>(handlers))) <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">xinclude =</span> <span class="cn">TRUE</span>, </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">addFinalizer =</span> <span class="cn">TRUE</span>, <span class="at">error =</span> htmlErrorHandler, <span class="at">isHTML =</span> <span class="cn">TRUE</span>, <span class="at">options =</span> <span class="fu">integer</span>(), </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">parentFirst =</span> <span class="cn">FALSE</span>)  </span></code></pre></div>
<p>In order to parse out our XML file example, we’ll proceed as
follows:</p>
<ul>
<li><p>We could directly pass as first argument the <code>url</code> of
that XML file and this function would access the file in the internet,
but we can do that <strong>only if the <code>url</code> is not
<code>https</code></strong>, because there’s an <strong>incompatiblity
between <code>xmlTreeParse</code> and <code>https</code></strong>.</p>
<ul>
<li><p>That is the case for our example, because the file
<code>url</code> is
<code>https://www.w3schools.com/xml/simple.xml</code></p></li>
<li><p>So a <strong>solution</strong> to this problem can be:</p>
<ul>
<li><p>First, use the function <code>download.file()</code> that we
already know about, setting <code>method = "curl"</code>.</p></li>
<li><p>Second, give to <code>xmlTreeParse()</code> the downloaded
file.</p></li>
</ul></li>
</ul></li>
<li><p>We’ll also set the <code>useInternalNodes</code> to
<code>TRUE</code>.</p>
<ul>
<li><p>This parameter indicates whether to call the converter functions
with objects of class <code>XMLInternalNode</code> rather than
<code>XMLNode</code>. This <strong>should make things faster</strong> as
we do not convert the contents of the internal nodes to R explicit
objects.</p></li>
<li><p>Also, it <strong>allows</strong> one to <strong>access the parent
and ancestor nodes</strong>. However, since the objects refer to
volatile C-level objects, one cannot store these nodes for use in
further computations within R. They “disappear” after the processing the
XML document is completed.</p></li>
<li><p>If this argument is <code>TRUE</code> (and no handlers are
provided), the <strong>return value</strong> is a <strong>reference to
the internal C-level document pointer</strong>. This can be used to do
<strong>post-processing via <code>XPath</code> expressions</strong>
using <code>getNodeSet</code>.</p></li>
<li><p><strong>In summary</strong>: when this argument is
<code>TRUE</code>, we can <strong>get all the different nodes</strong>
inside the XML document.</p></li>
<li><p>This is ignored when parsing an HTML document.</p></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fileUrl <span class="ot">&lt;-</span> <span class="st">&quot;https://www.w3schools.com/xml/simple.xml&quot;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(fileUrl, <span class="at">destfile =</span> <span class="st">&quot;./3_data/simple.xml&quot;</span>, <span class="at">method =</span> <span class="st">&quot;curl&quot;</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>dateDownloaded <span class="ot">&lt;-</span> <span class="fu">date</span>()</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">xmlTreeParse</span>(<span class="st">&quot;./3_data/simple.xml&quot;</span>, <span class="at">useInternalNodes =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(doc)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;XMLInternalDocument&quot;</span> <span class="st">&quot;XMLAbstractDocument&quot;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>doc</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>?xml version<span class="ot">=</span><span class="st">&quot;1.0&quot;</span> encoding<span class="ot">=</span><span class="st">&quot;UTF-8&quot;</span>?<span class="sc">&gt;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;</span>breakfast_menu<span class="sc">&gt;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>food<span class="sc">&gt;</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>name<span class="sc">&gt;</span>Belgian Waffles<span class="sc">&lt;</span><span class="er">/</span>name<span class="sc">&gt;</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>price<span class="sc">&gt;</span><span class="er">$</span><span class="fl">5.95</span><span class="sc">&lt;</span><span class="er">/</span>price<span class="sc">&gt;</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>description<span class="sc">&gt;</span>Two of our famous Belgian Waffles with plenty of real maple syrup<span class="sc">&lt;</span><span class="er">/</span>description<span class="sc">&gt;</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>calories<span class="sc">&gt;</span><span class="dv">650</span><span class="sc">&lt;</span><span class="er">/</span>calories<span class="sc">&gt;</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;/</span>food<span class="sc">&gt;</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>food<span class="sc">&gt;</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>name<span class="sc">&gt;</span>Strawberry Belgian Waffles<span class="sc">&lt;</span><span class="er">/</span>name<span class="sc">&gt;</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>price<span class="sc">&gt;</span><span class="er">$</span><span class="fl">7.95</span><span class="sc">&lt;</span><span class="er">/</span>price<span class="sc">&gt;</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>description<span class="sc">&gt;</span>Light Belgian waffles covered with strawberries and whipped cream<span class="sc">&lt;</span><span class="er">/</span>description<span class="sc">&gt;</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>calories<span class="sc">&gt;</span><span class="dv">900</span><span class="sc">&lt;</span><span class="er">/</span>calories<span class="sc">&gt;</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;/</span>food<span class="sc">&gt;</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>food<span class="sc">&gt;</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>name<span class="sc">&gt;</span>Berry<span class="sc">-</span>Berry Belgian Waffles<span class="sc">&lt;</span><span class="er">/</span>name<span class="sc">&gt;</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>price<span class="sc">&gt;</span><span class="er">$</span><span class="fl">8.95</span><span class="sc">&lt;</span><span class="er">/</span>price<span class="sc">&gt;</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>description<span class="sc">&gt;</span>Light Belgian waffles covered with an assortment of fresh berries and whipped cream<span class="sc">&lt;</span><span class="er">/</span>description<span class="sc">&gt;</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>calories<span class="sc">&gt;</span><span class="dv">900</span><span class="sc">&lt;</span><span class="er">/</span>calories<span class="sc">&gt;</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;/</span>food<span class="sc">&gt;</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>food<span class="sc">&gt;</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>name<span class="sc">&gt;</span>French Toast<span class="sc">&lt;</span><span class="er">/</span>name<span class="sc">&gt;</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>price<span class="sc">&gt;</span><span class="er">$</span><span class="fl">4.50</span><span class="sc">&lt;</span><span class="er">/</span>price<span class="sc">&gt;</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>description<span class="sc">&gt;</span>Thick slices made from our homemade sourdough bread<span class="sc">&lt;</span><span class="er">/</span>description<span class="sc">&gt;</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>calories<span class="sc">&gt;</span><span class="dv">600</span><span class="sc">&lt;</span><span class="er">/</span>calories<span class="sc">&gt;</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;/</span>food<span class="sc">&gt;</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>food<span class="sc">&gt;</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>name<span class="sc">&gt;</span>Homestyle Breakfast<span class="sc">&lt;</span><span class="er">/</span>name<span class="sc">&gt;</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>price<span class="sc">&gt;</span><span class="er">$</span><span class="fl">6.95</span><span class="sc">&lt;</span><span class="er">/</span>price<span class="sc">&gt;</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>description<span class="sc">&gt;</span>Two eggs, bacon or sausage, toast, and our ever<span class="sc">-</span>popular hash browns<span class="sc">&lt;</span><span class="er">/</span>description<span class="sc">&gt;</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>calories<span class="sc">&gt;</span><span class="dv">950</span><span class="sc">&lt;</span><span class="er">/</span>calories<span class="sc">&gt;</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;/</span>food<span class="sc">&gt;</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;/</span>breakfast_menu<span class="sc">&gt;</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a> </span></code></pre></div>
<p>As we said, this function <strong>generates an R structure</strong>
representing the <strong>document tree</strong> so, within R, we’ll be
able to use different functions to access different parts of that
object.</p>
<p>That’s what we’ll do now.</p>
</div>
</div>
<div
id="looking-at-the-root-node-its-xml-name-and-the-names-of-all-nested-elements."
class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Looking at the root
node, it’s XML name and the names of all nested elements.</h2>
<p>So, the first thing that we want to look at is the <strong>root
node</strong> (we can think of it as the wrapper for the entire
“breakfast menu” document).</p>
<ul>
<li>We can get this particular element of the XML document, with
<code>xmlRoot()</code>.<br />
</li>
<li>Also it’s <code>XML</code> name, with <code>xmlName()</code>.<br />
</li>
<li>And the names of all the nested elements, with <code>names()</code>
(retruns a named character vector). It actually tell us what all the
nested elements are.</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>rootNode <span class="ot">&lt;-</span> <span class="fu">xmlRoot</span>(doc)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xmlName</span>(rootNode)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;breakfast_menu&quot;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rootNode)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  food   food   food   food   food </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;food&quot;</span> <span class="st">&quot;food&quot;</span> <span class="st">&quot;food&quot;</span> <span class="st">&quot;food&quot;</span> <span class="st">&quot;food&quot;</span> </span></code></pre></div>
<ul>
<li>So, the <strong>root node</strong> wraps the whole document and the
whole document is a <strong>breakfast menu</strong>.<br />
</li>
<li>Then there are <strong>five different breakfast items</strong> on
this menu, and <strong>each one</strong> is <strong>wrapped</strong>
within a <strong>food element</strong>.</li>
</ul>
</div>
<div id="the-value-of-an-xlm-element-xmlvalue-function."
class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> The value of an XLM
element: <code>xmlValue()</code> function.</h2>
<p>If we apply this function to a <strong>composite XLM
element</strong>, we’ll get the value of that element <em>and</em> the
values of all it’s inner elements, concatenated in a <strong>single
character string</strong>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xmlValue</span>(rootNode)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;Belgian Waffles$5.95Two of our famous Belgian Waffles with plenty of real maple syrup650Strawberry Belgian Waffles$7.95Light Belgian waffles covered with strawberries and whipped cream900Berry-Berry Belgian Waffles$8.95Light Belgian waffles covered with an assortment of fresh berries and whipped cream900French Toast$4.50Thick slices made from our homemade sourdough bread600Homestyle Breakfast$6.95Two eggs, bacon or sausage, toast, and our ever-popular hash browns950&quot;</span></span></code></pre></div>
<p>This is not very useful unless we are interested in getting all the
<strong>actual text contained</strong> in the entire document all
<strong>strung together</strong> (encadenado).</p>
<p>As we’ll see, to get more precise XML values we’ll make use of this
same function but giving it as <strong>input of others functions of the
apply family</strong>:</p>
<ul>
<li>The <code>xmlSApply()</code> function.<br />
</li>
<li>The <code>xpathSApply()</code> function, and it’s <em>“xpath
language”</em>.</li>
</ul>
<p>Let’s see now how we can access single parts of the XML document, in
order to be able to perhaps get the value of a non-composite
element.</p>
</div>
<div id="directly-access-to-parts-of-the-xml-document."
class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> Directly access to
parts of the XML document.</h2>
<p>We can do this in a little bit in the <strong>same way that we access
a <code>list</code> in R</strong>.</p>
<p>For example, we have the <strong>root node element</strong> that
we’ve extracted and we can:</p>
<ul>
<li>Look at it’s <strong>first component or first element</strong>, by
using <strong>double brackets</strong>.<br />
</li>
<li>And even keep drilling down to <strong>inner and inner
parts</strong> or the XML document, by <strong>sub-setting with further
brackets</strong>, just like we do with lists.</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>rootNode[[<span class="dv">1</span>]]</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>food<span class="sc">&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>name<span class="sc">&gt;</span>Belgian Waffles<span class="sc">&lt;</span><span class="er">/</span>name<span class="sc">&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>price<span class="sc">&gt;</span><span class="er">$</span><span class="fl">5.95</span><span class="sc">&lt;</span><span class="er">/</span>price<span class="sc">&gt;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>description<span class="sc">&gt;</span>Two of our famous Belgian Waffles with plenty of real maple syrup<span class="sc">&lt;</span><span class="er">/</span>description<span class="sc">&gt;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>calories<span class="sc">&gt;</span><span class="dv">650</span><span class="sc">&lt;</span><span class="er">/</span>calories<span class="sc">&gt;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;/</span>food<span class="sc">&gt;</span> </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>rootNode[[<span class="dv">1</span>]][[<span class="dv">1</span>]]</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>name<span class="sc">&gt;</span>Belgian Waffles<span class="sc">&lt;</span><span class="er">/</span>name<span class="sc">&gt;</span> </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">xmlValue</span>(rootNode[[<span class="dv">1</span>]][[<span class="dv">1</span>]])</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;Belgian Waffles&quot;</span></span></code></pre></div>
<ul>
<li>So, what we get out from the first sub-setting is the <strong>first
food element</strong>.<br />
</li>
<li>We can see that it <strong>also contains all the information about
this element</strong>. So, we can keep drilling down into smaller parts
of the XML document, repeating the sub-setting and get the <strong>first
element -the name- of the the first food element</strong>.<br />
</li>
<li>And now that we have a non-composite element, we can get it’s
value.</li>
</ul>
</div>
<div
id="programmatically-access-to-parts-of-the-xml-document-xmlsapply."
class="section level2" number="7.6">
<h2><span class="header-section-number">7.6</span> Programmatically
access to parts of the XML document: <code>xmlSApply()</code>.</h2>
<p>We can programmatically extract different parts of the XML document
with the <code>xmlSApply()</code> command.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(xmlSApply)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> (X, FUN, ...)  </span></code></pre></div>
<p>We pass to this function a <strong>parsed XML object</strong> and
then we tell it <strong>what function</strong> we’d like to apply.</p>
<ul>
<li>Let’s apply the <code>xmlValue()</code> function to our root
element.</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xmlSApply</span>(rootNode, xmlValue)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                                                                                                                    food </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;Belgian Waffles$5.95Two of our famous Belgian Waffles with plenty of real maple syrup650&quot;</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                                                                                                                    food </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Strawberry Belgian Waffles$7.95Light Belgian waffles covered with strawberries and whipped cream900&quot;</span> </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                                                                                                                    food </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Berry-Berry Belgian Waffles$8.95Light Belgian waffles covered with an assortment of fresh berries and whipped cream900&quot;</span> </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                                                                                                                    food </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                                               <span class="st">&quot;French Toast$4.50Thick slices made from our homemade sourdough bread600&quot;</span> </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>                                                                                                                    food </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;Homestyle Breakfast$6.95Two eggs, bacon or sausage, toast, and our ever-popular hash browns950&quot;</span> </span></code></pre></div>
<ul>
<li>So this function <strong>loops through all of the elements</strong>
of the <code>rootNode</code> and returns a list of all the XML elements,
with all the XML values of each element.<br />
</li>
<li><strong>By default</strong>, then, <code>xmlSApply</code> works
<strong>recursively</strong>.
<ul>
<li>Since <code>rootNode</code> contains the entire document, it’s going
to go through and get every single value of every single tagged element
in the entire document.<br />
</li>
<li>In this manner, we get <strong>all the values (or actual text) of
each XML element</strong> strung together <strong>in each element of the
list returned</strong> by this function.</li>
</ul></li>
</ul>
</div>
<div
id="programmatically-extract-more-specific-values-the-xpath-language-and-the-xpathsapply-function."
class="section level2" number="7.7">
<h2><span class="header-section-number">7.7</span> Programmatically
extract more specific values: the <code>XPath language</code> and the
<code>xpathSApply()</code> function.</h2>
<p>In order to be little bit more specific and <strong>get a specific
component</strong> of the document, we can use the
<strong><code>XPath language</code></strong>.</p>
<ul>
<li><p>This a <strong>whole other language</strong> that we have to
learn in addition to XML to be able to access the data.</p></li>
<li><p>But if we learn <strong>just a few</strong> of the components,
then <strong>we’ll be a long way along the way</strong>.</p></li>
<li><p>There’s actually really nice set of <strong>lecture
notes</strong> that are available <a
href="http://www.stat.berkeley.edu/~statcur/Workshop2/Presentations/XML.pdf">here</a>,
that go into this in a <strong>little bit more depth</strong>.</p></li>
<li><p><strong><em><code>/node</code></em></strong> -&gt; top level
node.</p>
<ul>
<li>The <strong>first thing</strong> that we’re going to <strong>be
looking at</strong> is the <strong>top level node of each</strong>
<strong>element</strong>, that’s what we get with a forward slash
node.</li>
</ul></li>
<li><p><strong><em><code>//node</code></em></strong> -&gt; node at any
level.</p>
<ul>
<li>The <strong>node at any level</strong> is double slash node.</li>
</ul></li>
<li><p><strong><em><code>node[@atrr-name]</code></em></strong> -&gt;
node with an attribute name.<br />
</p></li>
<li><p><strong><em><code>node[@atrr-name='bob']</code></em></strong>
-&gt; node with a “bob” attribute name.</p>
<ul>
<li>We can also <strong>extract specific nodes with specific
attributes</strong>.</li>
</ul></li>
</ul>
<p>Therefore, we can now use the
<strong><code>xpathSApply()</code></strong> function to <strong>get
specific values</strong>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(xpathSApply)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> (doc, path, <span class="at">fun =</span> <span class="cn">NULL</span>, ..., <span class="at">namespaces =</span> <span class="fu">xmlNamespaceDefinitions</span>(doc, </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">simplify =</span> <span class="cn">TRUE</span>), <span class="at">resolveNamespaces =</span> <span class="cn">TRUE</span>, <span class="at">simplify =</span> <span class="cn">TRUE</span>, <span class="at">addFinalizer =</span> <span class="cn">NA</span>)  </span></code></pre></div>
<ul>
<li><p>There’s also the <code>xpathApply()</code> function that returns
always a <strong>list</strong>.</p></li>
<li><p><code>xpathSApply()</code> is the same but it tries to
<strong>simplify the result</strong>.</p></li>
</ul>
<div id="breakfast-menu-example." class="section level3" number="7.7.1">
<h3><span class="header-section-number">7.7.1</span> Breakfast menu
example.</h3>
<p>The first thing that we’ll want to be able to do is get the
<strong>items on the menu and their prices</strong>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xpathSApply</span>(rootNode, <span class="st">&quot;//name&quot;</span>, xmlValue)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;Belgian Waffles&quot;</span>             <span class="st">&quot;Strawberry Belgian Waffles&quot;</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">3</span>] <span class="st">&quot;Berry-Berry Belgian Waffles&quot;</span> <span class="st">&quot;French Toast&quot;</span>               </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">5</span>] <span class="st">&quot;Homestyle Breakfast&quot;</span>        </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">xpathSApply</span>(rootNode, <span class="st">&quot;//price&quot;</span>, xmlValue)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;$5.95&quot;</span> <span class="st">&quot;$7.95&quot;</span> <span class="st">&quot;$8.95&quot;</span> <span class="st">&quot;$4.50&quot;</span> <span class="st">&quot;$6.95&quot;</span></span></code></pre></div>
<ul>
<li>So we use <code>xpathSApply</code> but now being a little bit
<strong>more targeted</strong> about which data we’re going to be
extracting.<br />
</li>
<li>We pass to it our <strong>parsed XML object</strong>, that is,
<code>rootNode</code> (the entire document).<br />
</li>
<li>Then we use the <code>//name</code> xpath element and tell to apply
the <code>xmlValue()</code> function.<br />
</li>
<li>And so, what happens is that:
<ul>
<li>It goes through and get all of the nodes that correspond to an
element with title <code>name</code>.<br />
</li>
<li>Then it gets the xml value of those nodes.<br />
</li>
<li>So, basically, it takes out all of the elements of the XML document
that are tagged with <code>name</code> and we end up with the names of
all of the items on the menu.<br />
</li>
</ul></li>
<li>We also do the same thing with the price tag of each node of the
document, passing the <code>//price</code> xpath element.</li>
</ul>
</div>
<div id="baltimore-ravens-example." class="section level3"
number="7.7.2">
<h3><span class="header-section-number">7.7.2</span> Baltimore Ravens
example.</h3>
<p>Let’s take as an example the homepage of <strong>the Baltimore
Ravens</strong> (an American football team) on <strong>ESPN
website</strong>: <a
href="https://www.espn.com/nfl/team/_/name/bal/baltimore-ravens">here’s
the link</a> <img src="3_data/Baltimore-Ravens.png"
alt="Baltimore Ravens on ESPN, July 2020" /></p>
<p>We’re going to <strong>look at the source code</strong>. Right
clicking on the page and choosing view source, we can see a source
document that looks like this: <img
src="3_data/Baltimore-Ravens_SourceCode.png"
alt="Baltimore Ravens Source Code" /></p>
<p>We’re going to actually drill into this website source code and see
if we can extract some information.</p>
<p>First thing to notice: this is <strong>an HTML page</strong>.</p>
<ul>
<li>So we’ll use <code>htmlTreeParse()</code> to read it.<br />
</li>
<li>But here we face the same <strong>incompatibility problems</strong>
between functions of this <code>XML package</code> and
<code>https</code> pages.<br />
</li>
<li>So, instead of passing to this function the <code>url</code> of the
ESPN page (this way would’ve been more efficient because the function
would’ve directly readed an HTML string and constructed the R object
with the structure of the HTML document), we are going to <strong>first
download it into an</strong> <strong>html file</strong> and then give to
our HTML parser this file on disk as input.</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fileUrl <span class="ot">&lt;-</span> <span class="st">&quot;https://www.espn.com/nfl/team/_/name/bal/baltimore-ravens&quot;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(fileUrl, <span class="at">destfile =</span> <span class="st">&quot;./3_data/baltimore-ravens.html&quot;</span>, <span class="at">method =</span> <span class="st">&quot;curl&quot;</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>dateDownloaded <span class="ot">&lt;-</span> <span class="fu">date</span>()</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">htmlTreeParse</span>(<span class="st">&quot;./3_data/baltimore-ravens.html&quot;</span>, <span class="at">useInternalNodes =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(doc)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;HTMLInternalDocument&quot;</span> <span class="st">&quot;HTMLInternalDocument&quot;</span> <span class="st">&quot;XMLInternalDocument&quot;</span> </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">4</span>] <span class="st">&quot;XMLAbstractDocument&quot;</span> </span></code></pre></div>
<p>Now let’s use the <code>xpathSApply()</code> function to
programatically extract some components of this document.</p>
<p>In particular, we are going to <strong>extract the XML value</strong>
inside of <strong>specific elements</strong>.</p>
<ul>
<li>One element that we want is the <code>div</code> element thas has
<code>class</code> equals to <em>game-info</em>. These are the names of
the teams that are going to play against Baltimore-Ravens in the current
regular season.<br />
</li>
<li>The other element is also a <code>div</code> element but with a
<em>game-date</em> <code>class</code>. We want to know when those
matches are going to be played.</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>teams <span class="ot">&lt;-</span> <span class="fu">xpathSApply</span>(doc, <span class="st">&quot;//div[@class=&#39;game-info&#39;]&quot;</span>, xmlValue)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>teams</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">&quot;vs  Browns&quot;</span>    <span class="st">&quot;@  Texans&quot;</span>     <span class="st">&quot;vs  Chiefs&quot;</span>    <span class="st">&quot;@  Washington&quot;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a> [<span class="dv">5</span>] <span class="st">&quot;vs  Bengals&quot;</span>   <span class="st">&quot;@  Eagles&quot;</span>     <span class="st">&quot;vs  Steelers&quot;</span>  <span class="st">&quot;@  Colts&quot;</span>     </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a> [<span class="dv">9</span>] <span class="st">&quot;@  Patriots&quot;</span>   <span class="st">&quot;vs  Titans&quot;</span>    <span class="st">&quot;@  Steelers&quot;</span>   <span class="st">&quot;vs  Cowboys&quot;</span>  </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">13</span>] <span class="st">&quot;@  Browns&quot;</span>     <span class="st">&quot;vs  Jaguars&quot;</span>   <span class="st">&quot;vs  Giants&quot;</span>    <span class="st">&quot;@  Bengals&quot;</span>   </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">17</span>] <span class="st">&quot;vs  Bills&quot;</span>     <span class="st">&quot;@  Cowboys&quot;</span>    <span class="st">&quot;vs  Panthers&quot;</span>  <span class="st">&quot;@  Washington&quot;</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">xpathSApply</span>(doc,<span class="st">&quot;//div[@class=&#39;game-date&#39;]&quot;</span>, xmlValue)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>dates</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">&quot;9/13&quot;</span>  <span class="st">&quot;9/20&quot;</span>  <span class="st">&quot;9/28&quot;</span>  <span class="st">&quot;10/4&quot;</span>  <span class="st">&quot;10/11&quot;</span> <span class="st">&quot;10/18&quot;</span> <span class="st">&quot;10/25&quot;</span> <span class="st">&quot;11/8&quot;</span>  <span class="st">&quot;11/15&quot;</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>[<span class="dv">10</span>] <span class="st">&quot;11/22&quot;</span> <span class="st">&quot;11/26&quot;</span> <span class="st">&quot;12/3&quot;</span>  <span class="st">&quot;12/14&quot;</span> <span class="st">&quot;12/20&quot;</span> <span class="st">&quot;12/27&quot;</span> <span class="st">&quot;1/3&quot;</span>   <span class="st">&quot;8/14&quot;</span>  <span class="st">&quot;8/22&quot;</span> </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>[<span class="dv">19</span>] <span class="st">&quot;8/30&quot;</span>  <span class="st">&quot;9/3&quot;</span>  </span></code></pre></div>
<ul>
<li>So, <code>xpathSApply</code> goes through the entire document, and
<strong>any time it sees a tag that is a <code>div</code></strong> item,
it’s going to <strong>check and see if it’s class is</strong>
<em>game-info</em> (or <em>game-date</em>).<br />
</li>
<li>If it is so, it’ll <strong>return the XML value</strong>.</li>
</ul>
</div>
<div
id="in-summary-strategy-to-programmatically-access-and-get-aka-scraping-specific-xmlhtml-values."
class="section level3" number="7.7.3">
<h3><span class="header-section-number">7.7.3</span> In summary:
strategy to programmatically access and get (aka scraping) specific
XML/HTML values.</h3>
<p>The general idea or strategy here is then as follows:</p>
<ul>
<li><p>First we go to the website and <strong>find the tag and any
attributes that we want to extract</strong>.</p></li>
<li><p>Then we need to <strong>write them</strong> into the
<strong><code>XPath language</code></strong>.</p></li>
<li><p>Finally, we give that <code>xpath</code> to the
<code>xpathSApply()</code> function, in ordert to <strong>extract
only</strong> <strong>the data for those specific
elements</strong>.</p></li>
</ul>
<p>This is <strong>how we scrap from a website</strong> specific
information.</p>
</div>
</div>
<div id="where-to-know-more-about-xml." class="section level2"
number="7.8">
<h2><span class="header-section-number">7.8</span> Where to know more
about <code>XML</code>.</h2>
<p>This is a very <strong>brief introduction to XML and the
<code>XML R package</code></strong>.</p>
<p>We could see the <a href="http://en.wikipedia.org/wiki/XML">Wikipedia
entry on XML</a>.</p>
<p>We should check these <strong>XML tutorials for the
<code>XML package</code></strong>:</p>
<ul>
<li><p>There’s a <a
href="http://www.omegahat.net/RSXML/shortIntro.pdf">short one</a>,
that’s really good.</p></li>
<li><p>And a <a href="http://www.omegahat.net/RSXML/Tour.pdf">long
one</a>, that should only be readed after reading the short
one.</p></li>
</ul>
<p>Finally, there’s really an <a
href="http://www.stat.berkeley.edu/~statcur/Workshop2/Presentations/XML.pdf">outstanding
guide to the XML package</a>, that gives a lot of information about
<strong>how we can use XML to programatically extract information from
websites</strong>.</p>
<hr />
</div>
</div>
<div id="reading-json." class="section level1" number="8">
<h1><span class="header-section-number">8</span> Reading JSON.</h1>
<p>JSON (short for <strong>JavaScript Object Navigation</strong>) is
another <strong>file format</strong>, very commonly used on the
internet.</p>
<p>It’s <strong>lightweight for data storage</strong>.</p>
<ul>
<li>So it’s very common in <strong>application programming interfaces
(APIs)</strong> which are ways that we can programmatically get access
to data for companies like Twitter or Facebook through URLs.</li>
</ul>
<p>It’s a little bit similar to XML in the sense that it’s
<strong>structured</strong>, but it’s a very different syntax and
format.</p>
<p>The <strong>data</strong> are stored as:</p>
<ul>
<li>Numbers (double).<br />
</li>
<li>Strings (double quoted).<br />
</li>
<li>Booleans.<br />
</li>
<li>Arrays (ordered, comma separated, enclosed in <strong>square
brackets</strong>).<br />
</li>
<li>Objects (unordered, comma separated collection of <em>key:value</em>
pairs in <strong>curly brackets</strong>).</li>
</ul>
<p>To know more about JSON the <strong>best place to start</strong>
again, as usual, is actually Wikipedia.</p>
<ul>
<li><a href="http://en.wikipedia.org/wiki/JSON">This is the
link</a>.</li>
</ul>
<div id="example-of-a-json-file-from-an-api." class="section level2"
number="8.1">
<h2><span class="header-section-number">8.1</span> Example of a JSON
file from an API.</h2>
<p>Let’s see an example JSON file that actually comes from the API for
github: <a href="https://api.github.com/users/jtleek/repos">here’s the
url</a></p>
<div class="figure">
<img src="3_data/jsonfile_example.png" alt="" />
<p class="caption">JSON data from github’s API</p>
</div>
<p>This is the data about Dr. Jeff Leek’s repositories.</p>
<p>We can see here the <strong>structure of a JSON file</strong>:</p>
<ul>
<li>There’s an <strong>overall square bracket</strong> meaning that
there’s an <strong>array</strong> of, as we’ll see, <strong>JSON
objects</strong>.<br />
</li>
<li>Each <strong>JSON object</strong> is wrapped between <strong>overall
curly brackets</strong>, these brackets represents the <strong>entire
JSON object</strong>. Here, a JSON object represents a
<strong>repo</strong>.
<ul>
<li>So, <strong>each of the different repos</strong> is inside of its
<strong>own separate curly brackets</strong>.<br />
</li>
</ul></li>
<li>Then each repo has a bunch of <strong>variables associated</strong>
with it, for example:
<ul>
<li>The <strong><code>id</code>, <code>full_name</code> or
<code>owner</code> variables</strong> of each repo, followed by a
<strong>colon</strong>, followed by the <strong>value</strong> of the
variable.<br />
</li>
</ul></li>
<li>We can also have <strong>nested sort of structures within</strong>,
for example an <strong>array</strong>:
<ul>
<li>The <strong><code>owner</code> variable</strong> has an
<strong>array as it’s value</strong>. There’s the colon, and then
there’s another open curly bracket, followed by a whole bunch of
variables, like <code>login</code>, the <code>avatar_url</code>,
etc.</li>
</ul></li>
</ul>
</div>
<div
id="reading-data-from-json-the-jsonlite-package-and-its-fromjson-function."
class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Reading data from
JSON: the <code>jsonlite package</code> and it’s <code>fromJSON()</code>
function.</h2>
<p>There’s a very nice package for reading this data in this kind of
data.</p>
<p>It’s called the <code>jsonlite package</code>.</p>
<p>The function of this package that we use for reading JSON data is
<code>fromJSON()</code>.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(fromJSON)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> (txt, <span class="at">simplifyVector =</span> <span class="cn">TRUE</span>, <span class="at">simplifyDataFrame =</span> simplifyVector, </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">simplifyMatrix =</span> simplifyVector, <span class="at">flatten =</span> <span class="cn">FALSE</span>, ...)  </span></code></pre></div>
<ul>
<li><p>We have to pass to it <strong>just the <code>url</code></strong>
where the JSON data appears and the function will
<strong>return</strong> a structured <strong>data
frame</strong>.</p></li>
<li><p>No problems at all with secure http protocol
<code>https</code>!!!</p></li>
<li><p>So what this function does is to <strong>convert</strong> the
JSON data given in input (as an <code>url</code>, a file or a JSON
string), in an R object.</p></li>
</ul>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>jsonData <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="st">&quot;https://api.github.com/users/jtleek/repos&quot;</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(jsonData)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;data.frame&quot;</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(jsonData)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">30</span> <span class="dv">79</span></span></code></pre></div>
</div>
<div id="now-we-have-a-data-frame-to-work-with." class="section level2"
number="8.3">
<h2><span class="header-section-number">8.3</span> Now we have a
<code>data frame</code> to work with.</h2>
<p>In <strong>our example</strong>, we have an array of 30 <strong>JSON
objects (repos)</strong> and <strong>each repo</strong> has 79
<strong>top level variables</strong>.</p>
<p>So the data frame produced by <code>fromJSON()</code> has:</p>
<ul>
<li><p>As it’s <strong>columns</strong>: the <strong>top level
variables</strong> (those are the 79 identical variables that each repo
has).</p>
<ul>
<li><p>Each column has, of course, it’s own class: a vector (numeric,
character, logical) a data frame, etc.</p></li>
<li><p>So the <strong>nested structures</strong> that we saw in the JSON
file, for instance the <code>owner</code> information of each repo, are
converted into <strong>data frames</strong> that are now elements of the
column in the “global” data frame that represents that top level
<code>owner</code> variable of the JSON file.</p></li>
</ul></li>
<li><p>As it’s <strong>rows</strong>: the different JSON objects or
repos (we have 30 in our JSON file).</p></li>
</ul>
<p>Let’s verify all this.</p>
<ul>
<li><p>We can use <code>names()</code> to get the names of the data
frame’s variables, that are the <strong>top level</strong>
<strong>variables</strong> of the JSON file.</p></li>
<li><p>If we call <code>names()</code> on a variable or column that also
contains data frames (like <code>owner</code> variable), we’ll get the
names of <strong>all the variables of these
sub-dataframes</strong>.</p></li>
<li><p>And of course we can get the value of a variable by
<strong>subsetting</strong> as always, wheather with the
<code>[ operator</code> or <code>operator $</code>, and repeating this
substetting the times that are necessary to get the value of nested
variables (like the variable <code>login</code> of the data frames
contained in the variable <code>owner</code> of the jsonData data
frame).</p></li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(jsonData)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">&quot;id&quot;</span>                          <span class="st">&quot;node_id&quot;</span>                    </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a> [<span class="dv">3</span>] <span class="st">&quot;name&quot;</span>                        <span class="st">&quot;full_name&quot;</span>                  </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a> [<span class="dv">5</span>] <span class="st">&quot;private&quot;</span>                     <span class="st">&quot;owner&quot;</span>                      </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a> [<span class="dv">7</span>] <span class="st">&quot;html_url&quot;</span>                    <span class="st">&quot;description&quot;</span>                </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a> [<span class="dv">9</span>] <span class="st">&quot;fork&quot;</span>                        <span class="st">&quot;url&quot;</span>                        </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">11</span>] <span class="st">&quot;forks_url&quot;</span>                   <span class="st">&quot;keys_url&quot;</span>                   </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>[<span class="dv">13</span>] <span class="st">&quot;collaborators_url&quot;</span>           <span class="st">&quot;teams_url&quot;</span>                  </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">15</span>] <span class="st">&quot;hooks_url&quot;</span>                   <span class="st">&quot;issue_events_url&quot;</span>           </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>[<span class="dv">17</span>] <span class="st">&quot;events_url&quot;</span>                  <span class="st">&quot;assignees_url&quot;</span>              </span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>[<span class="dv">19</span>] <span class="st">&quot;branches_url&quot;</span>                <span class="st">&quot;tags_url&quot;</span>                   </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>[<span class="dv">21</span>] <span class="st">&quot;blobs_url&quot;</span>                   <span class="st">&quot;git_tags_url&quot;</span>               </span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>[<span class="dv">23</span>] <span class="st">&quot;git_refs_url&quot;</span>                <span class="st">&quot;trees_url&quot;</span>                  </span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>[<span class="dv">25</span>] <span class="st">&quot;statuses_url&quot;</span>                <span class="st">&quot;languages_url&quot;</span>              </span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>[<span class="dv">27</span>] <span class="st">&quot;stargazers_url&quot;</span>              <span class="st">&quot;contributors_url&quot;</span>           </span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>[<span class="dv">29</span>] <span class="st">&quot;subscribers_url&quot;</span>             <span class="st">&quot;subscription_url&quot;</span>           </span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>[<span class="dv">31</span>] <span class="st">&quot;commits_url&quot;</span>                 <span class="st">&quot;git_commits_url&quot;</span>            </span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>[<span class="dv">33</span>] <span class="st">&quot;comments_url&quot;</span>                <span class="st">&quot;issue_comment_url&quot;</span>          </span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>[<span class="dv">35</span>] <span class="st">&quot;contents_url&quot;</span>                <span class="st">&quot;compare_url&quot;</span>                </span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>[<span class="dv">37</span>] <span class="st">&quot;merges_url&quot;</span>                  <span class="st">&quot;archive_url&quot;</span>                </span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>[<span class="dv">39</span>] <span class="st">&quot;downloads_url&quot;</span>               <span class="st">&quot;issues_url&quot;</span>                 </span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>[<span class="dv">41</span>] <span class="st">&quot;pulls_url&quot;</span>                   <span class="st">&quot;milestones_url&quot;</span>             </span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>[<span class="dv">43</span>] <span class="st">&quot;notifications_url&quot;</span>           <span class="st">&quot;labels_url&quot;</span>                 </span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>[<span class="dv">45</span>] <span class="st">&quot;releases_url&quot;</span>                <span class="st">&quot;deployments_url&quot;</span>            </span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>[<span class="dv">47</span>] <span class="st">&quot;created_at&quot;</span>                  <span class="st">&quot;updated_at&quot;</span>                 </span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>[<span class="dv">49</span>] <span class="st">&quot;pushed_at&quot;</span>                   <span class="st">&quot;git_url&quot;</span>                    </span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>[<span class="dv">51</span>] <span class="st">&quot;ssh_url&quot;</span>                     <span class="st">&quot;clone_url&quot;</span>                  </span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>[<span class="dv">53</span>] <span class="st">&quot;svn_url&quot;</span>                     <span class="st">&quot;homepage&quot;</span>                   </span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>[<span class="dv">55</span>] <span class="st">&quot;size&quot;</span>                        <span class="st">&quot;stargazers_count&quot;</span>           </span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>[<span class="dv">57</span>] <span class="st">&quot;watchers_count&quot;</span>              <span class="st">&quot;language&quot;</span>                   </span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>[<span class="dv">59</span>] <span class="st">&quot;has_issues&quot;</span>                  <span class="st">&quot;has_projects&quot;</span>               </span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>[<span class="dv">61</span>] <span class="st">&quot;has_downloads&quot;</span>               <span class="st">&quot;has_wiki&quot;</span>                   </span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>[<span class="dv">63</span>] <span class="st">&quot;has_pages&quot;</span>                   <span class="st">&quot;has_discussions&quot;</span>            </span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>[<span class="dv">65</span>] <span class="st">&quot;forks_count&quot;</span>                 <span class="st">&quot;mirror_url&quot;</span>                 </span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>[<span class="dv">67</span>] <span class="st">&quot;archived&quot;</span>                    <span class="st">&quot;disabled&quot;</span>                   </span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>[<span class="dv">69</span>] <span class="st">&quot;open_issues_count&quot;</span>           <span class="st">&quot;license&quot;</span>                    </span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>[<span class="dv">71</span>] <span class="st">&quot;allow_forking&quot;</span>               <span class="st">&quot;is_template&quot;</span>                </span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>[<span class="dv">73</span>] <span class="st">&quot;web_commit_signoff_required&quot;</span> <span class="st">&quot;topics&quot;</span>                     </span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>[<span class="dv">75</span>] <span class="st">&quot;visibility&quot;</span>                  <span class="st">&quot;forks&quot;</span>                      </span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>[<span class="dv">77</span>] <span class="st">&quot;open_issues&quot;</span>                 <span class="st">&quot;watchers&quot;</span>                   </span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>[<span class="dv">79</span>] <span class="st">&quot;default_branch&quot;</span>             </span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(jsonData<span class="sc">$</span>owner)</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">&quot;login&quot;</span>               <span class="st">&quot;id&quot;</span>                  <span class="st">&quot;node_id&quot;</span>            </span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a> [<span class="dv">4</span>] <span class="st">&quot;avatar_url&quot;</span>          <span class="st">&quot;gravatar_id&quot;</span>         <span class="st">&quot;url&quot;</span>                </span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a> [<span class="dv">7</span>] <span class="st">&quot;html_url&quot;</span>            <span class="st">&quot;followers_url&quot;</span>       <span class="st">&quot;following_url&quot;</span>      </span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>[<span class="dv">10</span>] <span class="st">&quot;gists_url&quot;</span>           <span class="st">&quot;starred_url&quot;</span>         <span class="st">&quot;subscriptions_url&quot;</span>  </span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>[<span class="dv">13</span>] <span class="st">&quot;organizations_url&quot;</span>   <span class="st">&quot;repos_url&quot;</span>           <span class="st">&quot;events_url&quot;</span>         </span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>[<span class="dv">16</span>] <span class="st">&quot;received_events_url&quot;</span> <span class="st">&quot;type&quot;</span>                <span class="st">&quot;site_admin&quot;</span>         </span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>jsonData<span class="sc">$</span>owner<span class="sc">$</span>login</span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span></span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a> [<span class="dv">9</span>] <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span></span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>[<span class="dv">17</span>] <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span></span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a>[<span class="dv">25</span>] <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span> <span class="st">&quot;jtleek&quot;</span></span></code></pre></div>
<p>And, of course, the <code>str(jsonData)</code> function give us the
hole picture at once.</p>
<ul>
<li>We don’t print it here because the output is too long.</li>
</ul>
<hr />
</div>
</div>
<div id="writing-data-frames-to-json-tojson-jsonlite-package."
class="section level1" number="9">
<h1><span class="header-section-number">9</span> Writing data frames to
JSON: <code>toJSON()</code> {<code>jsonlite package</code>}.</h1>
<p>We can also take a dataset that is a <strong>data frame</strong> in R
and turn it or <strong>convert it</strong> into a <strong>JSON
dataset</strong>.</p>
<p>We might <strong>need to perform this convertion</strong> when
<strong>exporting data</strong> that’s going to be <strong>used by an
API</strong> <strong>that requires JSON formatted data</strong>.</p>
<p>So this is what the <code>toJSON()</code> function does: it converts
data frames (and also other R objects like matrices, dates, lists).</p>
<ul>
<li><p>It <strong>returns</strong> an object of class <code>json</code>:
a species of a <strong>character vector of length 1</strong>, that is, a
single string of data <strong>coded in JSON format</strong>.</p></li>
<li><p>If we set the <code>pretty</code> parameter to <code>TRUE</code>,
then the output (JSON string) is broken up into lines, because
indentation whitespace is added (it continues to be a character string
of length one though).</p></li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(toJSON)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> (x, <span class="at">dataframe =</span> <span class="fu">c</span>(<span class="st">&quot;rows&quot;</span>, <span class="st">&quot;columns&quot;</span>, <span class="st">&quot;values&quot;</span>), <span class="at">matrix =</span> <span class="fu">c</span>(<span class="st">&quot;rowmajor&quot;</span>, </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;columnmajor&quot;</span>), <span class="at">Date =</span> <span class="fu">c</span>(<span class="st">&quot;ISO8601&quot;</span>, <span class="st">&quot;epoch&quot;</span>), <span class="at">POSIXt =</span> <span class="fu">c</span>(<span class="st">&quot;string&quot;</span>, </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;ISO8601&quot;</span>, <span class="st">&quot;epoch&quot;</span>, <span class="st">&quot;mongo&quot;</span>), <span class="at">factor =</span> <span class="fu">c</span>(<span class="st">&quot;string&quot;</span>, <span class="st">&quot;integer&quot;</span>), <span class="at">complex =</span> <span class="fu">c</span>(<span class="st">&quot;string&quot;</span>, </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;list&quot;</span>), <span class="at">raw =</span> <span class="fu">c</span>(<span class="st">&quot;base64&quot;</span>, <span class="st">&quot;hex&quot;</span>, <span class="st">&quot;mongo&quot;</span>, <span class="st">&quot;int&quot;</span>, <span class="st">&quot;js&quot;</span>), <span class="at">null =</span> <span class="fu">c</span>(<span class="st">&quot;list&quot;</span>, </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;null&quot;</span>), <span class="at">na =</span> <span class="fu">c</span>(<span class="st">&quot;null&quot;</span>, <span class="st">&quot;string&quot;</span>), <span class="at">auto_unbox =</span> <span class="cn">FALSE</span>, <span class="at">digits =</span> <span class="dv">4</span>, </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">pretty =</span> <span class="cn">FALSE</span>, <span class="at">force =</span> <span class="cn">FALSE</span>, ...)  </span></code></pre></div>
<p>Let’s convert to JSON, as example, the <code>iris</code> data
frame.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>myjson <span class="ot">&lt;-</span> <span class="fu">toJSON</span>(iris, <span class="at">pretty =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(myjson)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;json&quot;</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(myjson)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1</span></span></code></pre></div>
<div
id="lets-write-a-function-to-be-able-to-see-the-first-lines-of-a-json-string."
class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Let’s write a
function to be able to see the first lines of a JSON string.</h2>
<p>We can print our <code>json</code> object just by <strong>typing its
name</strong> or using the <code>cat()</code> function, and we’ll see
the entire JSON string as a single string (or divided by lines if we’ve
setted the <code>pretty</code> parameter).</p>
<p>But this can be an issue if we <strong>just want to see the “first
part”</strong> of our variable (that could be very very long) just to
verify wheather it is a <code>json</code> object or not.</p>
<p>Because in R a <code>json</code> object is a single string (character
vector of lenght 1), <strong>we cannot do</strong> for example the
following things:</p>
<ul>
<li><p>we <em>cannot use the <code>head()</code> function</em>.</p></li>
<li><p>we <em>cannot use subsetting operators</em>.</p></li>
</ul>
<p>So, we’ll have to <strong>write our own function</strong> to be able
to <strong>print only a subset of lines from a</strong>
<strong><code>json</code> object in R</strong>.</p>
<ul>
<li><p>The function that follows is a nice one that I’ve found <a
href="https://stackoverflow.com/questions/40809241/how-to-print-the-first-ten-rows-of-a-json-file-in-r">in
this “StackOverflow” thread</a>.</p></li>
<li><p>It only works if the <code>json</code> object is created using
<code>pretty = TRUE</code>.</p></li>
<li><p>It uses <code>strsplit()</code> to split the string into a vector
of characters, with one entry per line.</p></li>
<li><p>Then it’s possible to get the desired lines by normal
indexing.</p></li>
<li><p>Finally it combines the subset of lines again into a single
string with <code>paste()</code>, separating the lines with
<code>\n</code>.</p></li>
</ul>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>print_json_lines <span class="ot">&lt;-</span> <span class="cf">function</span>(json, lines) {</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>        <span class="co"># break up into lines</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>        json_lines <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(json, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)[[<span class="dv">1</span>]]</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># get desired lines</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        json_lines <span class="ot">&lt;-</span> json_lines[lines]</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">paste</span>(json_lines, <span class="at">collapse =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># return invisibly</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">invisible</span>(json_lines)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print_json_lines</span>(myjson, <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Sepal.Length&quot;</span><span class="sc">:</span> <span class="fl">5.1</span>,</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Sepal.Width&quot;</span><span class="sc">:</span> <span class="fl">3.5</span>,</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Petal.Length&quot;</span><span class="sc">:</span> <span class="fl">1.4</span>,</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Petal.Width&quot;</span><span class="sc">:</span> <span class="fl">0.2</span>,</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Species&quot;</span><span class="sc">:</span> <span class="st">&quot;setosa&quot;</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Sepal.Length&quot;</span><span class="sc">:</span> <span class="fl">4.9</span>,</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Sepal.Width&quot;</span><span class="sc">:</span> <span class="dv">3</span>,</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Petal.Length&quot;</span><span class="sc">:</span> <span class="fl">1.4</span>,</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Petal.Width&quot;</span><span class="sc">:</span> <span class="fl">0.2</span>,</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Species&quot;</span><span class="sc">:</span> <span class="st">&quot;setosa&quot;</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>  },</span></code></pre></div>
<ul>
<li>Indeed, we have a <code>json</code> object!!</li>
</ul>
</div>
<div id="now-convert-back-to-json." class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> Now convert back to
JSON.</h2>
<p>We can actually take that JSON object we just created and send it
right back to a data frame using the <code>fromJSON</code> command.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>iris2 <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(myjson)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris2)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>          <span class="fl">5.1</span>         <span class="fl">3.5</span>          <span class="fl">1.4</span>         <span class="fl">0.2</span>  setosa</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>          <span class="fl">4.9</span>         <span class="fl">3.0</span>          <span class="fl">1.4</span>         <span class="fl">0.2</span>  setosa</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>          <span class="fl">4.7</span>         <span class="fl">3.2</span>          <span class="fl">1.3</span>         <span class="fl">0.2</span>  setosa</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>          <span class="fl">4.6</span>         <span class="fl">3.1</span>          <span class="fl">1.5</span>         <span class="fl">0.2</span>  setosa</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>          <span class="fl">5.0</span>         <span class="fl">3.6</span>          <span class="fl">1.4</span>         <span class="fl">0.2</span>  setosa</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>          <span class="fl">5.4</span>         <span class="fl">3.9</span>          <span class="fl">1.7</span>         <span class="fl">0.4</span>  setosa</span></code></pre></div>
</div>
<div id="where-to-know-more-about-json." class="section level2"
number="9.3">
<h2><span class="header-section-number">9.3</span> Where to know more
about JSON.</h2>
<p>If we want a little bit more information about JSON in general, we
can go to <a href="https://www.json.org"
class="uri">https://www.json.org</a>.</p>
<p>Then a really <strong>nice tutorial on jsonlite</strong> that was the
basis for a lot of this notes is <a
href="http://www.r-bloggers.com/new-package-jsonlite-a-smarter-json-encoderdecoder">right
here at r-bloggers</a></p>
<p>The <strong>jsonlite vignette</strong> is also quite good.</p>
<ul>
<li><p><code>vignette(package = "jsonlite")</code> lists all vignettes
from the specified package/s.</p></li>
<li><p><code>vignette("json-aaquickstart", package ="jsonlite")</code>,
displays the vignette within RStudio.</p></li>
<li><p><code>browseVignettes(package = "jsonlite")</code>, displays all
vignettes in browser.</p></li>
</ul>
<p>If we have a more complicated JSON structure that we need to get
access to, we can go check out those resources and they might give us a
little bit more information.</p>
<hr />
</div>
</div>
<div id="using-data.table-package." class="section level1" number="10">
<h1><span class="header-section-number">10</span> Using
<code>data.table package</code>.</h1>
<p>This package is a often <strong>faster more memory efficient version
of the data frames</strong> that we’re commonly using when analyzing
data in R.</p>
<p><code>data.table</code> builds on base R functionality to reduce 2
types of time:</p>
<ul>
<li><p><strong>programming time</strong> (easier to write, read, debug
and maintain), and</p></li>
<li><p><strong>compute time</strong> (fast and memory
efficient).</p></li>
</ul>
<p><code>data.table</code> <strong>inherits from
<code>data.frame</code></strong>, that is to say, it’s an
<strong>extension of <code>data.frame</code></strong>.</p>
<ul>
<li><p>So all functions that accept a <code>data.frame</code> should
also work on a <code>data.table</code>.</p></li>
<li><p>There’s also a pretty steady set of updates to
<code>data.table</code> in case it doesn’t work.</p></li>
</ul>
<p>It’s <strong>written in C</strong> so it can be <strong>much, much
faster</strong> than some of the functions that are done in
<code>data.frame</code>.</p>
<ul>
<li>It’s much, much faster at <strong>subsetting</strong>,
<strong>grouping</strong> variables, and <strong>updating</strong>
variables than data frames are.</li>
</ul>
<p>In summary, <code>data.table</code> is an R package that provides an
<strong>enhanced version</strong> of <code>data.frame</code>s.</p>
<p>But it requires you to <strong>learn a little bit of a new
syntax</strong> so there’s a little bit of a learning curve.</p>
<div
id="create-data-tables-just-like-data-frames-with-data.table-function."
class="section level2" number="10.1">
<h2><span class="header-section-number">10.1</span> Create data tables
just like data frames: with <code>data.table()</code> function.</h2>
<p>Let’s remember the usual way that we create a <strong>data
frame</strong> with the <code>data.frame()</code> function.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data.frame)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> (..., <span class="at">row.names =</span> <span class="cn">NULL</span>, <span class="at">check.rows =</span> <span class="cn">FALSE</span>, <span class="at">check.names =</span> <span class="cn">TRUE</span>, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">fix.empty.names =</span> <span class="cn">TRUE</span>, <span class="at">stringsAsFactors =</span> <span class="fu">default.stringsAsFactors</span>())  </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>DF <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">9</span>), <span class="at">y =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)), <span class="at">z =</span> <span class="fu">rnorm</span>(<span class="dv">9</span>))</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(DF)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>            x y           z</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">0.36308952</span> a  <span class="fl">0.11825235</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">-</span><span class="fl">1.16364509</span> b  <span class="fl">1.53449240</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">-</span><span class="fl">0.57743833</span> c <span class="sc">-</span><span class="fl">0.19249574</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="fl">0.03168105</span> a <span class="sc">-</span><span class="fl">0.06481183</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="fl">0.77872418</span> b <span class="sc">-</span><span class="fl">0.56940138</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  <span class="fl">0.36229225</span> c  <span class="fl">0.62345903</span></span></code></pre></div>
<p>We can also create a <strong>data table</strong> in <strong>exactly
the same way</strong>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>Attaching package<span class="sc">:</span> <span class="st">&#39;data.table&#39;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>The following object is masked _by_ <span class="st">&#39;.GlobalEnv&#39;</span><span class="sc">:</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    cube</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data.table)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span> (..., <span class="at">keep.rownames =</span> <span class="cn">FALSE</span>, <span class="at">check.names =</span> <span class="cn">FALSE</span>, <span class="at">key =</span> <span class="cn">NULL</span>, </span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)  </span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>DT <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">9</span>), <span class="at">y =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)), <span class="at">z =</span> <span class="fu">rnorm</span>(<span class="dv">9</span>))</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(DT)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>             x y         z</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span>  <span class="fl">0.38337154</span> a <span class="sc">-</span><span class="fl">0.242491</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.51793311</span> b <span class="sc">-</span><span class="fl">1.148019</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.04333570</span> c  <span class="fl">1.957712</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.17454999</span> a <span class="sc">-</span><span class="fl">1.176553</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span>  <span class="fl">0.07278283</span> b <span class="sc">-</span><span class="fl">2.636162</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.87465093</span> c  <span class="fl">2.364532</span></span></code></pre></div>
</div>
<div id="see-all-the-data-tables-in-memory-tables-function."
class="section level2" number="10.2">
<h2><span class="header-section-number">10.2</span> See all the data
tables in memory: <code>tables()</code> function.</h2>
<p>One thing that we can do is see all data tables that are in memory,
with the <code>tables()</code> command.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tables</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>Loading required package<span class="sc">:</span> RMySQL</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>Loading required package<span class="sc">:</span> DBI</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>          NAME      NROW NCOL  MB</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span><span class="sc">:</span>         DT         <span class="dv">9</span>    <span class="dv">3</span>   <span class="dv">0</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span><span class="sc">:</span>     DT_col         <span class="dv">9</span>    <span class="dv">1</span>   <span class="dv">0</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span><span class="sc">:</span>        DT2         <span class="dv">9</span>    <span class="dv">7</span>   <span class="dv">0</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span><span class="sc">:</span>        DT3         <span class="dv">9</span>    <span class="dv">4</span>   <span class="dv">0</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span><span class="sc">:</span>        DTA         <span class="dv">4</span>    <span class="dv">2</span>   <span class="dv">0</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span><span class="sc">:</span>        DTB         <span class="dv">3</span>    <span class="dv">2</span>   <span class="dv">0</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span><span class="sc">:</span> hpcDataset <span class="dv">2</span>,<span class="dv">075</span>,<span class="dv">259</span>    <span class="dv">9</span> <span class="dv">151</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span><span class="sc">:</span>        KDT       <span class="dv">300</span>    <span class="dv">2</span>   <span class="dv">0</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span><span class="sc">:</span>        SDT   <span class="dv">100</span>,<span class="dv">000</span>    <span class="dv">1</span>   <span class="dv">1</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span><span class="sc">:</span>    twoDays     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span><span class="sc">:</span>   twoDays1     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span><span class="sc">:</span>   twoDays2     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span><span class="sc">:</span>   twoDays3     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span><span class="sc">:</span> twoDays3<span class="fl">.5</span>     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span><span class="sc">:</span>   twoDays4     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span><span class="sc">:</span>   twoDays5     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span><span class="sc">:</span>   twoDays6     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>                                                                                COLS</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span><span class="sc">:</span>                                                                            x,y,z</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span><span class="sc">:</span>                                                                                z</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span><span class="sc">:</span>                                                                  x,y,z,w,m,a,...</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span><span class="sc">:</span>                                                                          x,y,z,w</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span><span class="sc">:</span>                                                                              x,y</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span><span class="sc">:</span>                                                                              x,y</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span><span class="sc">:</span>                                                                              x,y</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span><span class="sc">:</span>                                                                                x</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>    KEY</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span><span class="sc">:</span>    </span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span><span class="sc">:</span>    </span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span><span class="sc">:</span>    </span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span><span class="sc">:</span>    </span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span><span class="sc">:</span>   x</span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span><span class="sc">:</span>   x</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span><span class="sc">:</span>    </span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span><span class="sc">:</span>   x</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span><span class="sc">:</span>    </span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span><span class="sc">:</span>    </span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span><span class="sc">:</span>    </span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span><span class="sc">:</span>    </span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span><span class="sc">:</span>    </span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span><span class="sc">:</span>    </span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span><span class="sc">:</span>    </span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span><span class="sc">:</span>    </span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span><span class="sc">:</span>    </span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a>Total<span class="sc">:</span> 152MB</span></code></pre></div>
<ul>
<li><p>So this function concisely summarizes some <strong>metadata of
all data tables in memory</strong>.</p>
<ul>
<li>It tells the name, number of rows, megabytes, columns and if there’s
a <em>key</em>.</li>
</ul></li>
<li><p>It is <strong><em>not the <code>table()</code>
function</em></strong>. This last one, builds a frequency table, more
precisely, uses the cross-classifying factors to build a table of the
counts at each combination of factor levels.</p></li>
</ul>
</div>
<div id="subsetting-rows." class="section level2" number="10.3">
<h2><span class="header-section-number">10.3</span> Subsetting
rows.</h2>
<p>The first thing that we might want to be able to do is subset rows
<strong>just like subsetting the rows in</strong> <strong>a data
frame</strong>.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>DT[<span class="dv">2</span>, ]</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>            x y         z</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.5179331</span> b <span class="sc">-</span><span class="fl">1.148019</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>DT[DT<span class="sc">$</span>y<span class="sc">==</span><span class="st">&quot;a&quot;</span>, ]</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>             x y          z</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span>  <span class="fl">0.38337154</span> a <span class="sc">-</span><span class="fl">0.2424910</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.17454999</span> a <span class="sc">-</span><span class="fl">1.1765525</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span>  <span class="fl">0.03975719</span> a  <span class="fl">0.2919333</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>DT[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)]</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>            x y         z</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.5179331</span> b <span class="sc">-</span><span class="fl">1.148019</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.0433357</span> c  <span class="fl">1.957712</span></span></code></pre></div>
<ul>
<li><p>As we can see from the third example, when we <strong>subset with
only one index</strong> (theres <strong>no comma</strong> inside the
square brackets) <strong>the behaviour is different from data
frames</strong>:</p>
<ul>
<li><p>In <code>data.table</code>, subset happens <em>based on the
rows</em>.</p></li>
<li><p>In <code>data.frame</code>, subset take place <em>based on the
columns</em>.</p></li>
</ul></li>
<li><p>That’s why our third example gives us the second and third rows
of the data table (instead of it’s second and third columns).</p></li>
</ul>
</div>
<div id="subsetting-columns." class="section level2" number="10.4">
<h2><span class="header-section-number">10.4</span> Subsetting
columns.</h2>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>DT[, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>   y          z</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> a <span class="sc">-</span><span class="fl">0.2424910</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> b <span class="sc">-</span><span class="fl">1.1480188</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> c  <span class="fl">1.9577124</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> a <span class="sc">-</span><span class="fl">1.1765525</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span> b <span class="sc">-</span><span class="fl">2.6361617</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span> c  <span class="fl">2.3645319</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span><span class="sc">:</span> a  <span class="fl">0.2919333</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span><span class="sc">:</span> b  <span class="fl">0.4324290</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span><span class="sc">:</span> c <span class="sc">-</span><span class="fl">1.2005683</span></span></code></pre></div>
<p>Again, things happen as we’re used to in data frames, we <strong>get
back the columns we want</strong>.</p>
<p>This <strong>behavior wasn’t the same</strong> in versions prior to
“1.9.8” of <code>data.table</code> package.</p>
<ul>
<li><p>What happened then was that, all that came after the comma, was
taken as an <em>expression</em> to be able to summarize the data in
different ways and in a fast way.</p></li>
<li><p>As we know, an expression is some set of statements that are
between curly brackets. So, for example, in older versions of
<code>data.table</code>, instead of putting an index after the comma in
the second part of the brackets, we could actually pass for
instance:</p>
<ul>
<li><p>A list of functions (<code>DT[ , list(mean(x), sum(z))]</code>)
that we wanted to perform, where the functions were applied to variables
named by columns (this example would’ve reported the <code>mean</code>
of the x column values and the <code>sum</code> of the z column
values).</p></li>
<li><p>We could’ve also done that to perform pretty much any function,
for example, get a table of the y values
(<code>DT[, table(y)]</code>).</p></li>
<li><p>But all this is old story now.</p></li>
</ul></li>
</ul>
<div id="no-default-dropping-behaviour-when-selecting-a-single-column."
class="section level3" number="10.4.1">
<h3><span class="header-section-number">10.4.1</span> No default
dropping behaviour when selecting a single column.</h3>
<p>As we should remember, when a single column is selected from a
<code>data.frame</code> object, <code>operator [</code> <strong>by
default returns a vector</strong> (there’s a <strong>dropping
behaviour</strong> from class <code>data.frame</code> to
<code>vector</code> class).</p>
<ul>
<li>This default dropping behaviour of <code>operator [</code> in data
frames, and also when a single element of a matrix is extracted, are
<em>exceptions to it’s “normal behaviour”</em> since this operator in
general returns an object of the same class as that of the original
one.</li>
</ul>
<p>Now, when we are working with <code>data.table</code> objects,
<strong><code>operator [</code> keeps it “normal”
behaviour</strong>.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>DT_col <span class="ot">&lt;-</span> DT[, <span class="dv">3</span>]</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(DT_col)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>           z</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.242491</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">1.148019</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span>  <span class="fl">1.957712</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">1.176553</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">2.636162</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span>  <span class="fl">2.364532</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(DT_col)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;data.table&quot;</span> <span class="st">&quot;data.frame&quot;</span></span></code></pre></div>
<p>In other words, if we select a single column from a
<code>data.table</code> object, <code>operator [</code> <strong>returns
a</strong> <strong>1-column <code>data.table</code></strong>.</p>
<ul>
<li><p>This is for <em>type consistency</em> for <strong>code</strong>
(e.g. within <code>DT[...][...]</code> chains) that can sometimes
<strong>select several columns and sometime one</strong>.</p></li>
<li><p>And this behaviour has always been the case in all versions of
<code>data.table</code> package.</p></li>
</ul>
</div>
</div>
<div id="addingupdatingdeleting-columns-operator-."
class="section level2" number="10.5">
<h2><span class="header-section-number">10.5</span>
Adding/updating/deleting columns: <code>operator :=</code>.</h2>
<p>Another thing that is done <strong>very fast and very memory
efficiently</strong> with <code>data.table</code> objects, is to
<strong>add a new column, update or delete a column</strong>.</p>
<p>That’s because <code>operator :=</code> (<em>colon equals</em>)
adds/updates/deletes columns <strong>by reference</strong>.</p>
<p>So, let’s now <strong>add a column</strong>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>DT[, w<span class="sc">:</span><span class="er">=</span> z<span class="sc">^</span><span class="dv">2</span>]</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(DT)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>             x y         z          w</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span>  <span class="fl">0.38337154</span> a <span class="sc">-</span><span class="fl">0.242491</span> <span class="fl">0.05880187</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.51793311</span> b <span class="sc">-</span><span class="fl">1.148019</span> <span class="fl">1.31794717</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.04333570</span> c  <span class="fl">1.957712</span> <span class="fl">3.83263792</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.17454999</span> a <span class="sc">-</span><span class="fl">1.176553</span> <span class="fl">1.38427581</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span>  <span class="fl">0.07278283</span> b <span class="sc">-</span><span class="fl">2.636162</span> <span class="fl">6.94934840</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.87465093</span> c  <span class="fl">2.364532</span> <span class="fl">5.59101123</span></span></code></pre></div>
<ul>
<li><p>Here we add a new column to our data table that is equal to z
variable squared.</p></li>
<li><p>As we said, columns are <strong>added by reference</strong>, so a
<strong>new copy of the <code>data.table</code> object</strong>
<strong>is not created</strong>.</p>
<ul>
<li><p>This is an <strong>important difference</strong> between
<code>data.table</code> and <code>data.frame</code> objects.</p></li>
<li><p>When adding a new variable to a <code>data.frame</code>, R will
<strong>copy over the entire <code>data.frame</code></strong> and add a
new variable to it, so you get <strong>two copies</strong> of the the
<code>data.frame</code> <strong>in memory</strong>.</p></li>
<li><p>When dealing with <strong>big data sets</strong>, this is
obviously going to cause <strong>lots of memory</strong>
<strong>problems</strong>.</p></li>
<li><p>Which we won’t have with <code>data.table</code> because a
<strong>new copy isn’t being created</strong>.</p></li>
</ul></li>
</ul>
<p>We can also <strong>update a column</strong> (by reference).</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>DT[, y<span class="sc">:</span><span class="er">=</span> <span class="st">&quot;b&quot;</span>]</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(DT)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>             x y         z          w</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span>  <span class="fl">0.38337154</span> b <span class="sc">-</span><span class="fl">0.242491</span> <span class="fl">0.05880187</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.51793311</span> b <span class="sc">-</span><span class="fl">1.148019</span> <span class="fl">1.31794717</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.04333570</span> b  <span class="fl">1.957712</span> <span class="fl">3.83263792</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.17454999</span> b <span class="sc">-</span><span class="fl">1.176553</span> <span class="fl">1.38427581</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span>  <span class="fl">0.07278283</span> b <span class="sc">-</span><span class="fl">2.636162</span> <span class="fl">6.94934840</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.87465093</span> b  <span class="fl">2.364532</span> <span class="fl">5.59101123</span></span></code></pre></div>
</div>
<div
id="assignment-operator-also-works-by-reference-with-data.table-objects.-caution-when-having-multiple-references-to-the-same-object.-how-to-make-a-real-copy-of-a-data.table-the-copy-function."
class="section level2" number="10.6">
<h2><span class="header-section-number">10.6</span>
<code>Assignment operator</code> also works <em>by reference</em> with
<code>data.table</code> objects. Caution when having multiple references
to the same object. How to make a real copy of a
<code>data.table</code>: the <code>copy()</code> function.</h2>
<p>Let’s suppose that we want to set a second data table to be assigned
from the first data table. And then we make a change to the first data
table.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>DT2 <span class="ot">&lt;-</span> DT</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>DT[, y<span class="sc">:</span><span class="er">=</span> <span class="dv">2</span>]</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(DT, <span class="dv">3</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>            x y         z          w</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span>  <span class="fl">0.3833715</span> <span class="dv">2</span> <span class="sc">-</span><span class="fl">0.242491</span> <span class="fl">0.05880187</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.5179331</span> <span class="dv">2</span> <span class="sc">-</span><span class="fl">1.148019</span> <span class="fl">1.31794717</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.0433357</span> <span class="dv">2</span>  <span class="fl">1.957712</span> <span class="fl">3.83263792</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(DT2, <span class="dv">3</span>)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>            x y         z          w</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span>  <span class="fl">0.3833715</span> <span class="dv">2</span> <span class="sc">-</span><span class="fl">0.242491</span> <span class="fl">0.05880187</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.5179331</span> <span class="dv">2</span> <span class="sc">-</span><span class="fl">1.148019</span> <span class="fl">1.31794717</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.0433357</span> <span class="dv">2</span>  <span class="fl">1.957712</span> <span class="fl">3.83263792</span></span></code></pre></div>
<ul>
<li><p>Because a copy hasn’t been made by the assignment operator,
there’s only one <code>data.table</code> object in memory referenced by
two names.</p></li>
<li><p>So when we make a change to the “first data table”
<code>DT</code>, we also change the “second data table”
<code>DT2</code>.</p></li>
</ul>
<p>If we actually want a <strong>real copy</strong> of a
<code>data.table</code> object, we have to use the <code>copy()</code>
function as follows:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>DT3 <span class="ot">&lt;-</span> <span class="fu">copy</span>(DT)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>DT[, y<span class="sc">:</span><span class="er">=</span> <span class="dv">3</span>]</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(DT, <span class="dv">3</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>            x y         z          w</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span>  <span class="fl">0.3833715</span> <span class="dv">3</span> <span class="sc">-</span><span class="fl">0.242491</span> <span class="fl">0.05880187</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.5179331</span> <span class="dv">3</span> <span class="sc">-</span><span class="fl">1.148019</span> <span class="fl">1.31794717</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.0433357</span> <span class="dv">3</span>  <span class="fl">1.957712</span> <span class="fl">3.83263792</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(DT3, <span class="dv">3</span>)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>            x y         z          w</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span>  <span class="fl">0.3833715</span> <span class="dv">2</span> <span class="sc">-</span><span class="fl">0.242491</span> <span class="fl">0.05880187</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.5179331</span> <span class="dv">2</span> <span class="sc">-</span><span class="fl">1.148019</span> <span class="fl">1.31794717</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.0433357</span> <span class="dv">2</span>  <span class="fl">1.957712</span> <span class="fl">3.83263792</span></span></code></pre></div>
</div>
<div id="creating-new-variables-from-multiple-operations."
class="section level2" number="10.7">
<h2><span class="header-section-number">10.7</span> Creating new
variables from multiple operations.</h2>
<p>Another thing that we can do is <strong>perform multiple step
functions to create new variables</strong>.</p>
<p>Indeed, we can use <code>operator :=</code> with any
<em>expression</em> (an arbitrary number of statements within curly
brackets, separated by a semi-colon if they are in the same line).</p>
<p>For example:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>DT[, m<span class="sc">:</span><span class="er">=</span> {tmp <span class="ot">&lt;-</span> (x<span class="sc">+</span>z); <span class="fu">log2</span>(tmp<span class="sc">+</span><span class="dv">5</span>)}]</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(DT)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>             x y         z          w        m</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span>  <span class="fl">0.38337154</span> <span class="dv">3</span> <span class="sc">-</span><span class="fl">0.242491</span> <span class="fl">0.05880187</span> <span class="fl">2.362015</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.51793311</span> <span class="dv">3</span> <span class="sc">-</span><span class="fl">1.148019</span> <span class="fl">1.31794717</span> <span class="fl">1.737275</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.04333570</span> <span class="dv">3</span>  <span class="fl">1.957712</span> <span class="fl">3.83263792</span> <span class="fl">2.789599</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.17454999</span> <span class="dv">3</span> <span class="sc">-</span><span class="fl">1.176553</span> <span class="fl">1.38427581</span> <span class="fl">1.867461</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span>  <span class="fl">0.07278283</span> <span class="dv">3</span> <span class="sc">-</span><span class="fl">2.636162</span> <span class="fl">6.94934840</span> <span class="fl">1.284882</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.87465093</span> <span class="dv">3</span>  <span class="fl">2.364532</span> <span class="fl">5.59101123</span> <span class="fl">2.698192</span></span></code></pre></div>
<ul>
<li><p>The first statement in that expression, assigns to a temporary
variable the sum of the x and z variables or columns.</p></li>
<li><p>The second one, takes the log base two of that temporary variable
plus five.</p></li>
<li><p>And, as we should remember, the expression <strong>returns the
evaluation of the last statement</strong>.</p></li>
</ul>
<p>So those sorts of multi step operations can be handled very easily
with <code>data.table</code>.</p>
</div>
<div
id="grouping-creating-variables-with-plyr-like-operations-the-by-parameter."
class="section level2" number="10.8">
<h2><span class="header-section-number">10.8</span> Grouping: creating
variables with <code>plyr</code> like operations, the <code>by</code>
parameter.</h2>
<p>We can also do <code>plyr</code> like operations.</p>
<p>For example we can add to our <code>data.table</code> a
<strong>binary variable</strong> that equals to <code>TRUE</code> when
variable or column x of our data table is greater than zero and
<code>FALSE</code> otherwise.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>DT[, a<span class="sc">:</span><span class="er">=</span> x<span class="sc">&gt;</span><span class="dv">0</span>]</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(DT)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>             x y         z          w        m     a</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span>  <span class="fl">0.38337154</span> <span class="dv">3</span> <span class="sc">-</span><span class="fl">0.242491</span> <span class="fl">0.05880187</span> <span class="fl">2.362015</span>  <span class="cn">TRUE</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.51793311</span> <span class="dv">3</span> <span class="sc">-</span><span class="fl">1.148019</span> <span class="fl">1.31794717</span> <span class="fl">1.737275</span> <span class="cn">FALSE</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.04333570</span> <span class="dv">3</span>  <span class="fl">1.957712</span> <span class="fl">3.83263792</span> <span class="fl">2.789599</span> <span class="cn">FALSE</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.17454999</span> <span class="dv">3</span> <span class="sc">-</span><span class="fl">1.176553</span> <span class="fl">1.38427581</span> <span class="fl">1.867461</span> <span class="cn">FALSE</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span>  <span class="fl">0.07278283</span> <span class="dv">3</span> <span class="sc">-</span><span class="fl">2.636162</span> <span class="fl">6.94934840</span> <span class="fl">1.284882</span>  <span class="cn">TRUE</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.87465093</span> <span class="dv">3</span>  <span class="fl">2.364532</span> <span class="fl">5.59101123</span> <span class="fl">2.698192</span> <span class="cn">FALSE</span></span></code></pre></div>
<p>So now we have a binary variable that <strong>we can work
with</strong>. Suppose, for instance, that we want to
<strong>summarize</strong> another variable <strong>by the cases
where</strong> x is greater than 0 <strong>versus the cases
where</strong> x is less than 0.</p>
<ul>
<li><p>Let’s in particular create a new varialbe that contains an
<strong>aggregated mean</strong>, that is, a <strong>mean</strong>
<strong>aggregated over</strong> the grouping variable specified by the
<strong><code>by</code> parameter</strong>.</p></li>
<li><p>More precisely, take the <strong>mean of the sum</strong> of
variables <code>x</code> and <code>w</code>, and do it <strong>grouping
by</strong> the variable <code>a</code>.</p></li>
</ul>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>DT[, b<span class="sc">:</span><span class="er">=</span> <span class="fu">mean</span>(x<span class="sc">+</span>w), by <span class="ot">=</span> a]</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(DT)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>             x y         z          w        m     a        b</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span>  <span class="fl">0.38337154</span> <span class="dv">3</span> <span class="sc">-</span><span class="fl">0.242491</span> <span class="fl">0.05880187</span> <span class="fl">2.362015</span>  <span class="cn">TRUE</span> <span class="fl">2.427413</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.51793311</span> <span class="dv">3</span> <span class="sc">-</span><span class="fl">1.148019</span> <span class="fl">1.31794717</span> <span class="fl">1.737275</span> <span class="cn">FALSE</span> <span class="fl">1.776191</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.04333570</span> <span class="dv">3</span>  <span class="fl">1.957712</span> <span class="fl">3.83263792</span> <span class="fl">2.789599</span> <span class="cn">FALSE</span> <span class="fl">1.776191</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.17454999</span> <span class="dv">3</span> <span class="sc">-</span><span class="fl">1.176553</span> <span class="fl">1.38427581</span> <span class="fl">1.867461</span> <span class="cn">FALSE</span> <span class="fl">1.776191</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span>  <span class="fl">0.07278283</span> <span class="dv">3</span> <span class="sc">-</span><span class="fl">2.636162</span> <span class="fl">6.94934840</span> <span class="fl">1.284882</span>  <span class="cn">TRUE</span> <span class="fl">2.427413</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span> <span class="sc">-</span><span class="fl">0.87465093</span> <span class="dv">3</span>  <span class="fl">2.364532</span> <span class="fl">5.59101123</span> <span class="fl">2.698192</span> <span class="cn">FALSE</span> <span class="fl">1.776191</span></span></code></pre></div>
<ul>
<li><p>So it takes the <code>mean</code> of <code>x + y</code> when
<code>a</code> is equal to <code>TRUE</code>, and <strong>places that
mean in all the</strong> <strong>rows where <code>a</code> is
<code>TRUE</code></strong>.</p></li>
<li><p>Then it does the same of all <strong>rows where <code>a</code>
equals to <code>FALSE</code></strong>.</p></li>
</ul>
</div>
<div id="special-variables-.n-dot-n" class="section level2"
number="10.9">
<h2><span class="header-section-number">10.9</span> Special variables:
<code>.N</code> (dot N)</h2>
<p>There’re some <strong>special variables</strong> of
<code>data.table</code> that allow us to do <strong>some things really
fast</strong>.</p>
<p>One these special variables is <code>.N</code>:</p>
<ul>
<li><p>It is an <strong>integer</strong>.</p></li>
<li><p>Of <strong>length 1</strong>.</p></li>
<li><p>And it’s a <strong>container</strong> of the <strong>number of
times</strong> that a <strong>particular group
appears</strong>.</p></li>
</ul>
<p>For <strong>example</strong>:</p>
<ul>
<li><p>Let’s create a data table that has a variable <code>x</code> with
a <strong>large number of random <code>a</code>s, <code>b</code>s,
and</strong> <strong><code>c</code>s</strong> in it, <strong>about
100,000</strong> in total (we can use the <code>sample</code> function
for this).</p></li>
<li><p>Then we want to <strong>count the number of times each of those
letters appear</strong>.</p>
<ul>
<li>And we can do this using <code>.N</code>, <strong>grouped by the
<code>x</code> variable</strong>.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>SDT <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">sample</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="fl">1E5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>SDT[, .N, by <span class="ot">=</span> x]</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>   x     N</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> c <span class="dv">33294</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> b <span class="dv">33305</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> a <span class="dv">33401</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(SDT<span class="sc">$</span>x)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    a     b     c </span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="dv">33401</span> <span class="dv">33305</span> <span class="dv">33294</span> </span></code></pre></div>
<ul>
<li><p><code>.N</code> just means <strong>count the number of times,
grouped by the <code>x</code> variable</strong>.</p></li>
<li><p>It does that <strong>very fast as opposed to</strong> the
<strong>equivalent operation
<code>table(SDT$x)</code></strong>.</p></li>
</ul>
</div>
<div id="keys-setkey-function." class="section level2" number="10.10">
<h2><span class="header-section-number">10.10</span> Keys:
<code>setkey()</code> function.</h2>
<p>A <strong>unique aspect of <code>data.table</code></strong> is that
they have <strong>keys</strong>.</p>
<p>If we set the key with the <code>setkey()</code> command, it’s
<strong>possible to subset and sort</strong> a data table <strong>much
more rapidly than</strong> we would be able to do with <strong>a data
frame</strong>.</p>
<div id="ultra-fast-subsetting-and-sorting." class="section level3"
number="10.10.1">
<h3><span class="header-section-number">10.10.1</span> Ultra fast
subsetting and sorting.</h3>
<p><strong>Example</strong>:</p>
<ul>
<li><p>Create a data table with a variable <code>x</code> (with 100
<code>a</code>s, <code>b</code>s, and <code>c</code>s) and a variable
<code>y</code> (with 300 normal random numbers).</p></li>
<li><p>Set the key for the data table to be the variable
<code>x</code>.</p></li>
<li><p>Then if we want to <strong>subset on the basis of our key
<code>x</code></strong>, we can <strong>use a value </strong> (let’s say
<code>'a'</code>) and then R knows that it has to <strong>go and look in
the key</strong>, so it <strong>very quickly subsets</strong> the data
<strong>to only the values of <code>x</code> that are equal to
<code>'a'</code></strong>.</p></li>
</ul>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>KDT <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>), <span class="at">each =</span> <span class="dv">100</span>), <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">300</span>))  <span class="co"># 300 rows</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setkey</span>(KDT, x)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(KDT[<span class="st">&#39;a&#39;</span>])                                                            <span class="co"># 100 rows</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>   x          y</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> a  <span class="fl">0.8863126</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> a  <span class="fl">2.8285813</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> a  <span class="fl">2.0314543</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> a  <span class="fl">1.9067541</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span> a  <span class="fl">0.2149083</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span> a <span class="sc">-</span><span class="fl">0.8627341</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tables</span>()</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>          NAME      NROW NCOL  MB</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span><span class="sc">:</span>         DT         <span class="dv">9</span>    <span class="dv">7</span>   <span class="dv">0</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span><span class="sc">:</span>     DT_col         <span class="dv">9</span>    <span class="dv">1</span>   <span class="dv">0</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span><span class="sc">:</span>        DT2         <span class="dv">9</span>    <span class="dv">7</span>   <span class="dv">0</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span><span class="sc">:</span>        DT3         <span class="dv">9</span>    <span class="dv">4</span>   <span class="dv">0</span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span><span class="sc">:</span>        DTA         <span class="dv">4</span>    <span class="dv">2</span>   <span class="dv">0</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span><span class="sc">:</span>        DTB         <span class="dv">3</span>    <span class="dv">2</span>   <span class="dv">0</span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span><span class="sc">:</span> hpcDataset <span class="dv">2</span>,<span class="dv">075</span>,<span class="dv">259</span>    <span class="dv">9</span> <span class="dv">151</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span><span class="sc">:</span>        KDT       <span class="dv">300</span>    <span class="dv">2</span>   <span class="dv">0</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span><span class="sc">:</span>        SDT   <span class="dv">100</span>,<span class="dv">000</span>    <span class="dv">1</span>   <span class="dv">1</span></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span><span class="sc">:</span>    twoDays     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span><span class="sc">:</span>   twoDays1     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span><span class="sc">:</span>   twoDays2     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span><span class="sc">:</span>   twoDays3     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span><span class="sc">:</span> twoDays3<span class="fl">.5</span>     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span><span class="sc">:</span>   twoDays4     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span><span class="sc">:</span>   twoDays5     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span><span class="sc">:</span>   twoDays6     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>                                                                                COLS</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span><span class="sc">:</span>                                                                  x,y,z,w,m,a,...</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span><span class="sc">:</span>                                                                                z</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span><span class="sc">:</span>                                                                  x,y,z,w,m,a,...</span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span><span class="sc">:</span>                                                                          x,y,z,w</span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span><span class="sc">:</span>                                                                              x,y</span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span><span class="sc">:</span>                                                                              x,y</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span><span class="sc">:</span>                                                                              x,y</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span><span class="sc">:</span>                                                                                x</span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a>    KEY</span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span><span class="sc">:</span>    </span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span><span class="sc">:</span>    </span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span><span class="sc">:</span>    </span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span><span class="sc">:</span>    </span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span><span class="sc">:</span>   x</span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span><span class="sc">:</span>   x</span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span><span class="sc">:</span>    </span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span><span class="sc">:</span>   x</span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span><span class="sc">:</span>    </span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span><span class="sc">:</span>    </span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span><span class="sc">:</span>    </span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span><span class="sc">:</span>    </span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span><span class="sc">:</span>    </span>
<span id="cb48-65"><a href="#cb48-65" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span><span class="sc">:</span>    </span>
<span id="cb48-66"><a href="#cb48-66" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span><span class="sc">:</span>    </span>
<span id="cb48-67"><a href="#cb48-67" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span><span class="sc">:</span>    </span>
<span id="cb48-68"><a href="#cb48-68" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span><span class="sc">:</span>    </span>
<span id="cb48-69"><a href="#cb48-69" aria-hidden="true" tabindex="-1"></a>Total<span class="sc">:</span> 152MB</span>
<span id="cb48-70"><a href="#cb48-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-71"><a href="#cb48-71" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(KDT[<span class="st">&#39;a&#39;</span>])</span>
<span id="cb48-72"><a href="#cb48-72" aria-hidden="true" tabindex="-1"></a>Classes <span class="st">&#39;data.table&#39;</span> and <span class="st">&#39;data.frame&#39;</span><span class="sc">:</span>  <span class="dv">100</span> obs. of  <span class="dv">2</span> variables<span class="sc">:</span></span>
<span id="cb48-73"><a href="#cb48-73" aria-hidden="true" tabindex="-1"></a> <span class="er">$</span> x<span class="sc">:</span> chr  <span class="st">&quot;a&quot;</span> <span class="st">&quot;a&quot;</span> <span class="st">&quot;a&quot;</span> <span class="st">&quot;a&quot;</span> ...</span>
<span id="cb48-74"><a href="#cb48-74" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> y<span class="sc">:</span> num  <span class="fl">0.886</span> <span class="fl">2.829</span> <span class="fl">2.031</span> <span class="fl">1.907</span> <span class="fl">0.215</span> ...</span>
<span id="cb48-75"><a href="#cb48-75" aria-hidden="true" tabindex="-1"></a> <span class="sc">-</span> <span class="fu">attr</span>(<span class="sc">*</span>, <span class="st">&quot;sorted&quot;</span>)<span class="ot">=</span> chr <span class="st">&quot;x&quot;</span></span>
<span id="cb48-76"><a href="#cb48-76" aria-hidden="true" tabindex="-1"></a> <span class="sc">-</span> <span class="fu">attr</span>(<span class="sc">*</span>, <span class="st">&quot;.internal.selfref&quot;</span>)<span class="ot">=</span><span class="er">&lt;</span>externalptr<span class="sc">&gt;</span> </span></code></pre></div>
</div>
<div id="ultra-fast-joints-between-data-tables." class="section level3"
number="10.10.2">
<h3><span class="header-section-number">10.10.2</span> Ultra fast joints
between data tables.</h3>
<p><strong>Example</strong>:</p>
<ul>
<li><p>Create <strong>two data tables</strong> of different number of
observations, both with a variable <code>x</code> and a variable
<code>y</code>, and the second data table with a further variable
<code>z</code>.</p></li>
<li><p>We can set the key in both cases to be equal to <code>x</code>
(<strong>same key for both data tables</strong>).</p></li>
<li><p>Then we can <strong>merge them together</strong>.</p></li>
</ul>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>DTA <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="st">&#39;a&#39;</span>, <span class="st">&#39;a&#39;</span>, <span class="st">&#39;b&#39;</span>, <span class="st">&#39;dta&#39;</span>), <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>DTB <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="st">&#39;a&#39;</span>, <span class="st">&#39;b&#39;</span>, <span class="st">&#39;dtb&#39;</span>), <span class="at">y =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">setkey</span>(DTA, x); <span class="fu">setkey</span>(DTB, x)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tables</span>()</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>          NAME      NROW NCOL  MB</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span><span class="sc">:</span>         DT         <span class="dv">9</span>    <span class="dv">7</span>   <span class="dv">0</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span><span class="sc">:</span>     DT_col         <span class="dv">9</span>    <span class="dv">1</span>   <span class="dv">0</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span><span class="sc">:</span>        DT2         <span class="dv">9</span>    <span class="dv">7</span>   <span class="dv">0</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span><span class="sc">:</span>        DT3         <span class="dv">9</span>    <span class="dv">4</span>   <span class="dv">0</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span><span class="sc">:</span>        DTA         <span class="dv">4</span>    <span class="dv">2</span>   <span class="dv">0</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span><span class="sc">:</span>        DTB         <span class="dv">3</span>    <span class="dv">2</span>   <span class="dv">0</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span><span class="sc">:</span> hpcDataset <span class="dv">2</span>,<span class="dv">075</span>,<span class="dv">259</span>    <span class="dv">9</span> <span class="dv">151</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span><span class="sc">:</span>        KDT       <span class="dv">300</span>    <span class="dv">2</span>   <span class="dv">0</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span><span class="sc">:</span>        SDT   <span class="dv">100</span>,<span class="dv">000</span>    <span class="dv">1</span>   <span class="dv">1</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span><span class="sc">:</span>    twoDays     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span><span class="sc">:</span>   twoDays1     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span><span class="sc">:</span>   twoDays2     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span><span class="sc">:</span>   twoDays3     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span><span class="sc">:</span> twoDays3<span class="fl">.5</span>     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span><span class="sc">:</span>   twoDays4     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span><span class="sc">:</span>   twoDays5     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span><span class="sc">:</span>   twoDays6     <span class="dv">2</span>,<span class="dv">880</span>    <span class="dv">9</span>   <span class="dv">0</span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>                                                                                COLS</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span><span class="sc">:</span>                                                                  x,y,z,w,m,a,...</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span><span class="sc">:</span>                                                                                z</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span><span class="sc">:</span>                                                                  x,y,z,w,m,a,...</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span><span class="sc">:</span>                                                                          x,y,z,w</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span><span class="sc">:</span>                                                                              x,y</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span><span class="sc">:</span>                                                                              x,y</span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span><span class="sc">:</span>                                                                              x,y</span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span><span class="sc">:</span>                                                                                x</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span><span class="sc">:</span> Date,Time,Global_active_power,Global_reactive_power,Voltage,Global_intensity,...</span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a>    KEY</span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span><span class="sc">:</span>    </span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span><span class="sc">:</span>    </span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span><span class="sc">:</span>    </span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span><span class="sc">:</span>    </span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span><span class="sc">:</span>   x</span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span><span class="sc">:</span>   x</span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span><span class="sc">:</span>    </span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span><span class="sc">:</span>   x</span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span><span class="sc">:</span>    </span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span><span class="sc">:</span>    </span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span><span class="sc">:</span>    </span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span><span class="sc">:</span>    </span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span><span class="sc">:</span>    </span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span><span class="sc">:</span>    </span>
<span id="cb49-58"><a href="#cb49-58" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span><span class="sc">:</span>    </span>
<span id="cb49-59"><a href="#cb49-59" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span><span class="sc">:</span>    </span>
<span id="cb49-60"><a href="#cb49-60" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span><span class="sc">:</span>    </span>
<span id="cb49-61"><a href="#cb49-61" aria-hidden="true" tabindex="-1"></a>Total<span class="sc">:</span> 152MB</span>
<span id="cb49-62"><a href="#cb49-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-63"><a href="#cb49-63" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(DTA, DTB)</span>
<span id="cb49-64"><a href="#cb49-64" aria-hidden="true" tabindex="-1"></a>   x y.x y.y</span>
<span id="cb49-65"><a href="#cb49-65" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> a   <span class="dv">1</span>   <span class="dv">5</span></span>
<span id="cb49-66"><a href="#cb49-66" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> a   <span class="dv">2</span>   <span class="dv">5</span></span>
<span id="cb49-67"><a href="#cb49-67" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> b   <span class="dv">3</span>   <span class="dv">6</span></span></code></pre></div>
<ul>
<li>This is actually <strong>quite a bit faster than</strong> merging
with the <strong>data frame</strong> <strong><em>as long
as</em></strong> we have the <strong><em>same key</em></strong> for both
data tables. It can be very fast.</li>
</ul>
</div>
</div>
<div id="fast-reading-fread-against-read.table." class="section level2"
number="10.11">
<h2><span class="header-section-number">10.11</span> Fast reading
(<code>fread()</code> against <code>read.table()</code>).</h2>
<p>It can also be advantageous to <strong>use <code>data.table</code>’s
fast reader <code>fread()</code></strong> if we want to be able to read
files fast from the disk.</p>
<ul>
<li>Aside: <code>fread</code> accpets <code>http</code> and
<code>https</code> URLs directly.</li>
</ul>
<p>Consider this <strong>example</strong>:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>big_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="fl">1E6</span>), <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="fl">1E6</span>))</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(big_df, <span class="at">file =</span> file, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">col.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(<span class="fu">fread</span>(file))</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>   user  system elapsed </span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.141</span>   <span class="fl">0.008</span>   <span class="fl">0.032</span> </span></code></pre></div>
<ul>
<li><p>It creates a <strong>big data frame</strong> (yes, a data
<em>frame</em>) with two very large variables in it.</p></li>
<li><p>Sets up a <strong>temporary file</strong> with
<code>tempfile()</code> command.</p>
<ul>
<li><code>tempfile</code> returns a vector of character strings which
can be used as <em>names</em> for temporary files (no files are
generated).</li>
</ul></li>
<li><p>Uses <code>write.table()</code> to write our big data frame into
that temporary file.</p></li>
<li><p>Then it <strong>times out</strong> how long it takes to read in
from that file, using <strong>the <code>fread()</code>
command</strong>.</p>
<ul>
<li><code>fread</code> can be applied to reading data tables, just like
basically a <strong>drop-in substitute</strong> for
<code>read.table()</code> tab separated files.</li>
</ul></li>
</ul>
<p>Now, if we try to read that file with <code>read.table()</code>, it
would be <strong>quite a bit slower</strong>, a more than <strong>ten
times slower</strong>.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(<span class="fu">read.table</span>(file, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>))</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>   user  system elapsed </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fl">2.395</span>   <span class="fl">0.008</span>   <span class="fl">2.402</span> </span></code></pre></div>
<p>So it’s actually <strong>much faster</strong> to read files with
<strong>data.table’s <code>fread()</code> function</strong> as well.</p>
</div>
<div id="summary-and-further-reading." class="section level2"
number="10.12">
<h2><span class="header-section-number">10.12</span> Summary and further
reading.</h2>
<p>To summarize <code>data.table</code>, it can be both
<strong>faster</strong> and <strong>more memory efficient</strong> than
data frames.</p>
<p>Although it <strong>requires</strong> us to learn a little bit of use
syntax, and sometimes to be a little bit <strong>careful</strong> in
<strong>terms of copying over data tables</strong>.</p>
<p>The latest developments can be found on <a
href="https://github.com/Rdatatable/data.table">this GitHub repo</a></p>
<p>We can find a very nice and comprehensive list of <strong>all the
differences between <code>data.table</code> and</strong>
<strong><code>data.frame</code></strong>, <a
href="https://stackoverflow.com/questions/13618488/what-you-can-do-with-a-data-frame-that-you-cant-with-a-data-table">at
this Stackoverflow link</a></p>
<p>The <strong>vignettes</strong> of this package are great:</p>
<ul>
<li><code>browseVignettes(package = "data.table")</code></li>
</ul>
<hr />
</div>
</div>
<div id="session-info." class="section level1" number="11">
<h1><span class="header-section-number">11</span> Session Info.</h1>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>R version <span class="dv">3</span>.<span class="fl">6.3</span> (<span class="dv">2020-02-29</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>Platform<span class="sc">:</span> x86_64<span class="sc">-</span>pc<span class="sc">-</span>linux<span class="sc">-</span><span class="fu">gnu</span> (<span class="dv">64</span><span class="sc">-</span>bit)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>Running under<span class="sc">:</span> Ubuntu <span class="dv">18</span>.<span class="fl">04.6</span> LTS</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>Matrix products<span class="sc">:</span> default</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>BLAS<span class="sc">:</span>   <span class="er">/</span>usr<span class="sc">/</span>lib<span class="sc">/</span>x86_64<span class="sc">-</span>linux<span class="sc">-</span>gnu<span class="sc">/</span>blas<span class="sc">/</span>libblas.so.<span class="dv">3</span>.<span class="fl">7.1</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>LAPACK<span class="sc">:</span> <span class="er">/</span>usr<span class="sc">/</span>lib<span class="sc">/</span>x86_64<span class="sc">-</span>linux<span class="sc">-</span>gnu<span class="sc">/</span>lapack<span class="sc">/</span>liblapack.so.<span class="dv">3</span>.<span class="fl">7.1</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>locale<span class="sc">:</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] LC_CTYPE<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span>          LC_NUMERIC<span class="ot">=</span>C                 </span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a> [<span class="dv">3</span>] LC_TIME<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span>           LC_COLLATE<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span>       </span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a> [<span class="dv">5</span>] LC_MONETARY<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span>       LC_MESSAGES<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span>      </span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a> [<span class="dv">7</span>] LC_PAPER<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span>          LC_NAME<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span>          </span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a> [<span class="dv">9</span>] LC_ADDRESS<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span>        LC_TELEPHONE<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span>     </span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>[<span class="dv">11</span>] LC_MEASUREMENT<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span>    LC_IDENTIFICATION<span class="ot">=</span>es_AR.UTF<span class="dv">-8</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>attached base packages<span class="sc">:</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>other attached packages<span class="sc">:</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] RMySQL_0.<span class="fl">10.20</span>    DBI_1.<span class="fl">1.1</span>         data.table_1.<span class="fl">14.0</span> jsonlite_1.<span class="fl">7.2</span>   </span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>[<span class="dv">5</span>] XML_3<span class="fl">.99-0.3</span>      xlsx_0.<span class="fl">6.3</span>        plyr_1.<span class="fl">8.6</span>       </span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>loaded via a <span class="fu">namespace</span> (and not attached)<span class="sc">:</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] tidyselect_1.<span class="fl">2.0</span> xfun_0<span class="fl">.36</span>        bslib_0.<span class="fl">3.0</span>      rJava_0<span class="fl">.9</span><span class="dv">-13</span>    </span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a> [<span class="dv">5</span>] lattice_0<span class="fl">.20</span><span class="dv">-45</span>  colorspace_2<span class="fl">.0</span><span class="dv">-3</span> vctrs_0.<span class="fl">5.2</span>      generics_0.<span class="fl">1.2</span>  </span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a> [<span class="dv">9</span>] htmltools_0.<span class="fl">5.2</span>  yaml_2.<span class="fl">2.1</span>       utf8_1.<span class="fl">2.2</span>       rlang_1.<span class="fl">0.6</span>     </span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>[<span class="dv">13</span>] jquerylib_0.<span class="fl">1.4</span>  pillar_1.<span class="fl">7.0</span>     glue_1.<span class="fl">6.2</span>       withr_2.<span class="fl">5.0</span>     </span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>[<span class="dv">17</span>] lifecycle_1.<span class="fl">0.3</span>  stringr_1.<span class="fl">4.0</span>    munsell_0.<span class="fl">5.0</span>    gtable_0.<span class="fl">3.0</span>    </span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>[<span class="dv">21</span>] evaluate_0<span class="fl">.19</span>    knitr_1<span class="fl">.41</span>       tzdb_0.<span class="fl">3.0</span>       fastmap_1.<span class="fl">1.0</span>   </span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>[<span class="dv">25</span>] curl_4.<span class="fl">3.2</span>       fansi_1.<span class="fl">0.2</span>      xlsxjars_0.<span class="fl">6.1</span>   highr_0<span class="fl">.9</span>       </span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>[<span class="dv">29</span>] Rcpp_1.<span class="fl">0.7</span>       scales_1.<span class="fl">1.1</span>     formatR_1<span class="fl">.14</span>     hms_1.<span class="fl">1.0</span>       </span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>[<span class="dv">33</span>] digest_0.<span class="fl">6.29</span>    stringi_1.<span class="fl">7.6</span>    grid_3.<span class="fl">6.3</span>       cli_3.<span class="fl">6.0</span>       </span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>[<span class="dv">37</span>] tools_3.<span class="fl">6.3</span>      magrittr_2.<span class="fl">0.2</span>   sass_0.<span class="fl">4.0</span>       tibble_3.<span class="fl">1.8</span>    </span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>[<span class="dv">41</span>] crayon_1.<span class="fl">5.0</span>     pkgconfig_2.<span class="fl">0.3</span>  ellipsis_0.<span class="fl">3.2</span>   assertthat_0.<span class="fl">2.1</span></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>[<span class="dv">45</span>] rmarkdown_2<span class="fl">.11</span>   httr_1.<span class="fl">4.2</span>       rstudioapi_0<span class="fl">.13</span>  R6_2.<span class="fl">5.1</span>        </span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>[<span class="dv">49</span>] compiler_3.<span class="fl">6.3</span>  </span></code></pre></div>
<hr />
</div>

<div style="width: 100%; padding: 10px; box-sizing: border-box; text-align: justify; border: 1px solid gray;">
  <p style="font-family: 'Playfair Display', serif; font-style: italic;">Copyright &copy; 2020 por <b>Christian A. Karanicolas</b>.  Todos los derechos reservados.  La elaboración de este sitio ha tenido como fuente principal de información el curso de <b>Especialización en Ciencias de Datos</b> brindado por la <b>Johns Hopkins University</b> a través de <b>Coursera</b>.</p>
</div>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Playfair+Display&display=swap');
</style>


<!--
<p style="font-family: 'Playfair Display', serif; font-style: italic;">Copyright &copy; 2020 por <b>Christian A. Karanicolas</b>.  Todos los derechos reservados.  La elaboración de este sitio ha tenido como fuente principal de información el curso de <b>Especialización en Ciencias de Datos</b> brindado por la <b>Johns Hopkins University</b> a través de <b>Coursera</b>.</p>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Playfair+Display&display=swap');
</style>
-->


<!--
<p style="font-style: italic;">Copyright &copy; 2020 por <b>Christian A. Karanicolas</b>.  Todos los derechos reservados.  La elaboración de este sitio ha tenido como fuente principal de información el curso de <b>Especialización en Ciencias de Datos</b> brindado por la <b>Johns Hopkins University</b> a través de <b>Coursera</b>.</p>
-->




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
